<ac:structured-macro ac:name="details" ac:schema-version="1" ac:macro-id="2f95c83d-1e6b-4368-90b5-db706a83e058"><ac:parameter ac:name="id">requirements</ac:parameter><ac:rich-text-body>
<table class="relative-table wrapped" style="width: 89.006%;"><colgroup><col style="width: 21.9306%;" /><col style="width: 78.0694%;" /></colgroup>
<tbody>
<tr>
<th colspan="1"><span style="color: rgb(0,0,0);">Epic в JIRA продукта</span></th>
<td colspan="1">
<div class="content-wrapper">
<p><ac:structured-macro ac:name="jira" ac:schema-version="1" ac:macro-id="c4a353fb-64bd-45f9-94ab-ef5046a93b4b"><ac:parameter ac:name="server">Jira SberWorks</ac:parameter><ac:parameter ac:name="serverId">611daf70-25e6-3844-a434-3583e234ac1b</ac:parameter><ac:parameter ac:name="key">UINAF-456</ac:parameter></ac:structured-macro></p></div></td></tr>
<tr>
<th colspan="1"><span style="color: rgb(0,0,0);">Ссылка на CR/STORY команды</span></th>
<td colspan="1">
<div class="content-wrapper">
<p><ac:structured-macro ac:name="jira" ac:schema-version="1" ac:macro-id="caf84dec-e5a5-492e-9b4b-5c88f2d1e8ad"><ac:parameter ac:name="server">Jira SberWorks</ac:parameter><ac:parameter ac:name="serverId">611daf70-25e6-3844-a434-3583e234ac1b</ac:parameter><ac:parameter ac:name="key">UINAF-2414</ac:parameter></ac:structured-macro></p></div></td></tr>
<tr>
<th colspan="1" style="text-align: left;"><span style="color: rgb(0,0,0);">PO продукта&nbsp;</span></th>
<td colspan="1" style="text-align: left;">
<div class="content-wrapper">
<p><ac:link><ri:user ri:userkey="8aa486275404583f015507210c46028c" /></ac:link></p></div></td></tr>
<tr>
<th colspan="1" style="text-align: left;"><span style="color: rgb(0,0,0);">Системный-аналитик&nbsp;</span></th>
<td colspan="1" style="text-align: left;">
<div class="content-wrapper">
<p><ac:link><ri:user ri:userkey="8aa489ae658a1a0e01658a4775190002" /></ac:link></p></div></td></tr>
<tr>
<th colspan="1">Статус согласования</th>
<td colspan="1">
<div class="content-wrapper">
<p><ac:structured-macro ac:name="pagestatus" ac:schema-version="1" ac:macro-id="78e6cbf4-f1c3-4d8e-a397-5be1651a0856" /></p></div></td></tr>
<tr>
<th colspan="1">БТ</th>
<td colspan="1"><ac:link><ri:page ri:content-title="БТ. Модуль Списков 2.0." /></ac:link></td></tr></tbody></table></ac:rich-text-body></ac:structured-macro><ac:structured-macro ac:name="numberedheadings" ac:schema-version="1" ac:macro-id="07a00a23-bb8d-41b3-afbc-c102f657467c"><ac:rich-text-body><ac:structured-macro ac:name="expand" ac:schema-version="1" ac:macro-id="eeade700-56fc-475e-93f0-218761db02b1"><ac:parameter ac:name="title">Оглавление</ac:parameter><ac:rich-text-body>
<p><ac:structured-macro ac:name="toc" ac:schema-version="1" ac:macro-id="06871eb8-97e9-4b83-ad76-e460bbc9d49c" /></p></ac:rich-text-body></ac:structured-macro>
<h1>Изменения</h1>
<table class="wrapped"><colgroup><col /><col /><col /></colgroup>
<tbody>
<tr>
<th>Дата</th>
<th>Описание</th>
<th>Автор</th></tr>
<tr>
<td>
<div class="content-wrapper">
<p><time datetime="2023-06-13" />&nbsp;</p></div></td>
<td>Создание статьи</td>
<td>
<div class="content-wrapper"><ac:link><ri:user ri:userkey="8aae6c9b8767c64801876a9fba970002" /></ac:link></div></td></tr>
<tr>
<td>20.06.2023</td>
<td>Статья актуализирована</td>
<td>
<div class="content-wrapper">
<p><ac:link><ri:user ri:userkey="8aa489ae658a1a0e01658a4775190002" /></ac:link></p></div></td></tr>
<tr>
<td><span style="color: rgb(128,0,128);">29.06.2023</span></td>
<td><span style="color: rgb(128,0,128);">Внесены изменения в Удаление списков после тестирования СТ</span></td>
<td>
<div class="content-wrapper">
<p><ac:link><ri:user ri:userkey="8aa489ae658a1a0e01658a4775190002" /></ac:link></p></div></td></tr>
<tr>
<td>07.07.2023</td>
<td>
<div class="content-wrapper">
<p>Заменены и добавлены следующие макеты:</p>
<ul>
<li>Макет Журнал &quot;Списки 2.0&quot; ;</li>
<li>Макет&nbsp;Журнала &quot;Списки 2.0&quot; с отображением выпадающего списка&nbsp;с&nbsp;параметрами, по которым можно осуществить фильтрацию;</li>
<li>Макет&nbsp;Журнала &quot;Списки 2.0&quot; с отображением всех доступных фильтров;</li>
<li>Макет&nbsp;Журнала &quot;Списки 2.0&quot; с примером отображения мультиселекта для выбора в фильтре;</li>
<li>Макет карточки &quot;Список&quot; без элементов списка;</li>
<li>Макет карточки &quot;Список&quot; с признаком автосинхронизации;</li>
<li>Макет модального окна &quot;Редактирование списка&quot;;</li>
<li>Макет &quot;Кнопки &quot;Удалить&quot; и &quot;Редактировать&quot; недоступны для списка, связанного с правилом и/или онлайн-фактом&quot;;</li>
<li>Макет информационное сообщение&nbsp;&nbsp;&quot;Объект связан с другими элементами системы&quot;, при наведении на кнопку &quot;Редактировать&quot; для списка, у которого есть связь с другими сущностями;</li>
<li>Макет информационное сообщение&nbsp;&nbsp;&quot;Объект связан с другими элементами системы&quot;, при наведении на кнопку &quot;Удалить&quot; для списка, у которого есть связь с другими сущностями;</li>
<li>Макет &quot;Подтверждение удаления одного списка из журнала&quot;;</li>
<li>Макет &quot;Невозможность единичного удаления списка из журнала, т.к. список связан с другими сущностями&quot;;</li>
<li>Макет &quot;Невозможность удаления списка с признаком Автосинхронизации&quot;;</li>
<li>Макет &quot;Массовое удаление списков из журнала&quot;;</li>
<li>Макет &quot;Невозможность массового удаления списков из журнала, привязанных к других сущностям&quot;;</li>
<li>Макет &quot;Следующие списки невозможно удалить, так как они связаны с другими объектами системы: &lt;перечень списков&gt;. Удалить остальные списки?&quot;;</li>
<li>Макет&nbsp;пустого модального окна &quot;Добавление элемента списка&quot;;</li>
<li>Макет &quot;Добавление элемента списка&quot;, выбран чек-бокс &quot;Период действия&quot;;</li>
<li>Макет&nbsp;модального окна &quot;Редактирование элемента списка&quot;;</li>
<li>Макет&nbsp;&quot;Удаление элемента списка через боковую панель&quot;;</li>
<li>Макет&nbsp;&quot;Подтверждение удаления элемента списка через боковую панель&quot;;</li>
<li>Макет &quot;Удаление элемента списка, при выборе чек-бокса&quot;;</li>
<li>Макет &quot;Удалить все элементы в списке, при выборе чек-боксов&quot;;</li>
<li>Макет &quot;Подтверждение удаления элементов в списке, при выборе чек-боксов&quot;;</li>
<li>Макет&nbsp; &quot;Подтверждение удаления при удалении по кнопке &quot;Очистить все&quot;.</li></ul>
<p>Скорректировано описание к полям в описании журнала &quot;Списки 2.0&quot;.</p>
<p>Было:</p>
<p><ac:image ac:height="50"><ri:attachment ri:filename="image2023-7-7_12-32-21.png" /></ac:image></p>
<p><ac:image ac:height="72"><ri:attachment ri:filename="image2023-7-7_12-31-56.png" /></ac:image></p>
<p>Стало:</p>
<p><ac:image ac:height="110"><ri:attachment ri:filename="image2023-7-7_12-30-28.png" /></ac:image></p>
<p><ac:image ac:height="90"><ri:attachment ri:filename="image2023-7-7_12-30-57.png" /></ac:image></p>
<p>Добавлено описание кнопки &quot;Очистить все&quot; в описание карточки &quot;Список&quot;:</p>
<p><ac:image ac:height="180"><ri:attachment ri:filename="image2023-7-7_17-3-2.png" /></ac:image></p></div></td>
<td>
<div class="content-wrapper">
<p><ac:link><ri:user ri:userkey="8aae6c9b8767c64801876a9fba970002" /></ac:link></p></div></td></tr>
<tr>
<td>
<div class="content-wrapper">
<p><time datetime="2023-07-10" />&nbsp;</p></div></td>
<td>
<div class="content-wrapper">
<ol>
<li>&nbsp;Скорректировано описание создания элементов списка.</li></ol>
<p>Было:</p>
<p><ac:image ac:height="250"><ri:attachment ri:filename="image2023-7-10_14-48-12.png" /></ac:image></p>
<p>Стало:</p>
<p><ac:image ac:height="250"><ri:attachment ri:filename="image2023-7-10_14-47-15.png" /></ac:image></p>
<p>2. Скорректирован состав команд отправляемы в Core при удалении списков, п.<ac:link ac:anchor="5.5." /> (удалена команда на удаление одного элемента списка).</p>
<p>3. Скорректирована последовательность отправки команд в Core, при редактировании элемента списка, п.<ac:link ac:anchor="5.7." /></p>
<p>При редактировании элемента списка - необходимо сначала отправить команду на удаление элемента списка, после чего отправить команду на создание элемента списка с новым значением элемента.</p>
<p>4. Дополнено описание удаления элементов списка, п.&nbsp;<ac:link ac:anchor="5.8." />&nbsp;</p>
<p><span style="color: rgb(255,0,0);"><span style="color: rgb(0,0,0);">Было:</span><strong><br /><ac:image ac:height="81"><ri:attachment ri:filename="image2023-7-11_15-7-14.png" /></ac:image></strong></span><br /><br />Стало:<br /><ac:image ac:height="82"><ri:attachment ri:filename="image2023-7-11_15-3-14.png" /></ac:image></p>
<p>5. Корректировка БД - удаление таблицы&nbsp;list_kafka_commands, команды на создание элементов, удаление элементов, удаление списков должны сохраняться в таблицу&nbsp;list_items_kafka_commands.</p></div></td>
<td><br /></td></tr>
<tr>
<td>
<div class="content-wrapper">
<p><time datetime="2023-07-11" />&nbsp;</p></div></td>
<td>
<div class="content-wrapper">
<ol>
<li>По тексту скорректировано для ограничения редактирования списков 2.0 используется значение полей&nbsp;хотя <span class="name" style="color: rgb(23,43,77);" title="usedInOnlineFacts">usedInOnlineFacts и&nbsp;</span><span class="name" style="color: rgb(23,43,77);" title="usedInOnlineFacts"><span style="color: rgb(32,33,36);"><span class="name" title="usedInRules">usedInRules </span></span></span>, а не полt isUsed.</li>
<li>Дополнено описание карточки &quot;Редактирование списка&quot;:<br />Было:&nbsp;Кнопка &quot;Редактировать&quot; не доступна, если:&nbsp;для списков с признаком Автосинхронизации (list.autosync=true).<br />Стало: Кнопка &quot;Редактировать&quot; не доступна, если:&nbsp;для списков с признаком Автосинхронизации (list.autosync=true), для таких списков кнопка &quot;Редактировать&quot; не отображается.<br />Было:&nbsp;Кнопка &quot;Удалить&quot; не доступна, если:&nbsp;для списков с признаком Автосинхронизации (list.autosync=true).<br />Стало: Кнопка &quot;Удалить&quot; не доступна, если:&nbsp;для списков с признаком Автосинхронизации (list.autosync=true), для таких списков кнопка &quot;Редактировать&quot; не отображается.</li>
<li>Скорректировано описание топиков Kafka для взаимодействия с Core.<br /><span style="color: rgb(0,0,0);">Было:<br /><ac:image ac:thumbnail="true" ac:height="90"><ri:attachment ri:filename="image2023-7-11_15-6-43.png" /></ac:image></span><br /><span style="color: rgb(0,0,0);">Стало:</span><strong><span style="color: rgb(255,0,0);"><br /><ac:image ac:height="147"><ri:attachment ri:filename="image2023-7-11_15-6-9.png" /></ac:image></span></strong></li>
<li>Дополнено описание интеграции с Core для п. <ac:link ac:anchor="5.6." />:<br />В случае если для полей ttl_from и ttl_to отсутствуют значения (null) при отправке команды на создание элемента в Kafka, необходимо:
<ul>
<li>ttl_from=null, в команде, в поле start - необходимо указывать минимально возможное значение (<span style="color: rgb(65,134,248);">start </span><span style="color: rgb(23,43,77);">= </span><span style="color: rgb(102,217,239);">LocalDate</span><span style="color: rgb(23,43,77);">.</span><span style="color: rgb(65,134,248);">MIN</span><span style="color: rgb(23,43,77);">.</span><span style="color: rgb(166,226,46);">atStartOfDay</span><span style="color: rgb(84,168,87);">()</span><span style="color: rgb(23,43,77);">.</span><span style="color: rgb(166,226,46);">atOffset</span><span style="color: rgb(84,168,87);">(</span><span style="color: rgb(102,217,239);">ZoneOffset</span><span style="color: rgb(23,43,77);">.</span><span style="color: rgb(65,134,248);">UTC<span style="color: rgb(84,168,87);">)<span style="color: rgb(0,0,0);">);</span></span></span></li>
<li>ttl_to=null, в команде, в поле end - необходимо указывать максимально возможное значение (<span style="color: rgb(65,134,248);">end </span><span style="color: rgb(23,43,77);">= </span><span style="color: rgb(102,217,239);">LocalDate</span><span style="color: rgb(23,43,77);">.</span><span style="color: rgb(65,134,248);">MAX</span><span style="color: rgb(23,43,77);">.</span><span style="color: rgb(166,226,46);">atStartOfDay</span><span style="color: rgb(84,168,87);">()</span><span style="color: rgb(23,43,77);">.</span><span style="color: rgb(166,226,46);">atOffset</span><span style="color: rgb(84,168,87);">(</span><span style="color: rgb(102,217,239);">ZoneOffset</span><span style="color: rgb(23,43,77);">.</span><span style="color: rgb(65,134,248);">UTC</span><span style="color: rgb(84,168,87);">)</span><span style="color: rgb(65,134,248);"><span style="color: rgb(84,168,87);"><span style="color: rgb(0,0,0);">);</span></span></span></li></ul></li>
<li>Заменены следующие макеты:
<ul>
<li>Макет пустого модального окна &quot;Создание списка&quot;;</li>
<li>Макет заполненного модального окна &quot;Создание списка&quot;.</li></ul></li></ol></div></td>
<td><br /></td></tr>
<tr>
<td>
<div class="content-wrapper">
<p><time datetime="2023-07-17" />&nbsp;</p></div></td>
<td>
<div class="content-wrapper">
<p>Скорректировано описание валидации названия списка.</p>
<p>Было:</p>
<p><ac:image ac:height="250"><ri:attachment ri:filename="image2023-7-17_11-45-15.png" /></ac:image></p>
<p>Стало:</p>
<p><ac:image ac:width="335"><ri:attachment ri:filename="image2023-7-18_18-34-20.png" /></ac:image></p></div></td>
<td><br /></td></tr>
<tr>
<td>
<div class="content-wrapper">
<p><time datetime="2023-07-18" />&nbsp;</p></div></td>
<td>
<div class="content-wrapper">
<ol>
<li><span style="color: rgb(0,0,0);">Добавлены следующие макеты:</span></li></ol>
<ul>
<li><span style="color: rgb(0,0,0);">Макет&nbsp;ошибка &quot;Сущность с таким именем уже существует&quot; для модального окна &quot;Создание списка&quot;;</span></li>
<li><span style="color: rgb(0,0,0);">Макет уведомление&nbsp;&quot;Список &ldquo;Название списка&rdquo; успешно создан&quot;,&nbsp;после нажатия на кнопку &quot;Сохранить и создать новый&quot; для модального окна &quot;Создание списка&quot;;</span></li>
<li><span style="color: rgb(0,0,0);">Макет модального окна &quot;Редактирование списка&quot;с элементами ;</span></li>
<li><span style="color: rgb(0,0,0);">Макет уведомление &quot;Изменения успешно сохранены&quot; отображающееся после успешного создания элемента;</span></li></ul>
<p>2. Дополнено описание работы кнопки &quot;Сохранить и создать новый&quot;.</p>
<p>Было:</p>
<p><ac:image ac:width="400"><ri:attachment ri:filename="image2023-7-18_18-45-19.png" /></ac:image></p>
<p>Стало:</p>
<p><ac:image ac:width="400"><ri:attachment ri:filename="image2023-7-18_18-36-56.png" /></ac:image></p>
<p>3. Дополнено описание кнопки &quot;Очистить все&quot;.</p>
<p>Было:</p>
<p><ac:image ac:width="800"><ri:attachment ri:filename="image2023-7-18_18-46-5.png" /></ac:image></p>
<p>Стало:</p>
<p><ac:image ac:width="800"><ri:attachment ri:filename="image2023-7-18_18-38-18.png" /></ac:image></p>
<p>4. Дополнено описание удаления для автосинхронизируемых списков.</p>
<p>Было:</p>
<p><ac:image ac:height="30"><ri:attachment ri:filename="image2023-7-18_18-46-34.png" /></ac:image></p>
<p>Стало:</p>
<p><ac:image ac:height="31"><ri:attachment ri:filename="image2023-7-18_18-40-34.png" /></ac:image></p></div></td>
<td><br /></td></tr>
<tr>
<td>03.08.2023</td>
<td><span style="color: rgb(51,51,153);">Скорректировано условие отправки команд в Ядро при редактировании элемента списка (при изменении поля &quot;Описание&quot; элемента списка в Ядро команды не отправлять, т.к. данное поле и не передается в Ядро)</span></td>
<td>
<div class="content-wrapper">
<p><ac:link><ri:user ri:userkey="8aa489ae658a1a0e01658a4775190002" /></ac:link></p></div></td></tr>
<tr>
<td>08.08.2023</td>
<td>
<p><span style="color: rgb(0,128,128);">Скорректировано описание заполнения полей Начала действия и Окончание действия при добавлении/редактировании элементов списка в соответствии с реализацией на фронте.</span></p>
<p><span style="color: rgb(0,128,128);">Скорректировано описание объектов доступа для Списков 2.0. в bo-user.</span></p></td>
<td><ac:link><ri:user ri:userkey="8aa489ae658a1a0e01658a4775190002" /></ac:link></td></tr>
<tr>
<td>31.08.2023</td>
<td><span style="color: rgb(128,128,0);">Уточнен формат времени при сохранении данных в БД и передаче сообщений в кафку.</span></td>
<td><ac:link><ri:user ri:userkey="8aa489ae658a1a0e01658a4775190002" /></ac:link></td></tr>
<tr>
<td>04.09.2023</td>
<td><span style="color: rgb(128,0,0);">Уточнено по итогам реализации</span></td>
<td><ac:link><ri:user ri:userkey="8aa489ae658a1a0e01658a4775190002" /></ac:link></td></tr>
<tr>
<td><span style="color: rgb(51,102,255);">26.09.2023</span></td>
<td><span style="color: rgb(51,102,255);">Добавлено уточнение по ролям доступа.</span></td>
<td><ac:link><ri:user ri:userkey="8aa489ae658a1a0e01658a4775190002" /></ac:link></td></tr>
<tr>
<td style="text-align: left;">4.12.2024&nbsp;</td>
<td style="text-align: left;">Модификация.<br />В рамках задачи<span>&nbsp;</span><a class="external-link" href="https://jira.delta.sbrf.ru/browse/AFPE-4246" rel="nofollow">https://jira.delta.sbrf.ru/browse/AFPE-4246</a>&nbsp;<br />убрали тип АМL = ПОД/ФТ&nbsp; и COMMON = общий для списков</td>
<td style="text-align: left;">
<div class="content-wrapper">
<p><ac:link><ri:user ri:userkey="8aae693a90939a0b019096bdcdd70006" /></ac:link>&nbsp;</p></div></td></tr>
<tr>
<td style="text-align: left;">30.04.2024</td>
<td style="text-align: left;">Изменения в части публикуемых сообщений в топик ROSTER-ELEMENT-UPDATES после нажатия кнопки &quot;Очистить все&quot; в списке.</td>
<td style="text-align: left;">
<div class="content-wrapper">
<p><br /></p></div></td></tr></tbody></table>
<h1>Глоссарий</h1>
<table class="relative-table wrapped" style="width: 33.1453%;">
<thead style="text-decoration: none;">
<tr>
<th style="text-align: left;">
<p>Термин</p></th>
<th style="text-align: left;">
<p>Определение</p></th></tr></thead><colgroup style="text-decoration: none;"><col style="width: 30.1136%;" /><col style="width: 69.8864%;" /></colgroup>
<tbody style="text-decoration: none;">
<tr>
<td style="text-align: left;">АРМ</td>
<td style="text-align: left;">Автоматизированное рабочее место.</td></tr>
<tr>
<td colspan="1">Список&nbsp;</td>
<td colspan="1"><span style="color: rgb(23,43,77);text-decoration: none;">Множество значений, сгруппированных по какому-либо бизнес смыслу. Например, черный или белые списки</span></td></tr></tbody></table>
<h1>Общие сведения</h1>
<h2>Описание доработки</h2>
<p>Необходимо реализовать возможность создавать списки 2.0 (далее - списки).</p>
<p>В рамках доработки необходимо реализовать:</p>
<ul>
<li>Дополнить выпадающий &quot;Правила и справочники&quot; разделом &quot;Списки 2.0&quot;;</li>
<li>Добавить журнал &quot;Списки 2.0&quot;;</li>
<li>Реализовать возможность создания, редактирования и удаления списка;</li>
<li>Реализовать возможность добавления, редактирования и удаления элементов списка;</li>
<li>Разработать API для:
<ul>
<li>создания / обновления / удаления списка;</li>
<li>добавления / редактирования / удаления элемента в списке;</li>
<li>просмотра списков в журнале списков;</li>
<li>просмотра карточки списка и его элементов.</li></ul></li>
<li>разработать интеграционное API для передачи в ядро добавленных / удаленных элементов списка и удаления самого списка.</li>
<li>Доработать БД для:
<ul>
<li>хранения данных списков и элементов списка.</li></ul></li></ul>
<p>Миграция текущих списков в &quot;Списки 2.0&quot; будет выполнена отдельной задачей.</p>
<p><br /></p>
<p>Разрешенные действия со списками / элементами списков.</p>
<table class="wrapped"><colgroup><col /><col /><col /><col /></colgroup>
<tbody>
<tr>
<th rowspan="3">Действия со списком / элементами списка<br /><br /></th>
<th colspan="3" style="text-align: center;">Ограничения списка</th></tr>
<tr>
<td rowspan="2"><strong><ac:inline-comment-marker ac:ref="030068a6-24e2-4b86-b09e-d1e063356c6f">*Список с признаком &quot;Автосинхронизации&quot;</ac:inline-comment-marker></strong></td>
<td colspan="2"><strong>Связь списка с правилом или онлайн-фактом</strong></td></tr>
<tr>
<td style="text-align: center;"><strong>Связь есть</strong></td>
<td colspan="1" style="text-align: center;"><strong>Связи нет</strong></td></tr>
<tr>
<td colspan="1"><ac:inline-comment-marker ac:ref="c111d434-c15d-4180-80d8-6d36f894c837">Редактирование списка</ac:inline-comment-marker></td>
<td colspan="1">-</td>
<td colspan="1">-</td>
<td colspan="1">
<p>+</p></td></tr>
<tr>
<td colspan="1">Удаление списка</td>
<td colspan="1">-</td>
<td colspan="1">-</td>
<td colspan="1">+</td></tr>
<tr>
<td colspan="1">Добавление элементов в список</td>
<td colspan="1">-</td>
<td colspan="1">+</td>
<td colspan="1">+</td></tr>
<tr>
<td colspan="1">Редактирование элементов списка</td>
<td colspan="1">-</td>
<td colspan="1">+</td>
<td colspan="1">+</td></tr>
<tr>
<td colspan="1">Удаление элементов в списке</td>
<td colspan="1">-</td>
<td colspan="1">
<p>+</p></td>
<td colspan="1">+</td></tr></tbody></table>
<p><br /></p>
<p>*Список с типом &quot;Автосинхронизации&quot; будет реализован в рамках отдельной задачи.&nbsp;</p>
<h2>Изменения в архитектуре системы&nbsp;</h2>
<p>Необходимо разработать функциональность работы со списками в сервисе bo-analytic (бывш. bo-attribute).</p>
<p>При этом текущую функциональность по спискам в bo-policy-list не отключаем. Миграция данных списков будет реализована отдельной задачей.</p>
<h1>Список компонентов&nbsp;</h1>
<p>Дорабатывается bo-analytic, bo-front.&nbsp;</p>
<h1>Функциональные требования</h1>
<h2>&nbsp;Журнал &quot;Списки 2.0&quot;</h2>
<table class="relative-table wrapped" style="width: 59.6172%;"><colgroup><col style="width: 18.1545%;" /><col style="width: 49.1251%;" /><col style="width: 32.6933%;" /></colgroup>
<tbody>
<tr>
<th colspan="1"><span style="color: rgb(0,0,0);">Компонент</span></th>
<td colspan="1"><strong>bo-front</strong></td>
<td colspan="1"><strong>bo-analytic</strong></td></tr>
<tr>
<th colspan="1"><span style="color: rgb(0,0,0);">GIT repository</span></th>
<td colspan="1"><ac:placeholder>указываем ссылку на репозиторий</ac:placeholder></td>
<td colspan="1"><br /></td></tr>
<tr>
<th colspan="1"><span style="color: rgb(0,0,0);">Ответственный за компонент</span></th>
<td colspan="1">
<div class="content-wrapper">
<p><ac:link><ri:user ri:userkey="8aae6c947eb1ba23017eb4f6b6290008" /></ac:link></p></div></td>
<td colspan="1">
<div class="content-wrapper">
<p><ac:link><ri:user ri:userkey="8aae692183e7caec0183ea7546c80000" /></ac:link></p></div></td></tr>
<tr>
<th colspan="1" style="text-align: left;"><span style="color: rgb(0,0,0);">Ссылка на задачу</span></th>
<td colspan="1" style="text-align: left;"><span style="color: rgb(112,112,112);"><span style="background-color: rgb(245,245,245);"><em>указываем ссылку на задачу в рамках которой разрабатывается/обновляется компонент</em></span></span></td>
<td colspan="1"><br /></td></tr></tbody></table>
<h3>&nbsp;Описание журнала &quot;Списки 2.0&quot;</h3>
<p>В рамках доработки необходимо добавить новый раздел &quot;Правила и справочники&quot; - &quot;Списки 2.0&quot;.</p>
<p>Макет раздела &quot;Списки 2.0&quot;</p>
<p><ac:image ac:width="400"><ri:attachment ri:filename="2023-06-20_16-45-44.png" /></ac:image></p>
<p><br /></p>
<p>Описание журнала &quot;Списки 2.0&quot;</p>
<p><span style="color: rgb(128,0,128);">По умолчанию значения в журнале отсортированы по полю &quot;Дата изменения&quot; (DESC).</span></p>
<table class="relative-table wrapped" style="width: 88.163%;"><colgroup><col style="width: 2.47148%;" /><col style="width: 11.0266%;" /><col style="width: 9.63245%;" /><col style="width: 46.3245%;" /><col style="width: 7.22433%;" /><col style="width: 23.3207%;" /></colgroup>
<thead>
<tr>
<th>№</th>
<th colspan="1">
<p>Наименование</p></th>
<th colspan="1">
<p>Тип отображения</p></th>
<th colspan="1">
<p>Описание</p></th>
<th colspan="1">
<p>Сортировка</p></th>
<th colspan="1">
<p>Фильтрация</p></th></tr></thead>
<tbody>
<tr>
<td>1</td>
<td>Чекбокс для выбора</td>
<td>Чекбокс</td>
<td>Необходим для массового выбора списков</td>
<td>Нет</td>
<td>Нет</td></tr>
<tr>
<td>2</td>
<td>Название</td>
<td>Текстовое поле</td>
<td>
<p>Название списка</p>
<p>Гиперссылка для перехода в карточку &quot;Список 2.0&quot;</p></td>
<td>Нет</td>
<td><ac:inline-comment-marker ac:ref="0a89a5e0-ecd4-4058-8e87-dca8ffebb514">Нет</ac:inline-comment-marker></td></tr>
<tr>
<td>3</td>
<td>Кол-во элементов</td>
<td>Числовое поле</td>
<td>
<div class="content-wrapper">
<p>Отображение счетчика количества элементов добавленных к списку.&nbsp;</p>
<p>В случае отсутствия в списке элементов, значение в поле должно выделяться оранжевым цветом&nbsp;<ac:image ac:thumbnail="true" ac:width="30"><ri:attachment ri:filename="image2023-7-5_16-40-13.png" /></ac:image></p></div></td>
<td><ac:inline-comment-marker ac:ref="d534c9ce-5c62-49f8-97cd-e37b0782ae6c">Да&nbsp;</ac:inline-comment-marker><span style="color: rgb(23,43,77);"><ac:inline-comment-marker ac:ref="d534c9ce-5c62-49f8-97cd-e37b0782ae6c">(ASC/DESC)</ac:inline-comment-marker></span></td>
<td>Нет</td></tr>
<tr>
<td colspan="1">4</td>
<td colspan="1">Автосинхронизация</td>
<td colspan="1">Иконка</td>
<td colspan="1">
<div class="content-wrapper">
<p>Отображается наличие&nbsp;<ac:image ac:thumbnail="true" ac:width="28"><ri:attachment ri:filename="image2023-6-14_15-37-24.png" /></ac:image>&nbsp;&nbsp;или отсутствие&nbsp;<ac:image ac:thumbnail="true" ac:width="24"><ri:attachment ri:filename="image2023-4-27_12-16-57.png" /></ac:image>&nbsp;автосинхронизации списка из других источников</p></div></td>
<td colspan="1">Нет</td>
<td colspan="1"><ac:inline-comment-marker ac:ref="da60a35c-9268-4115-8b31-32856ec48a8a">Да <span style="color: rgb(128,0,128);">(селект из 2х полей - Список с автосинхронизацией / Список без автосинхронизации)</span></ac:inline-comment-marker></td></tr>
<tr>
<td colspan="1">5</td>
<td colspan="1">Тип данных</td>
<td colspan="1">Текстовое поле</td>
<td colspan="1">Отображение типа данных выбранного для списка&nbsp;</td>
<td colspan="1">Нет</td>
<td colspan="1"><ac:inline-comment-marker ac:ref="312b0a7e-e625-40ee-9bbd-480e3b70e1b0">Да <span style="color: rgb(128,0,128);">(мультиселект, сейчас доступно единственное значение - String)</span></ac:inline-comment-marker></td></tr>
<tr>
<td colspan="1">6</td>
<td colspan="1">Финансовый институт</td>
<td colspan="1">Текстовое поле</td>
<td colspan="1">Отображение название &quot;Финансового института&quot; выбранного для списка</td>
<td colspan="1">Нет</td>
<td colspan="1">Нет</td></tr>
<tr>
<td>7</td>
<td>Тип списка</td>
<td>Текстовое поле</td>
<td>Отображение типа списка выбранного для списка</td>
<td>Нет</td>
<td><ac:inline-comment-marker ac:ref="21db8a37-01dd-4f1c-ae5c-50f0b1b551ba"><ac:inline-comment-marker ac:ref="21db8a37-01dd-4f1c-ae5c-50f0b1b551ba"><span style="color: rgb(128,0,128);">Да&nbsp;</span><span style="color: rgb(128,0,128);">(мультиселект из значений типа списка:&nbsp;</span></ac:inline-comment-marker></ac:inline-comment-marker>
<ul>
<li><s><span style="color: rgb(128,0,128);">Общий</span></s></li>
<li><span style="color: rgb(128,0,128);">Антифрод</span></li>
<li><s><span style="color: rgb(128,0,128);">ПОД/ФТ)</span></s></li></ul></td></tr>
<tr>
<td>8</td>
<td>Связь с правилами</td>
<td>Иконка</td>
<td>
<div class="content-wrapper">
<p>Отображается наличие &nbsp;<ac:image ac:thumbnail="true" ac:width="24"><ri:attachment ri:filename="image2023-4-27_12-16-15.png" /></ac:image>&nbsp;или отсутствие&nbsp;<ac:image ac:thumbnail="true" ac:width="24"><ri:attachment ri:filename="image2023-4-27_12-16-57.png" /></ac:image>&nbsp;связи списка с правилами</p></div></td>
<td>Нет</td>
<td>Нет</td></tr>
<tr>
<td colspan="1">9</td>
<td colspan="1">Связь с онлайн-фактами</td>
<td colspan="1">Иконка</td>
<td colspan="1">
<div class="content-wrapper">
<p>Отображается наличие &nbsp;<ac:image ac:thumbnail="true" ac:width="24"><ri:attachment ri:filename="image2023-4-27_12-16-15.png" /></ac:image>&nbsp;или отсутствие&nbsp;<ac:image ac:thumbnail="true" ac:width="24"><ri:attachment ri:filename="image2023-4-27_12-16-57.png" /></ac:image>&nbsp;связи списка с онлайн-фактами</p></div></td>
<td colspan="1">Нет</td>
<td colspan="1">Нет</td></tr>
<tr>
<td>10</td>
<td>Изменено</td>
<td>Текстовое поле</td>
<td>Отображается ФИО сотрудника, который последним изменил список</td>
<td><span style="color: rgb(128,0,128);">Нет</span></td>
<td><span style="color: rgb(128,0,128);">Нет</span></td></tr>
<tr>
<td>11</td>
<td>Дата изменения</td>
<td>Текстовое поле</td>
<td>Отображается дата последнего изменения списка</td>
<td>Да&nbsp;<span style="color: rgb(23,43,77);">(ASC/DESC)</span></td>
<td>Нет</td></tr>
<tr>
<td>12</td>
<td>Боковое меню</td>
<td>Меню действий</td>
<td>
<div class="content-wrapper">
<p>При нажатии отображаются действия доступные со списком:</p>
<ul style="list-style-type: square;">
<li>удалить</li></ul>
<p>Кнопка &quot;Удалить&quot; недоступна для списков с признаком Автосинхронизации (list.autosync=true)<span style="color: rgb(51,102,255);">&nbsp;и при отсутствии полных прав доступа к данному типу списка.</span></p></div></td>
<td>Нет</td>
<td>Нет</td></tr>
<tr>
<td colspan="1">13</td>
<td colspan="1">Кнопка &quot;Создать&quot;</td>
<td colspan="1">Кнопка</td>
<td colspan="1">
<p>при нажатии осуществляется переход в модальное окно &quot;Создание списка&quot;</p>
<p><span style="color: rgb(51,102,255);">Кнопка недоступна для нажатия при отсутствии полных прав доступа ко всем типам списков.</span></p></td>
<td colspan="1"><br /></td>
<td colspan="1"><br /></td></tr>
<tr>
<td colspan="1">14</td>
<td colspan="1">Поиск</td>
<td colspan="1">Текстовое поле</td>
<td colspan="1">Поле со строкой поиска по &quot;названию&quot; списка <span style="color: rgb(128,0,128);">(like)</span></td>
<td colspan="1"><br /></td>
<td colspan="1"><br /></td></tr>
<tr>
<td colspan="1">15</td>
<td colspan="1">Фильтр</td>
<td colspan="1">Кнопка</td>
<td colspan="1">
<div class="content-wrapper">
<p>Кнопка&nbsp;<ac:image ac:thumbnail="true" ac:width="30"><ri:attachment ri:filename="image2023-7-7_12-15-25.png" /></ac:image>, при нажатии на которую отображается кнопка&nbsp;<ac:image ac:thumbnail="true" ac:width="30"><ri:attachment ri:filename="image2023-7-7_12-16-3.png" /></ac:image><span style="color: rgb(255,0,0);"><span style="color: rgb(0,0,0);">, открывающая выпадающий список с</span></span><span style="color: rgb(0,0,0);">&nbsp;</span>параметрами, по которым можно осуществить фильтрацию</p></div></td>
<td colspan="1"><br /></td>
<td colspan="1"><br /></td></tr></tbody></table>
<p><span style="color: rgb(0,0,0);"><strong>Макет Журнал &quot;Списки 2.0&quot;&nbsp;</strong></span></p>
<p><ac:image ac:width="1000"><ri:attachment ri:filename="image2023-7-18_12-51-51.png" /></ac:image></p>
<p><span style="color: rgb(0,0,0);"><strong>Макет&nbsp;Журнала &quot;Списки 2.0&quot; с отображением выпадающего списка&nbsp;с&nbsp;параметрами, по которым можно осуществить фильтрацию</strong></span></p>
<p><strong><span style="color: rgb(255,0,0);"><span style="color: rgb(0,0,0);"><ac:image ac:width="1000"><ri:attachment ri:filename="image2023-7-18_12-54-14.png" /></ac:image></span></span></strong></p>
<p><br /></p>
<p><span style="color: rgb(0,0,0);"><strong>Макет&nbsp;Журнала &quot;Списки 2.0&quot; с отображением всех доступных фильтров</strong></span></p>
<p><span style="color: rgb(0,0,0);"><strong><ac:image ac:width="1000"><ri:attachment ri:filename="image2023-7-18_18-33-13.png" /></ac:image></strong></span></p>
<p><br /></p>
<p><span style="color: rgb(0,0,0);"><strong>Макет&nbsp;Журнала &quot;Списки 2.0&quot; с примером отображения мультиселекта для выбора в фильтре&nbsp;&nbsp;</strong></span></p>
<p><ac:image ac:width="1000"><ri:attachment ri:filename="image2023-7-18_18-33-32.png" /></ac:image></p>
<p><br /></p>
<p>Для просмотра журнала списков необходимо реализовать следующие operationId:</p>
<table class="wrapped"><colgroup><col /><col /><col /><col /><col /></colgroup>
<thead>
<tr>
<th colspan="1">Компонент</th>
<th style="text-align: left;">
<p>OperationId</p></th>
<th style="text-align: left;">
<p>Описание</p></th>
<th colspan="1" style="text-align: left;">
<p>Тип API</p></th>
<th style="text-align: left;">
<p>Что делаем</p></th></tr></thead>
<tbody>
<tr>
<td colspan="1">bo-analytic /list</td>
<td style="text-align: left;">getListPage</td>
<td style="text-align: left;">
<p>Получить страницу журнала списков</p></td>
<td colspan="1" style="text-align: left;">Внешнее</td>
<td style="text-align: left;">Отображение всех данных из таблицы bo-analytic.lists с возможностью настраиваемой пользователем фильтрации и сортировки</td></tr></tbody></table>
<h2>&nbsp;Создание списка</h2>
<p><strong>Макет пустого модального окна &quot;<ac:inline-comment-marker ac:ref="11686e72-9e84-4049-9eb7-e04e0e3e117a">Создание списка</ac:inline-comment-marker>&quot;</strong></p>
<p><ac:image ac:width="500"><ri:attachment ri:filename="2023-08-28_16-33-08.png" /></ac:image></p>
<p><strong>Макет заполненного модального окна &quot;Создание списка&quot;</strong></p>
<p><ac:image ac:width="500"><ri:attachment ri:filename="2023-08-28_16-39-53.png" /></ac:image></p>
<p><span style="color: rgb(0,0,0);"><strong>Макет&nbsp;ошибка &quot;Сущность с таким именем уже существует&quot; для модального окна &quot;Создание списка&quot;</strong></span></p>
<p><ac:image ac:width="500"><ri:attachment ri:filename="2023-08-28_16-40-35.png" /></ac:image></p>
<p><span style="color: rgb(0,0,0);"><strong>Макет </strong><strong>уведомление</strong><strong>&nbsp;&quot;Список &ldquo;Название списка&rdquo; успешно создан&quot;,&nbsp;после нажатия на кнопку &quot;Сохранить и создать новый&quot; для модального окна &quot;Создание списка&quot;</strong></span></p>
<p><ac:image ac:width="1000"><ri:attachment ri:filename="2023-08-28_16-42-54.png" /></ac:image></p>
<p>Описание модального окна &quot;Создание списка&quot;</p>
<table class="relative-table wrapped" style="width: 96.5769%;"><colgroup><col style="width: 2.0164%;" /><col style="width: 7.75211%;" /><col style="width: 6.68997%;" /><col style="width: 6.95551%;" /><col style="width: 21.7148%;" /><col style="width: 19.1147%;" /><col style="width: 35.7336%;" /></colgroup>
<thead>
<tr>
<th style="text-align: left;">№</th>
<th colspan="1" style="text-align: left;">
<p>Наименование</p></th>
<th colspan="1" style="text-align: left;">
<p>Тип отображения</p></th>
<th colspan="1" style="text-align: left;">
<p>Обязательность</p></th>
<th colspan="1" style="text-align: left;">
<p>Описание, проверка</p></th>
<th colspan="1" style="text-align: left;">
<p>Источник данных</p></th>
<th colspan="1">Валидация на bo-front и в bo-analytic</th></tr></thead>
<tbody>
<tr>
<td>1</td>
<td>Название</td>
<td>Текстовое поле</td>
<td>Да</td>
<td>
<ul>
<li>Максимум 255 символов</li>
<li>Русские и латинские буквы, цифры, специальные символы только: ! # $ % &amp; ( ) * + , - = ? @ ^ _ { | } ~&quot; и пробел</li>
<li>В начале и в конце названия не должно быть пробелов</li>
<li>В названии не должно быть двух и более пробелов подряд</li></ul></td>
<td>Пользователь</td>
<td colspan="1">
<div class="content-wrapper">
<p><u>При сохранении</u> списка выполняется проверка на уникальность имени списка.&nbsp;</p>
<p>Если введенное название совпадает с названием списка 2.0,&nbsp; то на экран выводится ошибка &quot;Сущность с таким именем уже существует&quot;.&nbsp;</p></div>
<p><br /></p></td></tr>
<tr>
<td colspan="1">2</td>
<td colspan="1">Тип данных</td>
<td colspan="1">Выпадающий список</td>
<td colspan="1">Да</td>
<td colspan="1">
<p>Допустимые значения:</p>
<ul>
<li>String</li></ul></td>
<td colspan="1">Используются сохраненные допустимые значения</td>
<td colspan="1"><br /></td></tr>
<tr>
<td>3</td>
<td>Тип списка</td>
<td>Выпадающий список</td>
<td>Да</td>
<td>
<p>Допустимые значения:</p>
<ul>
<li><s>Общий</s></li>
<li>Антифрод</li>
<li><s>ПОД/ФТ</s></li></ul>
<p><span style="color: rgb(51,102,255);">В выпадающем списке отображаются только те типы, списков, к которым у пользователя есть полный доступ.</span></p></td>
<td>Используются сохраненные допустимые значения</td>
<td colspan="1"><br /></td></tr>
<tr>
<td>4</td>
<td>Финансовый институт</td>
<td>Выпадающий список</td>
<td>Да</td>
<td>Допустимые значения ФИ, доступные для текущего Пользователя.</td>
<td>
<p>Данные запрашиваются&nbsp;после аутентификации пользователя и хранятся в кеше ( localstorage под ключом userInfo). Текущий сервис bo-user GET/external/v1/user/{id}</p></td>
<td colspan="1"><br /></td></tr>
<tr>
<td colspan="1">5</td>
<td colspan="1">Сохранить и создать новый</td>
<td colspan="1">Кнопка</td>
<td colspan="1"><br /></td>
<td colspan="1">
<p>При нажатии на кнопку сохраняются введенные пользователем параметры списка в таблицу&nbsp;bo-analytic.lists и отображается пустое модальное окно &quot;Создать список&quot; и <span style="color: rgb(0,0,0);">уведомление&nbsp;&quot;Список &ldquo;Название списка&rdquo; успешно создан&quot;.</span></p>
<p><br /></p></td>
<td colspan="1"><br /></td>
<td colspan="1">Кнопка неактивна при незаполненных обязательных полях на странице.&nbsp;</td></tr>
<tr>
<td colspan="1">6</td>
<td colspan="1"><ac:inline-comment-marker ac:ref="6d614034-862e-4101-a1c2-935e15e84704">Создать</ac:inline-comment-marker></td>
<td colspan="1">Кнопка</td>
<td colspan="1"><br /></td>
<td colspan="1">
<p>При нажатии на кнопку сохраняются введенные пользователем параметры списка в таблицу&nbsp;bo-analytic.lists</p></td>
<td colspan="1"><br /></td>
<td colspan="1">Кнопка неактивна при незаполненных обязательных полях на странице.&nbsp;</td></tr>
<tr>
<td colspan="1">7</td>
<td colspan="1">Отменить</td>
<td colspan="1">Кнопка</td>
<td colspan="1"><br /></td>
<td colspan="1">
<p>При нажатии на кнопку модальное окно закрывается, данные не сохраняются</p>
<p>Кнопка активна всегда</p></td>
<td colspan="1"><br /></td>
<td colspan="1"><br /></td></tr></tbody></table>
<p>Для создания нового списка необходимо реализовать следующие operationId:</p>
<table class="wrapped"><colgroup><col /><col /><col /><col /><col /></colgroup>
<thead>
<tr>
<th colspan="1">Компонент</th>
<th style="text-align: left;">
<p>OperationId</p></th>
<th style="text-align: left;">
<p>Описание</p></th>
<th colspan="1" style="text-align: left;">
<p>Тип API</p></th>
<th style="text-align: left;">
<p>Что делаем</p></th></tr></thead>
<tbody>
<tr>
<td colspan="1">bo-analytic /list</td>
<td colspan="1" style="text-align: left;">createList</td>
<td colspan="1" style="text-align: left;">Создать список</td>
<td colspan="1" style="text-align: left;">Внешнее</td>
<td colspan="1" style="text-align: left;">
<p>Сохраняем новый список в таблицу&nbsp;bo-analytic.lists</p>
<p>При сохранении в бэк выполняется подмена значений &quot;Тип списка&quot;:</p>
<ul>
<li><s>Общий&nbsp;&rarr;&nbsp;COMMON</s></li>
<li>Антифрод&nbsp;&rarr;&nbsp;ANTIFRAUD</li>
<li><s>ПОД/ФТ&nbsp;&rarr;&nbsp;AML</s></li></ul>
<p>Параметр autosync по умолчанию заполняется false.</p></td></tr></tbody></table>
<h2>&nbsp;Просмотр карточки &quot;Список&quot;</h2>
<p><span style="color: rgb(0,0,0);"><strong>Макет карточки &quot;Список&quot; без элементов списка</strong></span></p>
<p><ac:image ac:width="1000"><ri:attachment ri:filename="image2023-7-18_15-51-47.png" /></ac:image></p>
<p><br /></p>
<p><span style="color: rgb(0,0,0);"><strong>Макет карточки &quot;Список&quot; с признаком автосинхронизации</strong></span></p>
<p><ac:image ac:width="1000"><ri:attachment ri:filename="image2023-7-18_15-56-22.png" /></ac:image></p>
<p>Описание карточки &quot;Список&quot;<ac:structured-macro ac:name="anchor" ac:schema-version="1" ac:macro-id="78ab7f4b-cc10-49ae-8ad7-769b28e80626"><ac:parameter ac:name="">Описание карточки &quot;Список&quot;</ac:parameter></ac:structured-macro></p>
<table class="relative-table wrapped"><colgroup><col style="width: 33.0px;" /><col style="width: 195.0px;" /><col style="width: 218.0px;" /><col style="width: 403.0px;" /></colgroup>
<tbody>
<tr>
<td colspan="1"><br /></td>
<td colspan="1"><strong>Наименование</strong></td>
<td colspan="1"><strong>Тип отображения</strong></td>
<td colspan="1"><strong>Описание, проверка</strong></td></tr>
<tr>
<td colspan="3">Если на списке есть признак Автосинхронизации, то выше раздела Параметры выводится информационное сообщение &quot;Список автоматически синхронизируется. Все корректировки обновятся в течении 24 часов&quot;.&nbsp;</td>
<td colspan="1"><br /></td></tr>
<tr>
<td colspan="3"><span>Раздел &quot;Параметры&quot;</span></td>
<td><br /></td></tr>
<tr>
<td colspan="1">1</td>
<td>Название</td>
<td>Текстовое поле</td>
<td><a href="http://list.name">list.name</a></td></tr>
<tr>
<td colspan="1">2</td>
<td>Тип данных</td>
<td>Текстовое поле</td>
<td><ac:inline-comment-marker ac:ref="3dfeebe8-a08d-4e53-87f9-fd0188970ab4">list.itemsType</ac:inline-comment-marker></td></tr>
<tr>
<td colspan="1">3</td>
<td>Тип списка</td>
<td>Текстовое поле</td>
<td>
<p>list.type</p></td></tr>
<tr>
<td colspan="1">4</td>
<td>Описание</td>
<td>Текстовое поле</td>
<td>
<p>list.description</p></td></tr>
<tr>
<td colspan="1">5</td>
<td>Финансовый институт</td>
<td>Текстовое поле</td>
<td>
<p>list.fi_name</p></td></tr>
<tr>
<td colspan="1">6</td>
<td>Создан</td>
<td>Текстовое поле</td>
<td>
<p>created_by и created через пробел</p>
<p>created_by - (ФИО пользователя) - гиперссылка для перехода в карточку &quot;Параметры&quot;, содержащую&nbsp;информацию о пользователе</p></td></tr>
<tr>
<td colspan="1">7</td>
<td>Обновлен</td>
<td>Текстовое поле</td>
<td>
<p>updated_by и updated&nbsp;через пробел</p>
<p>updated_by - (ФИО пользователя) - гиперссылка для перехода в карточку &quot;Параметры&quot;, содержащую&nbsp;информацию о пользователе</p></td></tr>
<tr>
<td colspan="1">8</td>
<td colspan="1">Кнопка &quot;Карандаш&quot;</td>
<td colspan="1">Кнопка</td>
<td colspan="1">
<p title="">Кнопка для перехода в карточку &quot;Редактирование списка&quot;.</p>
<p title="">Кнопка &quot;Редактировать&quot; не доступна, если:</p>
<ul title="">
<li>список используется в правилах или онлайн-фактах (хотя бы одно из полей <span class="name" style="color: rgb(23,43,77);" title="usedInOnlineFacts">usedInOnlineFacts или&nbsp;</span><span class="name" style="color: rgb(23,43,77);" title="usedInOnlineFacts"><span style="color: rgb(32,33,36);"><span class="name" title="usedInRules">usedInRules имеют значение&nbsp;</span></span></span>true);</li>
<li>для списков с признаком Автосинхронизации (list.autosync=true), для таких списков кнопка &quot;Редактировать&quot; не отображается;</li>
<li><span style="color: rgb(51,102,255);">кнопка не доступна, если у пользователя нет полного доступа к выбранному типу списка.</span></li></ul></td></tr>
<tr>
<td colspan="1">9</td>
<td colspan="1">Кнопка &quot;Удалить&quot;</td>
<td colspan="1">Кнопка</td>
<td colspan="1">
<p title="">Кнопка для удаление списка.</p>
<p title="">Кнопка &quot;Удалить&quot; не доступна, если:</p>
<ul title="">
<li>список используется в правилах или онлайн-фактах (хотя бы одно из полей <span class="name" style="color: rgb(23,43,77);" title="usedInOnlineFacts">usedInOnlineFacts или&nbsp;</span><span class="name" style="color: rgb(23,43,77);" title="usedInOnlineFacts"><span style="color: rgb(32,33,36);"><span class="name" title="usedInRules">usedInRules имеют значение&nbsp;</span></span></span>true);</li>
<li><ac:inline-comment-marker ac:ref="9a4a8b06-05a1-4efc-8e42-ce7ef5981843">для списков с признаком Автосинхронизации</ac:inline-comment-marker> (list.autosync=true), для таких списков кнопка &quot;Удалить&quot; не отображается;</li>
<li><span style="color: rgb(51,102,255);">кнопка не доступна, если у пользователя нет полного доступа к выбранному типу списка.</span></li></ul></td></tr>
<tr>
<td colspan="3"><strong>Элементы списка</strong></td>
<td>
<p>Рядом с названием отображается счетчик количества элементов, входящих в данный список</p>
<p>При создании нового списка раздел &quot;Элементы списка&quot; не заполнен, так как элементы добавляются в список по кнопке &quot;Добавить&quot;.</p>
<p>Добавление элементов в список не доступно, только для списка с признаком автосинхронизации.&nbsp;</p>
<p><span style="color: rgb(128,0,128);">По умолчанию элементы в списке отсортированы по Значению (ASC)</span></p></td></tr>
<tr>
<td colspan="1">1</td>
<td colspan="1">Чекбокс</td>
<td colspan="1">Чекбокс</td>
<td colspan="1">
<p>Необходим для массового выбора элементов списка</p>
<p><span style="color: rgb(51,102,255);">Чек-бокс не отображается</span></p>
<ul>
<li><span style="color: rgb(51,102,255);">для списков с признаком Автосинхронизации (list.autosync=true),</span></li>
<li><span style="color: rgb(51,102,255);">если у пользователя нет полного доступа к выбранному типу списка.</span></li></ul></td></tr>
<tr>
<td colspan="1">2</td>
<td colspan="1">Значение</td>
<td colspan="1">Текстовое поле</td>
<td colspan="1">Значение из list_item.value1</td></tr>
<tr>
<td colspan="1">3</td>
<td colspan="1">Описание&nbsp;</td>
<td colspan="1">Текстовое поле</td>
<td colspan="1">Значение из list_item.description</td></tr>
<tr>
<td colspan="1">4</td>
<td colspan="1">Начало действия</td>
<td colspan="1">Текстовое поле</td>
<td colspan="1">Значение из <ac:inline-comment-marker ac:ref="48c31a6d-a1db-4478-83dc-f6e7876b380d">list_item.ttl_from. В интерфейсе отображается в часовом поясе пользователя, в БД хранится в UTC 0.&nbsp;</ac:inline-comment-marker></td></tr>
<tr>
<td colspan="1">5</td>
<td colspan="1">Окончание действия</td>
<td colspan="1">Текстовое поле</td>
<td colspan="1">Значение из list_item.ttl_to.&nbsp;В интерфейсе отображается в часовом поясе пользователя, в БД хранится в UTC 0.&nbsp;</td></tr>
<tr>
<td colspan="1">6</td>
<td colspan="1">Кнопка &quot;Добавить&quot;</td>
<td colspan="1">Кнопка</td>
<td colspan="1">
<p>Открывает модальное окно &quot;Добавление элемента списка&quot;.</p>
<p>Кнопка добавить не <span style="color: rgb(51,102,255);">отображается</span>:</p>
<ul>
<li>для списков с признаком Автосинхронизации (list.autosync=true) и&nbsp;</li>
<li><span style="color: rgb(51,102,255);">если у пользователя нет полного доступа к выбранному типу списка.</span></li></ul></td></tr>
<tr>
<td colspan="1">7</td>
<td colspan="1">Поиск</td>
<td colspan="1">Текстовое поле</td>
<td colspan="1">Поле для контекстного поиска по названию элемента списка (list_item.value1)&nbsp;</td></tr>
<tr>
<td colspan="1">8</td>
<td colspan="1">Очистить всё</td>
<td colspan="1">Кнопка</td>
<td colspan="1">
<p>При нажатии на кнопку, должно отображаться подтверждение удаления. В случае подтверждения все элементы списка должны удаляться.</p>
<p>Кнопка должна быть недоступна, в случаях:</p>
<ul>
<li>если в списке нет элементов;</li>
<li>для списков с признаком Автосинхронизации,<span style="color: rgb(0,0,0);"> для таких списков кнопка не отображается;</span></li>
<li><span style="color: rgb(51,102,255);">если у пользователя нет полного доступа к выбранному типу списка.</span></li></ul></td></tr></tbody></table>
<p>Для просмотра карточки &quot;Список 2.0&quot; необходимо реализовать следующие operationId:</p>
<table class="wrapped">
<thead>
<tr>
<th>Компонент</th>
<th style="text-align: left;">
<p>OperationId</p></th>
<th colspan="1">Endpoint</th>
<th style="text-align: left;">
<p>Описание</p></th>
<th style="text-align: left;">
<p>Тип API</p></th>
<th style="text-align: left;">
<p>Что делаем</p></th></tr>
<tr>
<td colspan="1">bo-analytic /list</td>
<td colspan="1">getListById</td>
<td colspan="1">
<p>/external/v2/list/{id}</p>
<p>GET</p></td>
<td colspan="1">Получить список по идентификатору</td>
<td colspan="1">Внешнее</td>
<td colspan="1">Получаем данные из таблицы&nbsp;bo-analytic.lists по id списка&nbsp;</td></tr>
<tr>
<td colspan="1">bo-analytic /list</td>
<td colspan="1">getListItemPage</td>
<td colspan="1">
<p>/external/v2/list-item</p>
<p>GET</p></td>
<td colspan="1">Получить страницу элементов списка</td>
<td colspan="1">Внешнее</td>
<td colspan="1">Получаем данные из таблицы&nbsp;bo-analytic.list_items по list_id списка&nbsp;</td></tr></thead></table>
<h2>Редактирование Списка 2.0</h2>
<p><span style="color: rgb(0,0,0);"><strong>Макет модального окна &quot;Редактирование </strong></span><strong>списка&quot;</strong><strong> без&nbsp;</strong><strong>элементов</strong></p>
<p><ac:image ac:width="1000"><ri:attachment ri:filename="image2023-7-18_16-9-20.png" /></ac:image></p>
<p><span style="color: rgb(0,0,0);"><strong>Макет модального окна &quot;Редактирование списка&quot; с элементами&nbsp;</strong></span></p>
<p><span style="color: rgb(255,0,0);"><strong><ac:image ac:width="1000"><ri:attachment ri:filename="image2023-7-18_16-10-10.png" /></ac:image></strong></span></p>
<p><br /></p>
<p><span style="color: rgb(0,0,0);"><strong>Макет информационное сообщение&nbsp;&nbsp;&quot;Объект связан с другими элементами системы&quot;, при наведении на кнопку &quot;Редактировать&quot; для списка, у которого есть связь с другими сущностями</strong></span></p>
<p><strong><span style="color: rgb(255,0,0);"><ac:image ac:width="1000"><ri:attachment ri:filename="image2023-7-18_16-25-8.png" /></ac:image></span></strong></p>
<p><span style="color: rgb(0,0,0);"><strong>Макет информационное сообщение&nbsp;&nbsp;&quot;Объект связан с другими элементами системы&quot;, при наведении на кнопку &quot;Удалить&quot; для списка, у которого есть связь с другими сущностями</strong></span></p>
<p><span style="color: rgb(0,0,0);"><strong><ac:image ac:width="1000"><ri:attachment ri:filename="image2023-7-18_16-25-56.png" /></ac:image></strong></span></p>
<p><br /></p><ac:structured-macro ac:name="note" ac:schema-version="1" ac:macro-id="ec2f1078-8b0a-467d-8cb2-67baa73e0658"><ac:parameter ac:name="title">Важно</ac:parameter><ac:rich-text-body>
<p>Редактирование списка не возможно, если:</p>
<ul>
<li>список используется в правилах или онлайн-фактах (хотя бы одно из полей <span class="name" style="color: rgb(23,43,77);" title="usedInOnlineFacts">usedInOnlineFacts или&nbsp;</span><span class="name" style="color: rgb(23,43,77);" title="usedInOnlineFacts"><span style="color: rgb(32,33,36);"><span class="name" title="usedInRules">usedInRules имеют значение&nbsp;</span></span></span>true) - кнопка&nbsp;&quot;Редактировать&quot; не доступна, появляется информационное сообщение &quot;Объект связан с другими элементами системы&quot;.</li>
<li>список с признаком Автосинхронизации (list.autosync=true) - кнопка &quot;Редактировать&quot; <ac:inline-comment-marker ac:ref="ffe2e447-40f9-4c1f-b5be-aa0bbec0eff3">не отображается</ac:inline-comment-marker></li>
<li><span style="color: rgb(51,102,255);">если у пользователя нет полного доступа к выбранному типу списка, кнопка &quot;Редактировать&quot; не отображается.</span></li></ul></ac:rich-text-body></ac:structured-macro>
<p>Описание модального окна &quot;Редактирование списка&quot;.</p>
<table class="relative-table wrapped" style="width: 75.9184%;"><colgroup><col style="width: 3.71504%;" /><col style="width: 8.39902%;" /><col style="width: 8.71457%;" /><col style="width: 8.84947%;" /><col style="width: 9.12045%;" /><col style="width: 32.4946%;" /><col style="width: 11.9229%;" /><col style="width: 16.7593%;" /></colgroup>
<thead>
<tr>
<th>№</th>
<th colspan="1">
<p>Наименование</p></th>
<th colspan="1">
<p>Тип отображения</p></th>
<th colspan="1">
<p>Обязательность</p></th>
<th colspan="1">Возможность и условия редактирования</th>
<th colspan="1">
<p>Описание, проверка</p></th>
<th colspan="1">
<p>Источник данных</p></th>
<th colspan="1">Валидация на bo-front и в bo-analytic</th></tr></thead>
<tbody>
<tr>
<td>1</td>
<td>Название</td>
<td>Текстовое поле</td>
<td>Да</td>
<td colspan="1">Да</td>
<td>
<ul title="">
<li>Максимум 255 символов</li>
<li>Русские и латинские буквы, цифры, специальные символы только: ! # $ % &amp; ( ) * + , - = ? @ ^ _ { | } ~&quot; и пробел</li>
<li>В начале и в конце названия не должно быть пробелов</li>
<li>В названии не должно быть двух и более пробелов подряд</li></ul></td>
<td>Пользователь</td>
<td colspan="1">
<p title=""><u>При сохранении</u> списка выполняется проверка на уникальность имени списка.&nbsp;</p>
<p title="">Если введенное название совпадает с названием атрибута, списка,&nbsp; то на экран выводится ошибка &quot;Сущность с таким именем уже существует&quot;.&nbsp;</p></td></tr>
<tr>
<td colspan="1">2</td>
<td colspan="1">Тип данных</td>
<td colspan="1">Выпадающий список</td>
<td colspan="1">Да</td>
<td colspan="1">Нельзя редактировать, если список содержит хотя бы 1 элемент.</td>
<td colspan="1">
<p>Допустимые значения:</p>
<ul>
<li>String</li></ul></td>
<td colspan="1">Используются сохраненные допустимые значения</td>
<td colspan="1"><br /></td></tr>
<tr>
<td>3</td>
<td>Тип списка</td>
<td>Выпадающий список</td>
<td>Да</td>
<td colspan="1">Да</td>
<td>
<p>Допустимые значения:</p>
<ul>
<li><s>Общий</s></li>
<li>Антифрод</li>
<li><s>ПОД/ФТ</s></li></ul>
<p><span style="color: rgb(51,102,255);">В выпадающем списке отображаются только те типы, списков, к которым у пользователя есть полный доступ.</span></p></td>
<td>Используются сохраненные допустимые значения</td>
<td colspan="1"><br /></td></tr>
<tr>
<td colspan="1">4</td>
<td colspan="1">Описание</td>
<td colspan="1">Текстовое поле</td>
<td colspan="1">Нет</td>
<td colspan="1">Да</td>
<td colspan="1">
<p>Многострочное текстовое поле ввода.</p>
<p>Максимум 2000 символов</p></td>
<td colspan="1">Пользователь</td>
<td colspan="1"><br /></td></tr>
<tr>
<td>5</td>
<td>Финансовый институт</td>
<td>Выпадающий список</td>
<td>Да</td>
<td colspan="1">Да</td>
<td>Допустимые значения ФИ, доступные для текущего Пользователя.</td>
<td>
<p>Данные запрашиваются&nbsp;после аутентификации пользователя и хранятся в кеше ( localstorage под ключом userInfo). Текущий сервис&nbsp;bfp-bo-user</p>
<p>GET/external/v1/user/{id}</p></td>
<td colspan="1"><br /></td></tr>
<tr>
<td colspan="1">6</td>
<td colspan="1">Кнопка &quot;Сохранить&quot;</td>
<td colspan="1">Кнопка</td>
<td colspan="1"><br /></td>
<td colspan="1"><br /></td>
<td colspan="1">
<p>При нажатии на кнопку сохраняются введенные пользователем параметры списка в таблицу&nbsp;bo-analytic.lists.</p>
<p>Далее осуществляется <ac:inline-comment-marker ac:ref="7ff0562c-6c61-48e3-8f56-e4f96ce64127">возврат<span style="color: rgb(128,0,0);"> в карточку списка.</span></ac:inline-comment-marker></p></td>
<td colspan="1"><br /></td>
<td colspan="1">Кнопка неактивна при незаполненных обязательных полях на странице.&nbsp;</td></tr>
<tr>
<td colspan="1">7</td>
<td colspan="1">Отменить</td>
<td colspan="1">Кнопка</td>
<td colspan="1"><br /></td>
<td colspan="1">
<p><br /></p></td>
<td colspan="1">
<p>При нажатии на кнопку модальное окно закрывается, данные не сохраняются.</p>
<p>Далее осуществляется <ac:inline-comment-marker ac:ref="53f168db-c547-41be-b7c5-f6894f491d88">возврат&nbsp;<span style="color: rgb(128,0,0);"> в карточку списка.</span></ac:inline-comment-marker></p>
<p>Кнопка активна всегда</p></td>
<td colspan="1"><br /></td>
<td colspan="1"><br /></td></tr></tbody></table>
<h2>Удаление Списка 2.0<ac:structured-macro ac:name="anchor" ac:schema-version="1" ac:macro-id="345ddbbc-ea29-4d36-b313-f57ed2a7b9ca"><ac:parameter ac:name="">5.5.</ac:parameter></ac:structured-macro></h2>
<p>Удаление списка возможно из Журнала &quot;Списки 2.0&quot; или из карточки &quot;Список 2.0&quot;.</p>
<p>Удаление списка не доступно для списков с признаком Автосинхронизации (list.autosync=tru<span style="color: rgb(0,0,0);">e). При наведении на кнопку &quot;Удалить&quot; для таких списков должен отображаться тултип &quot;Автосинхронизированные списки не доступны для удаления&quot;.</span></p>
<p><span style="color: rgb(51,102,255);">Удаление списка не доступно,&nbsp;если у пользователя нет полного доступа к выбранному типу списка. При этом в карточке кнопка не отображается, в Журнале при выборе действия единичного удаления списка - кнопка не отображается и в в Журнале при выборе списка через чекбокс кнопка не доступна для использования.</span></p>
<p>Для удаления списка из журнала возможно:</p>
<ul>
<li>единичное удаление <span style="color: rgb(128,0,128);">(operationId = deleteListByIds</span>):
<ul>
<li>необходимо в боковом меню строки списка выбрать действие &quot;Удалить&quot; и подтвердить удаление. Выполняется удаление списка из таблицы bo-analytic.lists и элементов списка из таблицы&nbsp;bo-analytic.list_items;</li>
<li>если список используется в условиях расчета других сущностей <s>привязан</s> <s>в </s><ac:inline-comment-marker ac:ref="0f7041ba-5245-496a-8eba-92ea5238f454"><s>правилу или онлайн-факту</s></ac:inline-comment-marker>, кнопка удаления не доступна, на экране&nbsp;информационное сообщение &quot;Объект связан с другими элементами системы&quot;.</li></ul></li>
<li>массовое удаление
<ul>
<li>необходимо отметить чек-боксами удаляемые списки и нажать появившуюся внизу кнопку &quot;Удалить&quot;;</li>
<li>при выборе чек-боксов кнопка &quot;Удалить&quot; не доступна при использования списка в других сущностях (хотя бы одно из полей <span class="name" style="color: rgb(23,43,77);" title="usedInOnlineFacts">usedInOnlineFacts или&nbsp;</span><span class="name" style="color: rgb(23,43,77);" title="usedInOnlineFacts"><span style="color: rgb(32,33,36);"><span class="name" title="usedInRules">usedInRules имеют значение&nbsp;</span></span></span>true);</li>
<li>если пользователь выбрал чек-боксами несколько списков, среди которых есть списки, привязанные в сущностям&nbsp;<s>(хотя бы одно из полей <span class="name" style="color: rgb(23,43,77);" title="usedInOnlineFacts">usedInOnlineFacts или&nbsp;</span><span class="name" style="color: rgb(23,43,77);" title="usedInOnlineFacts"><span style="color: rgb(32,33,36);"><span class="name" title="usedInRules">usedInRules имеют значение&nbsp;</span></span></span>true)</s>, <ac:inline-comment-marker ac:ref="d1fbe5aa-6dbe-4a76-acdd-017025b42c99">то, после нажатия на кнопку &quot;Удалить&quot; необходимо выводить на белый экран</ac:inline-comment-marker> сообщение &quot;Следующие списки невозможно удалить, так как они связаны с другими объектами системы: &lt;перечень списков&gt;. Удалить остальные списки? &quot;.
<ul>
<li>При нажатии &quot;Удалить&quot; выполняется удаление списков, не привязанных к другим сущностям (isUsed=false) из таблиц bo-analytic.lists и элементов этих списков из таблицы&nbsp;bo-analytic.list_items.&nbsp;</li>
<li>При нажатии &quot;Отменить&quot; не происходит удаление списков, осуществляется переход в Журнал &quot;Списки 2.0&quot;.</li></ul></li></ul></li></ul>
<p>Для удаления списка из карточки &quot;Список 2.0&quot;необходимо нажать кнопку &quot;Удалить&quot;.&nbsp;Выполняется удаление списка из таблицы bo-analytic.lists и элементов списка из таблицы&nbsp;bo-analytic.list_items. Если список привязан в правилу или онлайн-факта (<span style="letter-spacing: 0.0px;">хотя бы одно из полей </span><span class="name" style="color: rgb(23,43,77);" title="usedInOnlineFacts">usedInOnlineFacts или&nbsp;</span><span class="name" style="color: rgb(23,43,77);" title="usedInOnlineFacts"><span style="color: rgb(32,33,36);"><span class="name" title="usedInRules">usedInRules имеют значение&nbsp;</span></span></span><span style="letter-spacing: 0.0px;">true</span>), кнопка удаления не доступна, появляется информационное сообщение &quot;Объект связан с другими элементами системы&quot;.</p>
<p><span style="color: rgb(0,0,0);"><strong>Макет &quot;Подтверждение удаления одного списка из журнала&quot;</strong></span></p>
<p><ac:image ac:width="1000"><ri:attachment ri:filename="image2023-7-18_16-30-37.png" /></ac:image></p>
<p><span style="color: rgb(0,0,0);"><strong>Макет &quot;Невозможность единичного удаления списка из журна</strong></span><strong>ла, т.к. спи</strong><strong>сок связан с другим элементом системы&quot;</strong></p>
<p><ac:image ac:width="1000"><ri:attachment ri:filename="image2023-7-18_16-37-12.png" /></ac:image></p>
<p><br /></p>
<p><span style="color: rgb(0,0,0);"><strong>Макет &quot;Невозможность удаления списка с признаком Автосинхронизации&quot;</strong></span></p>
<p><ac:image ac:width="1000"><ri:attachment ri:filename="image2023-7-18_17-15-7.png" /></ac:image></p>
<p><br /></p>
<p><span style="color: rgb(0,0,0);"><strong>Макет &quot;Массовое удаление списков из журнала&quot;</strong></span></p>
<p><strong><span style="color: rgb(255,0,0);"><ac:image ac:width="1000"><ri:attachment ri:filename="image2023-7-18_17-25-22.png" /></ac:image></span></strong></p>
<p><span style="color: rgb(0,0,0);"><strong>Макет &quot;Невозможность массового удаления списков из журнала, привязанных к других сущностям&quot;</strong></span></p>
<p><ac:image ac:width="1000"><ri:attachment ri:filename="image2023-7-18_18-2-4.png" /></ac:image></p>
<p><br /></p>
<p><strong>Макет &quot;Следующие списки невозможно удалить, так как они связаны с другими объектами системы: &lt;перечень списков&gt;. Удалить остальные списки?&quot;</strong></p>
<p><ac:image ac:width="1000"><ri:attachment ri:filename="image2023-7-18_18-4-47.png" /></ac:image></p>
<p><br /></p>
<p>Для удаления списка необходимо&nbsp;реализовать следующие operationId:</p>
<table class="wrapped"><colgroup><col /><col /><col /><col /><col /><col /></colgroup>
<thead>
<tr>
<th colspan="1">Компонент</th>
<th style="text-align: left;">
<p>OperationId</p></th>
<th colspan="1">Endpoint</th>
<th style="text-align: left;">
<p>Описание</p></th>
<th colspan="1" style="text-align: left;">
<p>Тип API</p></th>
<th style="text-align: left;">
<p>Что делаем</p></th></tr></thead>
<tbody>
<tr>
<td colspan="1">bo-analytic /list</td>
<td colspan="1" style="text-align: left;">deleteListByIds</td>
<td colspan="1">
<p>/external/v2/list</p>
<p>DELETE</p></td>
<td colspan="1" style="text-align: left;">Удалить списки по идентификаторам</td>
<td colspan="1" style="text-align: left;">Внешнее</td>
<td colspan="1" style="text-align: left;">
<p>Удалить записи в&nbsp; bo-analytic.lists по id списка <span style="color: rgb(128,0,128);">и&nbsp;элементы списка&nbsp;из таблицы&nbsp;bo-analytic.list_items по list_id списка</span></p>
<p>Записать команду DELETE по каждому удаленному списку в <ac:inline-comment-marker ac:ref="27da778a-3468-40e4-b4ff-99b62e1a4ab6">таблицу&nbsp;list_items_kafka_commands</ac:inline-comment-marker></p></td></tr></tbody></table>
<p><strong>Интеграция с Ядром</strong></p>
<p><s>Для отправки команд на удаление списков и элементов списков в Ядро необходимо реализовать list-items-worker (далее - worker). В рамках реализации задачи разрабатывается один worker.&nbsp;</s></p>
<p><s>Worker по расписанию&nbsp;вычитывает записи (начиная с самой ранней) из&nbsp;системных таблиц list_items_kafka_commands по N команд, формирует сообщения и публикует их в соответствующие топики.</s></p>
<p><s>Если удалось сформировать и отправить все N запросов, то все N записей удаляются из таблицы; иначе (если хоть&nbsp;1 запрос не был отправлен) - записи не удаляются из БД,&nbsp;происходит&nbsp;попытка повторной отправки до тех пор пока kafka не станет доступна.</s></p>
<p><s>Консистентность данных при работе нескольких экземпляров сервиса обеспечивается на уровне БД.&nbsp;</s></p>
<p><ac:inline-comment-marker ac:ref="2ffe7d51-b091-4d34-b20c-d5e03b98d291">Частота и количество команд для отправки&nbsp;настраиваются&nbsp;в конфигурационном файле.</ac:inline-comment-marker>&nbsp;</p>
<table class="wrapped"><colgroup><col /><col /><col /><col /><col /><col /></colgroup>
<thead>
<tr>
<th colspan="1">Компонент</th>
<th style="text-align: left;">
<p>message</p></th>
<th style="text-align: left;">
<p>Описание</p></th>
<th colspan="1">Тип API</th>
<th colspan="1">Переменная окружения</th>
<th colspan="1">Пример команды</th></tr></thead>
<tbody>
<tr>
<td colspan="1">bo-analytic /list</td>
<td colspan="1">DeleteListCommand</td>
<td colspan="1">
<p>Команда на удаление списка.<br /><br /><span style="color: rgb(0,0,0);">При удалении списка отправляем в ядро только одну команду - на удаление списка</span></p></td>
<td colspan="1">Интеграционное</td>
<td colspan="1">
<p title="">BFP_KAFKA_INTEGRATION_LIST (топик по умолчанию&nbsp;</p>
<p title="">ROSTER-ELEMENT-UPDATES)</p></td>
<td colspan="1">
<div class="content-wrapper"><ac:structured-macro ac:name="code" ac:schema-version="1" ac:macro-id="3b7a0aab-712a-4b31-8a3e-289831131fa2"><ac:parameter ac:name="language">js</ac:parameter><ac:parameter ac:name="theme">Emacs</ac:parameter><ac:plain-text-body><![CDATA[{

⁣ ⁣"kind": "delete"

⁣ ⁣"rosterId": "78c278f0-c8ef-4f53-bf92-d3f6f167e3c9"

}]]></ac:plain-text-body></ac:structured-macro></div></td></tr></tbody></table>
<p><br /></p>
<h2>Добавление элементов в Список 2.0<ac:structured-macro ac:name="anchor" ac:schema-version="1" ac:macro-id="ef7f4449-79f7-4799-b77b-d37c0fe703d5"><ac:parameter ac:name="">5.6.</ac:parameter></ac:structured-macro></h2>
<p>Добавление элементов в список не доступно&nbsp;для списков с признаком Автосинхронизации (list.autosync=true) <span style="color: rgb(51,102,255);">и</span>&nbsp;<span style="color: rgb(51,102,255);">если у пользователя нет полного доступа к выбранному типу списка.</span></p>
<p><span style="color: rgb(0,0,0);"><strong>Макет&nbsp;пустого модального окна &quot;Добавление элемента списка&quot;&nbsp;</strong></span></p>
<p><span style="color: rgb(0,0,0);"><strong><ac:image ac:width="1000"><ri:attachment ri:filename="image2023-7-18_18-5-45.png" /></ac:image></strong></span></p>
<p><span style="color: rgb(0,0,0);"><strong>Макет &quot;Д<ac:inline-comment-marker ac:ref="fd891c43-2635-40f8-af5a-d853ee783406">обавление элемента списка</ac:inline-comment-marker>&quot;, выбран чек-бокс &quot;Период действия&quot;</strong></span></p>
<p><ac:image ac:width="600"><ri:attachment ri:filename="2023-09-04_14-33-40.png" /></ac:image></p>
<p><span style="color: rgb(0,0,0);"><strong><span style="color: rgb(0,0,0);">Макет уведомление &quot;Изменения успешно сохранены&quot; отображающееся после успешного создания элемента&nbsp;</span><br /></strong></span></p>
<p><ac:image ac:width="1000"><ri:attachment ri:filename="image2023-7-18_18-26-46.png" /></ac:image></p>
<p>Описание&nbsp;модального окна &quot;Добавление элемента списка&quot;</p>
<table class="relative-table wrapped" style="width: 94.9365%;">
<thead>
<tr>
<th style="text-align: left;">№</th>
<th colspan="2" style="text-align: left;">Наименование</th>
<th style="text-align: left;">Тип отображения</th>
<th style="text-align: left;">Обязательность</th>
<th style="text-align: left;">Описание, проверка</th>
<th style="text-align: left;">Источник данных</th>
<th colspan="1">Валидация на bo-front и в bo-analytic</th></tr></thead><colgroup><col style="width: 3.07829%;" /><col style="width: 10.2075%;" /><col style="width: 3.34842%;" /><col style="width: 7.50814%;" /><col style="width: 10.6408%;" /><col style="width: 17.5018%;" /><col style="width: 12.4229%;" /><col style="width: 35.269%;" /></colgroup>
<tbody>
<tr>
<td>1</td>
<td colspan="2">Значение</td>
<td>Текстовое поле</td>
<td>Да</td>
<td>
<p>Максимум 200 символов</p>
<p>Без ограничений по символам</p></td>
<td>Пользователь</td>
<td colspan="1">
<div class="content-wrapper">
<p>При сохранении значения выполняется проверка на уникальность <span style="color: rgb(128,0,128);">регистрозависимого</span> значения элемента в данном списке <span style="color: rgb(128,0,128);">(то есть в списке могут быть элементы Озон, ОЗОН и озон, но 2 элемента озон и озон вбить нельзя).</span></p>
<p>Если введенное значение совпадает с уже добавленным в данный список значением , то на экран выводится ошибка &quot;<ac:inline-comment-marker ac:ref="c84cc79d-cbf1-447b-b8b1-59fe325dc3b2"><span style="color: rgb(128,0,0);">Элемент списка должен иметь уникальное значение</span>&quot;.</ac:inline-comment-marker>&nbsp;</p>
<p><ac:image ac:width="600"><ri:attachment ri:filename="2023-09-04_14-27-03.png" /></ac:image></p></div></td></tr>
<tr>
<td>2</td>
<td colspan="2">Описание</td>
<td>Текстовое поле</td>
<td>Нет</td>
<td>
<p>Максимум 255 символов</p></td>
<td>Пользователь</td>
<td colspan="1"><br /></td></tr>
<tr>
<td>3</td>
<td colspan="2">Период действия</td>
<td>Чекбокс</td>
<td>Нет</td>
<td>При нажатии на чекбокс должны отображаться поля &quot;начало действия&quot; и &quot;Окончание действия&quot;</td>
<td>Пользователь</td>
<td colspan="1"><br /></td></tr>
<tr>
<td rowspan="2">4</td>
<td rowspan="2">Начало действия</td>
<td>
<p>Дата</p></td>
<td>
<p>Поле с маской ввода даты</p>
<p>Календарь</p></td>
<td><span style="color: rgb(0,128,128);">При активации чекбокса период действия обязательно к заполнению одно из 2х полей: Начало действия или Окончание действия</span></td>
<td>
<p>Дата в формате ДД.ММ.ГГГГ&nbsp;</p>
<p><s>В случае активного чекбокса и незаполненной даты начала действия кнопка <ac:inline-comment-marker ac:ref="44881322-361e-4719-9e10-c54889987810">&quot;Добавить&quot;</ac:inline-comment-marker> должна быть недоступна</s></p>
<p><span style="color: rgb(0,128,128);">При незаполненной дате в БД сохраняется null.</span></p></td>
<td>
<p>Пользователь</p></td>
<td colspan="1">
<p><span style="color: rgb(0,128,128);">При сохранении должна быть валидация на обязательное заполнение одного из 2х полей:&nbsp;Начало действия или Окончание действия. Если ни одно из полей не заполнено, то сохранение не возможно.</span></p>
<p><span style="color: rgb(0,128,128);">Если дата Начала действия позже, чем дата Окончания действия, то сохранение не доступно, на экран выводится ошибка &quot;Начало действия не может быть больше. чем окончание&quot;</span></p></td></tr>
<tr>
<td>Время</td>
<td>
<p>Поле с маской ввода времени</p>
<p>Часы</p></td>
<td>Нет</td>
<td>
<p>Время в формате ЧЧ-ММ (часы-минуты)</p>
<p>*в случае если пользователь <span style="color: rgb(0,128,128);">ввел дату и</span> не ввел значение времени, для времени по умолчанию должно сохраняться <span style="color: rgb(0,128,128);">на бэке</span> значение <span style="color: rgb(32,33,34);">21:00:00 UTC 0</span><span style="color: rgb(32,33,34);">&nbsp;(<span style="color: rgb(0,128,128);">отображается на фронте</span> <span style="color: rgb(128,128,0);">с учетом часового времени пользователя (для MSK</span> 00:00 UTC +3)). Значение должно формироваться bo-frontend и передаваться в API.&nbsp;</span></p></td>
<td>Пользователь</td>
<td colspan="1"><br /></td></tr>
<tr>
<td rowspan="2" style="text-align: left;">5</td>
<td rowspan="2">
<p>Окончание действия</p></td>
<td>Дата</td>
<td>
<p>Поле с маской ввода даты</p>
<p>Календарь</p></td>
<td><span style="color: rgb(0,128,128);">При активации чекбокса период действия обязательно к заполнению одно из 2х полей: Начало действия или Окончание действия</span></td>
<td>
<p>Дата в формате ДД.ММ.ГГГГ&nbsp;</p>
<p><s>В случае активного чекбокса, заполненной даты начала действия и незаполненной даты окончания действия, элемент должен действовать бессрочно с даты начала действия</s></p>
<p><span style="color: rgb(0,128,128);">При незаполненной дате в БД сохраняется null.</span></p></td>
<td>Пользователь</td>
<td colspan="1"><span style="color: rgb(0,128,128);">При сохранении должна быть валидация на обязательное заполнение одного из 2х полей:&nbsp;Начало действия или Окончание действия. Если ни одно из полей не заполнено, то сохранение не возможно.</span></td></tr>
<tr>
<td>Время</td>
<td>
<p>Поле с маской ввода времени</p>
<p>Часы</p></td>
<td>Нет</td>
<td>
<p>Время в формате ЧЧ-ММ (часы-минуты)</p>
<p>*в случае если пользователь <span style="color: rgb(0,128,128);">ввел дату и</span> не ввел значение времени, для времени по умолчанию должно <span style="color: rgb(0,128,128);">отображаться</span> значение <span style="color: rgb(128,128,0);">с учетом часового пояса пользователя (для MSK</span> 23:59 <span style="color: rgb(0,128,128);">UTC +3 (на бэке сохраняется в UTC 0 - 20:59)</span></p></td>
<td>Пользователь</td>
<td colspan="1"><br /></td></tr>
<tr>
<td>6</td>
<td colspan="2">Кнопка &quot;Добавить&quot;</td>
<td colspan="1">Кнопка</td>
<td colspan="1"><br /></td>
<td colspan="1">
<p>При нажатии на кнопку происходит:</p>
<ul>
<li>сохранение элемента списка в таблицу&nbsp;bo-analytic.list_items с привязкой к выбранному списку list_id</li>
<li>сохранение команды UPDATE в <ac:inline-comment-marker ac:ref="a278f069-9344-430f-9837-977ab542c56e">таблицу&nbsp;list_items_kafka_commands</ac:inline-comment-marker> для последующей отправки данных в Ядро</li>
<li>осуществляется возврат к карточке просмотра Списка 2.0.</li></ul></td>
<td colspan="1"><br /></td>
<td colspan="1">
<p>Не доступна при незаполненных обязательных полях модального окна</p>
<p><span style="color: rgb(0,128,128);">При сохранении должна быть валидация на обязательное заполнение одного из 2х полей:&nbsp;Начало действия или Окончание действия. Если ни одно из полей не заполнено, то кнопка &quot;Добавить&quot; не доступна.</span></p></td></tr>
<tr>
<td colspan="1">7</td>
<td colspan="2">Кнопка &quot;Отменить&quot;</td>
<td colspan="1">Кнопка</td>
<td colspan="1"><br /></td>
<td colspan="1">При нажатии на кнопку сохранение изменений не происходит,&nbsp;осуществляется возврат к карточке просмотра Списка 2.0.</td>
<td colspan="1"><br /></td>
<td colspan="1"><br /></td></tr></tbody></table>
<p>Для добавления элемента в список необходимо&nbsp;реализовать следующие operationId:</p>
<table class="wrapped"><colgroup><col /><col /><col /><col /><col /><col /></colgroup>
<thead>
<tr>
<th colspan="1">Компонент</th>
<th style="text-align: left;">
<p>OperationId</p></th>
<th colspan="1">Endpoint</th>
<th style="text-align: left;">
<p>Описание</p></th>
<th colspan="1" style="text-align: left;">
<p>Тип API</p></th>
<th style="text-align: left;">
<p>Что делаем</p></th></tr></thead>
<tbody>
<tr>
<td colspan="1">bo-analytic /list</td>
<td colspan="1" style="text-align: left;">createListItem</td>
<td colspan="1">
<p>/external/v2/list-item</p>
<p>POST</p></td>
<td colspan="1" style="text-align: left;">Создать элемент списка</td>
<td colspan="1" style="text-align: left;">Внешнее</td>
<td colspan="1" style="text-align: left;">
<p>Добавить запись в&nbsp; bo-analytic.list_items по id списка&nbsp;</p>
<p>Записать команду UPDATE по добавленному элементу в <ac:inline-comment-marker ac:ref="3bee21f7-fb26-4716-9557-12488bfc907e">таблицу&nbsp;list_items_kafka_commands</ac:inline-comment-marker></p></td></tr></tbody></table>
<p><strong>Интеграция с Ядром</strong></p>
<p><ac:inline-comment-marker ac:ref="9d4c3b90-1c61-40b0-b5dd-bb0a8e254a83">Для отправки команд на добавление элементов списка в Ядро необходимо реализовать worker.</ac:inline-comment-marker>&nbsp;</p>
<p>Worker по расписанию&nbsp;вычитывает записи (начиная с самой ранней) из&nbsp;системной таблицы list_items_kafka_commands по N команд, формирует сообщения и публикует их в соответствующий топик.</p>
<p>Если удалось сформировать и отправить все N запросов, то все N записей удаляются из таблицы; иначе (если хоть&nbsp;1 запрос не был отправлен) - записи не удаляются из БД,&nbsp;происходит&nbsp;попытка повторной отправки до тех пор пока kafka не станет доступна.</p>
<p>Консистентность данных при работе нескольких экземпляров сервиса обеспечивается на уровне БД.&nbsp;</p>
<p>Частота и количество команд для отправки&nbsp;настраиваются&nbsp;в конфигурационном файле.&nbsp;</p>
<p><strong>В случае если для полей ttl_from и ttl_to отсутствуют значения (null) при отправке команды на создание элемента в Kafka, необходимо:</strong></p>
<ul>
<li><strong>ttl_from=null, в команде, в поле start - необходимо указывать минимально возможное значение (<span style="color: rgb(65,134,248);"><ac:inline-comment-marker ac:ref="bcb2adfa-a51d-444e-84d2-8acc627d32f3">start </ac:inline-comment-marker></span><span style="color: rgb(23,43,77);"><ac:inline-comment-marker ac:ref="bcb2adfa-a51d-444e-84d2-8acc627d32f3">= </ac:inline-comment-marker></span><span style="color: rgb(102,217,239);"><ac:inline-comment-marker ac:ref="bcb2adfa-a51d-444e-84d2-8acc627d32f3">LocalDate</ac:inline-comment-marker></span><span style="color: rgb(23,43,77);"><ac:inline-comment-marker ac:ref="bcb2adfa-a51d-444e-84d2-8acc627d32f3">.</ac:inline-comment-marker></span><span style="color: rgb(65,134,248);"><ac:inline-comment-marker ac:ref="bcb2adfa-a51d-444e-84d2-8acc627d32f3">MIN</ac:inline-comment-marker></span><span style="color: rgb(23,43,77);"><ac:inline-comment-marker ac:ref="bcb2adfa-a51d-444e-84d2-8acc627d32f3">.</ac:inline-comment-marker></span><span style="color: rgb(166,226,46);"><ac:inline-comment-marker ac:ref="bcb2adfa-a51d-444e-84d2-8acc627d32f3">atStartOfDay</ac:inline-comment-marker></span><span style="color: rgb(84,168,87);"><ac:inline-comment-marker ac:ref="bcb2adfa-a51d-444e-84d2-8acc627d32f3">()</ac:inline-comment-marker></span><span style="color: rgb(23,43,77);"><ac:inline-comment-marker ac:ref="bcb2adfa-a51d-444e-84d2-8acc627d32f3">.</ac:inline-comment-marker></span><span style="color: rgb(166,226,46);"><ac:inline-comment-marker ac:ref="bcb2adfa-a51d-444e-84d2-8acc627d32f3">atOffset</ac:inline-comment-marker></span><span style="color: rgb(84,168,87);"><ac:inline-comment-marker ac:ref="bcb2adfa-a51d-444e-84d2-8acc627d32f3">(</ac:inline-comment-marker></span><span style="color: rgb(102,217,239);"><ac:inline-comment-marker ac:ref="bcb2adfa-a51d-444e-84d2-8acc627d32f3">ZoneOffset</ac:inline-comment-marker></span><span style="color: rgb(23,43,77);"><ac:inline-comment-marker ac:ref="bcb2adfa-a51d-444e-84d2-8acc627d32f3">.</ac:inline-comment-marker></span><span style="color: rgb(65,134,248);"><ac:inline-comment-marker ac:ref="bcb2adfa-a51d-444e-84d2-8acc627d32f3">UTC</ac:inline-comment-marker><span style="color: rgb(84,168,87);"><ac:inline-comment-marker ac:ref="bcb2adfa-a51d-444e-84d2-8acc627d32f3">)</ac:inline-comment-marker><span style="color: rgb(0,0,0);">); (<span style="color: rgb(23,43,77);">-31557014135596800.000000000)</span></span></span></span></strong></li>
<li><strong>ttl_to=null, в команде, в поле end - необходимо указывать максимально возможное значение <ac:inline-comment-marker ac:ref="f7c05d2f-7b62-4d43-a940-d85cb089c417">(</ac:inline-comment-marker><span style="color: rgb(65,134,248);"><ac:inline-comment-marker ac:ref="f7c05d2f-7b62-4d43-a940-d85cb089c417">end </ac:inline-comment-marker></span><span style="color: rgb(23,43,77);"><ac:inline-comment-marker ac:ref="f7c05d2f-7b62-4d43-a940-d85cb089c417">= </ac:inline-comment-marker></span><span style="color: rgb(102,217,239);"><ac:inline-comment-marker ac:ref="f7c05d2f-7b62-4d43-a940-d85cb089c417">LocalDate</ac:inline-comment-marker></span><span style="color: rgb(23,43,77);"><ac:inline-comment-marker ac:ref="f7c05d2f-7b62-4d43-a940-d85cb089c417">.</ac:inline-comment-marker></span><span style="color: rgb(65,134,248);"><ac:inline-comment-marker ac:ref="f7c05d2f-7b62-4d43-a940-d85cb089c417">MAX</ac:inline-comment-marker></span><span style="color: rgb(23,43,77);"><ac:inline-comment-marker ac:ref="f7c05d2f-7b62-4d43-a940-d85cb089c417">.</ac:inline-comment-marker></span><span style="color: rgb(166,226,46);"><ac:inline-comment-marker ac:ref="f7c05d2f-7b62-4d43-a940-d85cb089c417">atStartOfDay</ac:inline-comment-marker></span><span style="color: rgb(84,168,87);"><ac:inline-comment-marker ac:ref="f7c05d2f-7b62-4d43-a940-d85cb089c417">()</ac:inline-comment-marker></span><span style="color: rgb(23,43,77);"><ac:inline-comment-marker ac:ref="f7c05d2f-7b62-4d43-a940-d85cb089c417">.</ac:inline-comment-marker></span><span style="color: rgb(166,226,46);"><ac:inline-comment-marker ac:ref="f7c05d2f-7b62-4d43-a940-d85cb089c417">atOffset</ac:inline-comment-marker></span><span style="color: rgb(84,168,87);"><ac:inline-comment-marker ac:ref="f7c05d2f-7b62-4d43-a940-d85cb089c417">(</ac:inline-comment-marker></span><span style="color: rgb(102,217,239);"><ac:inline-comment-marker ac:ref="f7c05d2f-7b62-4d43-a940-d85cb089c417">ZoneOffset</ac:inline-comment-marker></span><span style="color: rgb(23,43,77);"><ac:inline-comment-marker ac:ref="f7c05d2f-7b62-4d43-a940-d85cb089c417">.</ac:inline-comment-marker></span><span style="color: rgb(65,134,248);"><ac:inline-comment-marker ac:ref="f7c05d2f-7b62-4d43-a940-d85cb089c417">UTC</ac:inline-comment-marker></span><span style="color: rgb(84,168,87);"><ac:inline-comment-marker ac:ref="f7c05d2f-7b62-4d43-a940-d85cb089c417">)</ac:inline-comment-marker></span><span style="color: rgb(65,134,248);"><span style="color: rgb(84,168,87);"><span style="color: rgb(0,0,0);"><ac:inline-comment-marker ac:ref="f7c05d2f-7b62-4d43-a940-d85cb089c417">); (<span style="color: rgb(23,43,77);">31556889832694400.000000000</span><span style="color: rgb(23,43,77);">)</span></ac:inline-comment-marker></span></span></span></strong></li></ul>
<p><span style="color: rgb(128,128,0);"><ac:inline-comment-marker ac:ref="f7c05d2f-7b62-4d43-a940-d85cb089c417">*Даты передаются в формате unix Timestamp в UTC0</ac:inline-comment-marker></span></p>
<table class="wrapped">
<thead>
<tr>
<th>Компонент</th>
<th style="text-align: left;">
<p>message</p></th>
<th style="text-align: left;">
<p>Описание</p></th>
<th>Тип API</th>
<th>Переменная окружения</th>
<th colspan="1">Пример команды</th></tr>
<tr>
<td colspan="1">bo-analytic /list</td>
<td colspan="1">UpdateListElementCommand</td>
<td colspan="1">Команда на добавление элемента списка</td>
<td colspan="1">Интеграционное</td>
<td colspan="1">BFP_KAFKA_INTEGRATION_LIST (топик по умолчанию&nbsp; ROSTER-ELEMENT-UPDATES)</td>
<td colspan="1"><ac:structured-macro ac:name="code" ac:schema-version="1" ac:macro-id="1abaada1-5cb9-4651-9b7c-a6a731ee220b"><ac:parameter ac:name="language">js</ac:parameter><ac:parameter ac:name="theme">Emacs</ac:parameter><ac:plain-text-body><![CDATA[{

⁣ ⁣"kind": "update-element"

⁣ ⁣"rosterId": "78c278f0-c8ef-4f53-bf92-d3f6f167e3c9"

 ⁣ ⁣"value": "new element"

 ⁣ ⁣"start" : "1693489680.000000000",

 ⁣ ⁣"end": "1694357340.000000000"

}]]></ac:plain-text-body></ac:structured-macro></td></tr></thead></table>
<p><br /></p>
<h2>Редактирование элементов в Списке 2.0&nbsp;<ac:structured-macro ac:name="anchor" ac:schema-version="1" ac:macro-id="1225e2d2-be51-4a18-9025-36b331fcb4b1"><ac:parameter ac:name="">5.7.</ac:parameter></ac:structured-macro></h2>
<p>Редактирование элементов в списках не доступно&nbsp;для списков с признаком Автосинхронизации (list.autosync=true) <span style="color: rgb(51,102,255);">и</span>&nbsp;<span style="color: rgb(51,102,255);">если у пользователя нет полного доступа к выбранному типу списка.</span></p>
<p><span style="color: rgb(0,0,0);"><strong>Макет&nbsp;модального окна &quot;<ac:inline-comment-marker ac:ref="5ab625ba-931f-4a49-9f6b-e6c9e015a830">Редактирование элемента</ac:inline-comment-marker>&quot;</strong></span></p>
<p><ac:image ac:width="600"><ri:attachment ri:filename="2023-09-04_14-28-58.png" /></ac:image></p>
<p><br /></p><ac:structured-macro ac:name="note" ac:schema-version="1" ac:macro-id="814a6322-d650-4c98-aea1-d8bbf663bc71"><ac:parameter ac:name="title">Важно</ac:parameter><ac:rich-text-body>
<p>Кнопка &quot;Редактирование&quot; для элементов доступна вне зависимости от количества элементов списка и привязке списка к другим сущностям.</p></ac:rich-text-body></ac:structured-macro>
<p>Описание&nbsp;модального окна &quot;Редактирование элемента&quot;</p>
<table class="relative-table wrapped" style="width: 85.4531%;">
<thead>
<tr>
<th>№</th>
<th colspan="2">Наименование</th>
<th>Тип отображения</th>
<th>Обязательность</th>
<th>Описание, проверка</th>
<th>Источник данных</th>
<th colspan="1">Валидация на bo-front и в bo-analytic</th></tr></thead><colgroup><col style="width: 3.6004%;" /><col style="width: 7.56136%;" /><col style="width: 3.72024%;" /><col style="width: 12.1226%;" /><col style="width: 9.6622%;" /><col style="width: 24.8422%;" /><col style="width: 8.94212%;" /><col style="width: 29.5254%;" /></colgroup>
<tbody>
<tr>
<td>1</td>
<td colspan="2">Значение</td>
<td>Текстовое поле</td>
<td>Да</td>
<td>
<p>Максимум <span style="color: rgb(51,153,102);">512</span> символов</p>
<p>Без ограничений по символам</p></td>
<td>Пользователь</td>
<td colspan="1">
<p>При сохранении значения выполняется проверка на уникальность значения элемента в данном списке.&nbsp;</p>
<p>Если введенное значение совпадает с уже добавленным в данный список значением , то на экран выводится ошибка &quot;Сущность с таким именем уже существует&quot;.&nbsp;</p></td></tr>
<tr>
<td>2</td>
<td colspan="2">Описание</td>
<td>Текстовое поле</td>
<td>Нет</td>
<td>
<p>Максимум <span style="color: rgb(51,153,102);">1000</span> символов</p></td>
<td>Пользователь</td>
<td colspan="1"><br /></td></tr>
<tr>
<td>3</td>
<td colspan="2">Период действия</td>
<td>Чекбокс</td>
<td>Нет</td>
<td>При нажатии на чекбокс должны отображаться&nbsp;</td>
<td>Пользователь</td>
<td colspan="1"><br /></td></tr>
<tr>
<td rowspan="2">4</td>
<td rowspan="2">Начало действия</td>
<td>
<p>Дата</p></td>
<td>
<p>Поле с маской ввода даты</p>
<p>Календарь</p></td>
<td><span style="color: rgb(0,128,128);">При активации чекбокса период действия обязательно к заполнению одно из 2х полей: Начало действия или Окончание действия</span></td>
<td>
<p>Дата в формате ДД.ММ.ГГГГ&nbsp;</p>
<p><s>В случае активного чекбокса и незаполненной даты начала действия кнопка &quot;Сохранить&quot; должна быть недоступна</s></p>
<p><span style="color: rgb(0,128,128);">При незаполненной дате в БД сохраняется null.</span></p></td>
<td>
<p>Пользователь</p></td>
<td colspan="1"><span style="color: rgb(0,128,128);">При сохранении должна быть валидация на обязательное заполнение одного из 2х полей:&nbsp;Начало действия или Окончание действия. Если ни одно из полей не заполнено, то сохранение не возможно.</span></td></tr>
<tr>
<td>Время</td>
<td>
<p>Поле с маской ввода времени</p>
<p>Часы</p></td>
<td>Нет</td>
<td>
<p>Время в формате ЧЧ-ММ (часы-минуты)</p>
<p>*в случае если пользователь <span style="color: rgb(0,128,128);">ввел дату и</span> не ввел значение времени, для времени по умолчанию должно сохраняться <span style="color: rgb(0,128,128);">на бэке</span> значение <span style="color: rgb(32,33,34);">21:00:00 UTC 0</span><span style="color: rgb(32,33,34);">&nbsp;(<span style="color: rgb(0,128,128);">отображается на фронте</span> <span style="color: rgb(128,128,0);">с учетом часового времени пользователя (для MSK</span> 00:00 UTC +3)). Значение должно формироваться bo-frontend и передаваться в API.&nbsp;</span></p></td>
<td>Пользователь</td>
<td colspan="1"><br /></td></tr>
<tr>
<td rowspan="2">5</td>
<td rowspan="2">
<p>Окончание действия</p></td>
<td>Дата</td>
<td>
<p>Поле с маской ввода даты</p>
<p>Календарь</p></td>
<td><span style="color: rgb(0,128,128);">При активации чекбокса период действия обязательно к заполнению одно из 2х полей: Начало действия или Окончание действия</span></td>
<td>
<p>Дата в формате ДД.ММ.ГГГГ&nbsp;</p>
<p><s>В случае активного чекбокса, заполненной даты начала действия и незаполненной даты окончания действия, элемент должен действовать бессрочно с даты начала действия.</s></p>
<p><span style="color: rgb(0,128,128);">При незаполненной дате в БД сохраняется null.</span></p></td>
<td>Пользователь</td>
<td colspan="1"><span style="color: rgb(0,128,128);">При сохранении должна быть валидация на обязательное заполнение одного из 2х полей:&nbsp;Начало действия или Окончание действия. Если ни одно из полей не заполнено, то сохранение не возможно.</span></td></tr>
<tr>
<td><ac:inline-comment-marker ac:ref="de8555e1-97e6-439e-941b-f8dd1ebd502d">Время</ac:inline-comment-marker></td>
<td>
<p>Поле с маской ввода времени</p>
<p>Часы</p></td>
<td>Нет</td>
<td>
<p>Время в формате ЧЧ-ММ (часы-минуты)</p>
<p>*в случае если пользователь <span style="color: rgb(0,128,128);">ввел дату и</span> не ввел значение времени, для времени по умолчанию должно <span style="color: rgb(0,128,128);">отображаться</span> значение <span style="color: rgb(128,128,0);">с учетом часового пояса пользователя (для MSK</span> 23:59 <span style="color: rgb(0,128,128);">UTC +3 (на бэке сохраняется в UTC 0 - 20:59)</span></p></td>
<td>Пользователь</td>
<td colspan="1"><br /></td></tr></tbody></table>
<p><br /></p>
<p>Для <span style="color: rgb(128,0,128);">обновления</span> элемента в списке необходимо&nbsp;реализовать следующие operationId:</p>
<table class="wrapped"><colgroup><col /><col /><col /><col /><col /><col /></colgroup>
<thead>
<tr>
<th colspan="1">Компонент</th>
<th style="text-align: left;">
<p>OperationId</p></th>
<th colspan="1">Endpoint</th>
<th style="text-align: left;">
<p>Описание</p></th>
<th colspan="1" style="text-align: left;">
<p>Тип API</p></th>
<th style="text-align: left;">
<p>Что делаем</p></th></tr></thead>
<tbody>
<tr>
<td colspan="1">bo-analytic /list</td>
<td colspan="1" style="text-align: left;">updateListItemById</td>
<td colspan="1">
<p>/external/v2/list-item/{id}</p>
<p>PATCH</p></td>
<td colspan="1" style="text-align: left;">Редактировать элемент списка по идентификатору</td>
<td colspan="1" style="text-align: left;">Внешнее</td>
<td colspan="1" style="text-align: left;">
<p>Обновить запись в bo-analytic.list_items по id элемента</p>
<p>Записать команду UPDATE по добавленному элементу в <ac:inline-comment-marker ac:ref="3e251b69-3826-4600-a326-55774534968e">таблицу&nbsp;list_items_kafka_commands</ac:inline-comment-marker></p></td></tr></tbody></table>
<p><strong>Интеграция с Ядром</strong></p>
<p><ac:inline-comment-marker ac:ref="af76dc00-a3b5-4499-ac8d-2c4ee9c16f0a">Для отправки команд в Ядро </ac:inline-comment-marker><span style="color: rgb(128,0,128);"><ac:inline-comment-marker ac:ref="af76dc00-a3b5-4499-ac8d-2c4ee9c16f0a">на обновление элемента</ac:inline-comment-marker></span> необходимо реализовать worker.&nbsp;</p>
<p>Worker по расписанию&nbsp;вычитывает записи (начиная с самой ранней) из&nbsp;системной таблицы list_items_kafka_commands по N команд, формирует сообщения и публикует их в соответствующий топик.</p>
<p>Если удалось сформировать и отправить все N запросов, то все N записей удаляются из таблицы; иначе (если хоть&nbsp;1 запрос не был отправлен) - записи не удаляются из БД,&nbsp;происходит&nbsp;попытка повторной отправки до тех пор пока kafka не станет доступна.</p>
<p>Консистентность данных при работе нескольких экземпляров сервиса обеспечивается на уровне БД.&nbsp;</p>
<p>Частота и количество команд для отправки&nbsp;настраиваются&nbsp;в конфигурационном файле.&nbsp;</p>
<p><strong>В случае если для полей ttl_from и ttl_to отсутствуют значения (null) при отправке команды на создание элемента в Kafka, необходимо:</strong></p>
<ul>
<li><strong>ttl_from=null, в команде, в поле start - необходимо указывать минимально возможное значение (<span style="color: rgb(65,134,248);">start </span><span style="color: rgb(23,43,77);">= </span><span style="color: rgb(102,217,239);">LocalDate</span><span style="color: rgb(23,43,77);">.</span><span style="color: rgb(65,134,248);">MIN</span><span style="color: rgb(23,43,77);">.</span><span style="color: rgb(166,226,46);">atStartOfDay</span><span style="color: rgb(84,168,87);">()</span><span style="color: rgb(23,43,77);">.</span><span style="color: rgb(166,226,46);">atOffset</span><span style="color: rgb(84,168,87);">(</span><span style="color: rgb(102,217,239);">ZoneOffset</span><span style="color: rgb(23,43,77);">.</span><span style="color: rgb(65,134,248);">UTC<span style="color: rgb(84,168,87);">)<span style="color: rgb(0,0,0);">); (<span style="color: rgb(23,43,77);">-31557014135596800.000000000)</span></span></span></span></strong></li>
<li><strong>ttl_to=null, в команде, в поле end - необходимо указывать максимально возможное значение (<span style="color: rgb(65,134,248);">end </span><span style="color: rgb(23,43,77);">= </span><span style="color: rgb(102,217,239);">LocalDate</span><span style="color: rgb(23,43,77);">.</span><span style="color: rgb(65,134,248);">MAX</span><span style="color: rgb(23,43,77);">.</span><span style="color: rgb(166,226,46);">atStartOfDay</span><span style="color: rgb(84,168,87);">()</span><span style="color: rgb(23,43,77);">.</span><span style="color: rgb(166,226,46);">atOffset</span><span style="color: rgb(84,168,87);">(</span><span style="color: rgb(102,217,239);">ZoneOffset</span><span style="color: rgb(23,43,77);">.</span><span style="color: rgb(65,134,248);">UTC</span><span style="color: rgb(84,168,87);">)</span><span style="color: rgb(65,134,248);"><span style="color: rgb(84,168,87);"><span style="color: rgb(0,0,0);">); (<span style="color: rgb(23,43,77);">31556889832694400.000000000</span><span style="color: rgb(23,43,77);">)</span></span></span></span></strong></li></ul>
<p><strong>При редактировании элемента списка <span style="color: rgb(51,51,153);">(всех, кроме значения в поле &quot;Описание&quot;)</span> - необходимо сначала отправить команду на удаление элемента списка со старым значением, после чего отправить команду на создание элемента списка с новым значением элемента.</strong></p>
<p><span style="color: rgb(128,128,0);">*Даты передаются в формате unix Timestamp в UTC0</span></p>
<table class="wrapped">
<thead>
<tr>
<th>Компонент</th>
<th style="text-align: left;">
<p>message</p></th>
<th style="text-align: left;">
<p>Описание</p></th>
<th>Тип API</th>
<th>Переменная окружения</th>
<th colspan="1">Пример команды</th></tr>
<tr>
<td>bo-analytic /list</td>
<td>DeleteListElementCommand</td>
<td>Команда на удаление элемента списка</td>
<td>Интеграционное</td>
<td>BFP_KAFKA_INTEGRATION_LIST (топик по умолчанию&nbsp; ROSTER-ELEMENT-UPDATES)</td>
<td><ac:structured-macro ac:name="code" ac:schema-version="1" ac:macro-id="5e249662-1b7e-4ae2-8bd1-78fa1a36799f"><ac:parameter ac:name="language">js</ac:parameter><ac:parameter ac:name="theme">Emacs</ac:parameter><ac:plain-text-body><![CDATA[{ ⁣ 
⁣"kind": "delete-element" ⁣ 
⁣"rosterId": "78c278f0-c8ef-4f53-bf92-d3f6f167e3c9" ⁣ 
⁣"value": "new element" 
}]]></ac:plain-text-body></ac:structured-macro>
<p><br /></p>
<div class="content-wrapper">
<p><br /></p></div></td></tr>
<tr>
<td colspan="1">bo-analytic /list</td>
<td colspan="1">UpdateListElementCommand</td>
<td colspan="1">Команда на создание элемента списка</td>
<td colspan="1">Интеграционное</td>
<td colspan="1">BFP_KAFKA_INTEGRATION_LIST (топик по умолчанию&nbsp; ROSTER-ELEMENT-UPDATES)</td>
<td colspan="1"><ac:structured-macro ac:name="code" ac:schema-version="1" ac:macro-id="135579c8-1be3-4657-9d86-86401a5c2b95"><ac:parameter ac:name="language">js</ac:parameter><ac:parameter ac:name="theme">Emacs</ac:parameter><ac:plain-text-body><![CDATA[{

⁣ ⁣"kind": "update-element"

⁣ ⁣"rosterId": "78c278f0-c8ef-4f53-bf92-d3f6f167e3c9"

 ⁣ ⁣"value": "new element"

 ⁣ ⁣"start" : "1693489680.000000000",

 ⁣ ⁣"end": "1694357340.000000000"

}]]></ac:plain-text-body></ac:structured-macro></td></tr></thead></table>
<h2>Удаление элементов в Списке 2.0&nbsp;<ac:structured-macro ac:name="anchor" ac:schema-version="1" ac:macro-id="5d972239-a62f-427c-9d3e-99ea5464e6c9"><ac:parameter ac:name="">5.8.</ac:parameter></ac:structured-macro></h2>
<p>Удаление элементов в списках не доступно&nbsp;для списков с признаком Автосинхронизации (list.autosync=true) <span style="color: rgb(51,102,255);">и</span>&nbsp;<span style="color: rgb(51,102,255);">если у пользователя нет полного доступа к выбранному типу списка.</span></p>
<p>Удаление элементов в списках доступно в том числе для списков с привязанными правилами/ онлайн-фактами&nbsp;(не зависимо от значения isUsed).</p>
<p>Удаление элементов в списке может быть единичным (1 элемент) и массовым (множество или все элементы в списке).</p>
<ol>
<li>Единичное удаление и массовое удаление<span style="color: rgb(128,0,128);">&nbsp;(operationId=deleteListItemsByIds)</span> возможно из карточки &quot;Список 2.0&quot; через&nbsp;действия над выбранным элементами &quot;Удалить&quot; и при выборе нужных элементов чекбоксами.</li>
<li><span>Удаление всех элементов из списка </span><span style="color: rgb(128,0,128);">(operationId=<ac:inline-comment-marker ac:ref="e5c8a230-50a8-451d-9e63-95a88dff21bf">deleteListItemsByListId</ac:inline-comment-marker>)</span>&nbsp;<span>возможно с помощью кнопки &quot;Очистить все&quot;.&nbsp;&nbsp;</span></li></ol>
<p><span style="color: rgb(0,0,0);"><strong>Макет&nbsp;&quot;Удаление элемента списка через боковую панель&quot;</strong></span></p>
<p><span style="color: rgb(255,0,0);"><ac:image ac:width="1000"><ri:attachment ri:filename="image2023-7-18_18-19-4.png" /></ac:image></span></p>
<p><span style="color: rgb(0,0,0);"><strong>Макет&nbsp;&quot;Подтверждение удаления элемента списка через боковую панель&quot;</strong></span></p>
<p><span style="color: rgb(0,0,0);"><strong><ac:image ac:width="1000"><ri:attachment ri:filename="image2023-7-18_18-19-29.png" /></ac:image></strong></span></p>
<p><br /></p>
<p><span style="color: rgb(0,0,0);"><strong>Макет &quot;Удаление элемента списка, при выборе чек-бокса&quot;</strong></span></p>
<p><span style="color: rgb(0,0,0);"><strong><ac:image ac:width="1000"><ri:attachment ri:filename="image2023-7-18_18-21-47.png" /></ac:image></strong></span></p>
<p><br /></p>
<p><strong>Макет &quot;Удалить все элементы в списке, при выборе чек-боксов&quot;</strong></p>
<p><ac:image ac:width="1000"><ri:attachment ri:filename="image2023-7-18_18-22-19.png" /></ac:image></p>
<p><strong><span style="color: rgb(0,0,0);">Макет &quot;Подтверждение удаления элементов в списке, при выборе чек-боксов&quot;</span></strong></p>
<p><ac:image ac:width="1000"><ri:attachment ri:filename="image2023-7-19_13-9-12.png" /></ac:image></p>
<p><span style="color: rgb(0,0,0);"><strong>Макет&nbsp; &quot;Подтверждение удаления при удалении по кнопке &quot;Очистить все&quot;</strong></span></p>
<p><span style="color: rgb(0,0,0);"><strong><ac:image ac:width="1000"><ri:attachment ri:filename="image2023-7-18_18-24-25.png" /></ac:image></strong></span></p>
<p><br /></p>
<p><br /></p>
<p><span style="letter-spacing: 0.0px;">Для удаления элементов в списке необходимо&nbsp;реализовать следующие operationId:</span></p>
<table class="wrapped"><colgroup><col /><col /><col /><col /><col /><col /></colgroup>
<thead>
<tr>
<th colspan="1">Компонент</th>
<th style="text-align: left;">
<p>OperationId</p></th>
<th colspan="1">Endpoint</th>
<th style="text-align: left;">
<p>Описание</p></th>
<th colspan="1" style="text-align: left;">
<p>Тип API</p></th>
<th style="text-align: left;">
<p>Что делаем</p></th></tr></thead>
<tbody>
<tr>
<td colspan="1">bo-analytic /list</td>
<td colspan="1">deleteListItemsByIds</td>
<td colspan="1">/external/v2/list-item</td>
<td colspan="1">
<p>Единичное, массовое удаление элементов - через действие или чек-бокс.</p>
<p>Удалить элементы списка по идентификаторам</p></td>
<td colspan="1">Внешнее</td>
<td colspan="1">
<p>Удалить элементы списка&nbsp;из таблицы&nbsp;bo-analytic.list_items по id элемента (на бэке сделать ограничение за 1 итерацию max 50 элементов в 1 списке).&nbsp;</p>
<p><s>Записать команду DELETE по удаленному элементу/ам списка в <ac:inline-comment-marker ac:ref="49d2090e-2538-4b98-af53-a04aaa275479">таблицу&nbsp;list_items_kafka_commands</ac:inline-comment-marker></s></p>
<p><ac:inline-comment-marker ac:ref="49d2090e-2538-4b98-af53-a04aaa275479"><strong>Команда на удаление элемента списка (OperationId = deleteListItemsByIds) - отправляется при удалении одного элемента, удалении нескольких элементов списка с помощью выбора чекбоксов.</strong></ac:inline-comment-marker></p></td></tr>
<tr>
<td colspan="1">bo-analytic /list</td>
<td colspan="1">deleteListItemsByListId</td>
<td colspan="1">
<p>/external/v2/list-item/list/{id}</p>
<p>DELETE</p></td>
<td colspan="1">
<p>Удаление всех элементов списка через кнопку &quot;Очистить список&quot;</p>
<p>Удалить элементы списка по идентификатору списка</p></td>
<td colspan="1">Внешнее</td>
<td colspan="1">
<p>Удалить элементы списка&nbsp;из таблицы&nbsp;bo-analytic.list_items по list_id списка (сам список из&nbsp;&nbsp;bo-analytic.list не удалять)</p>
<p><s>Записать команду DELETE по удаленному списку в <ac:inline-comment-marker ac:ref="2e95a46f-538c-45c0-8966-3ffd52684b57">таблицу&nbsp;list_items_kafka_commands</ac:inline-comment-marker></s></p>
<p><ac:inline-comment-marker ac:ref="2e95a46f-538c-45c0-8966-3ffd52684b57"><strong>В случае удаления всех элементов списка при нажатии кнопки &quot;Очистить все&quot; (OperationId = deleteListItemsByListId) - в Core должны отправляться команды на удаление каждого элемента (⁣т.е. kind = delete-element), при этом НЕ требуется отправка команды на удаление самого списка (⁣т.е. kind = delete).</strong></ac:inline-comment-marker></p></td></tr></tbody></table>
<p><strong>Интеграция с Ядром</strong></p>
<p><s><ac:inline-comment-marker ac:ref="c130991b-3195-4222-80dc-03bccb3f44b8"><ac:inline-comment-marker ac:ref="24840504-b957-4068-b991-7ac3a94d0379">Для отправки команд на удаление списков и элементов списков</ac:inline-comment-marker></ac:inline-comment-marker><ac:inline-comment-marker ac:ref="24840504-b957-4068-b991-7ac3a94d0379"> в Ядро необходимо реализовать worker.&nbsp;</ac:inline-comment-marker></s></p>
<p><s><ac:inline-comment-marker ac:ref="24840504-b957-4068-b991-7ac3a94d0379">Worker по расписанию&nbsp;вычитывает записи (начиная с самой ранней) из&nbsp;системной таблицы&nbsp;list_items_kafka_commands по N команд, формирует сообщения и публикует их в соответствующий топик.</ac:inline-comment-marker></s></p>
<p><s><ac:inline-comment-marker ac:ref="24840504-b957-4068-b991-7ac3a94d0379">Если удалось сформировать и отправить все N запросов, то все N записей удаляются из таблицы; иначе (если хоть&nbsp;1 запрос не был отправлен) - записи не удаляются из БД,&nbsp;происходит&nbsp;попытка повторной отправки до тех пор пока kafka не станет доступна.</ac:inline-comment-marker></s></p>
<p><s><ac:inline-comment-marker ac:ref="24840504-b957-4068-b991-7ac3a94d0379">Консистентность данных при работе нескольких экземпляров сервиса обеспечивается на уровне БД.&nbsp;</ac:inline-comment-marker></s></p>
<p><ac:inline-comment-marker ac:ref="24840504-b957-4068-b991-7ac3a94d0379">Частота и количество команд для отправки&nbsp;настраиваются&nbsp;в конфигурационном файле.</ac:inline-comment-marker>&nbsp;</p>
<p><strong>Команда на удаление элемента списка (OperationId = deleteListItemsByIds) - отправляется при удалении одного элемента, удалении нескольких элементов списка с помощью выбора чекбоксов.</strong></p>
<p><strong>В случае удаления всех <ac:inline-comment-marker ac:ref="e1bad495-4151-4927-a148-2abeebaa982a">элементов списка при нажатии кнопки &quot;Очистить все&quot;</ac:inline-comment-marker>&nbsp;(OperationId = <ac:inline-comment-marker ac:ref="b4290e3c-14cb-476a-889e-8339ffd4061d">deleteListItemsByListId</ac:inline-comment-marker>) - в <ac:inline-comment-marker ac:ref="b9db27c6-2da9-4d54-b851-c3cd36cf1c76">Core должны отправляться команды на удаление каждого элемента (⁣т.е. kind = delete-element), при этом не требуется отправка команды на удаление самого списка (⁣т.е. kind = delete).</ac:inline-comment-marker></strong></p>
<table class="wrapped"><colgroup><col /><col /><col /><col /><col /><col /></colgroup>
<thead>
<tr>
<th colspan="1">Компонент</th>
<th style="text-align: left;">
<p>message</p></th>
<th style="text-align: left;">
<p>Описание</p></th>
<th colspan="1">Тип API</th>
<th colspan="1">Переменная окружения</th>
<th colspan="1">Пример команды</th></tr></thead>
<tbody>
<tr>
<td colspan="1">bo-analytic /list</td>
<td colspan="1">DeleteListElementCommand</td>
<td colspan="1">Команда на удаление элемента списка</td>
<td colspan="1">Интеграционное</td>
<td colspan="1">BFP_KAFKA_INTEGRATION_LIST (топик по умолчанию&nbsp; ROSTER-ELEMENT-UPDATES)</td>
<td colspan="1">
<div class="content-wrapper"><ac:structured-macro ac:name="code" ac:schema-version="1" ac:macro-id="cf3046da-3258-48a0-b47e-546089c386eb"><ac:parameter ac:name="language">js</ac:parameter><ac:parameter ac:name="theme">Emacs</ac:parameter><ac:plain-text-body><![CDATA[{

⁣ ⁣"kind": "delete-element"

⁣ ⁣"rosterId": "78c278f0-c8ef-4f53-bf92-d3f6f167e3c9"

⁣ ⁣"value": "new element"

}]]></ac:plain-text-body></ac:structured-macro></div></td></tr>
<tr>
<td colspan="1">bo-analytic /list</td>
<td colspan="1">DeleteListCommand</td>
<td colspan="1">Команда на удаление списка</td>
<td colspan="1">Интеграционное</td>
<td colspan="1">
<p>BFP_KAFKA_INTEGRATION_LIST (топик по умолчанию&nbsp; ROSTER-ELEMENT-UPDATES)</p></td>
<td colspan="1">
<div class="content-wrapper"><ac:structured-macro ac:name="code" ac:schema-version="1" ac:macro-id="883ec569-85e7-4086-bcf0-fbac47dac2d3"><ac:parameter ac:name="language">js</ac:parameter><ac:parameter ac:name="theme">Emacs</ac:parameter><ac:plain-text-body><![CDATA[{

⁣ ⁣"kind": "delete"

⁣ ⁣"rosterId": "78c278f0-c8ef-4f53-bf92-d3f6f167e3c9"

}]]></ac:plain-text-body></ac:structured-macro></div></td></tr></tbody></table>
<p><br /></p>
<h2>Компонент&nbsp;bo-user</h2>
<table class="relative-table wrapped">
<thead>
<tr>
<th colspan="1" style="text-align: left;"><span style="color: rgb(0,0,0);">GIT repository</span></th>
<td colspan="1" style="text-align: left;"><br /></td></tr></thead><colgroup><col style="width: 223.247px;" /><col style="width: 794.792px;" /></colgroup>
<tbody>
<tr>
<th colspan="1" style="text-align: left;"><span style="color: rgb(0,0,0);">Ответственный за компонент</span></th>
<td colspan="1" style="text-align: left;"><br /></td></tr>
<tr>
<th colspan="1" style="text-align: left;"><span style="color: rgb(0,0,0);">Ссылка на задачу</span></th>
<td colspan="1" style="text-align: left;">
<div class="content-wrapper">
<p><br /></p></div></td></tr></tbody></table>
<p>Необходимо использовать текущие объекты доступа для класса объектов &quot;Управление правилами и списками&quot; (аналогично Спискам 1.0).</p>
<p>Объекты доступа должны включать настройки:</p>
<ul>
<li>полный доступ - можно создать/просмотреть/редактировать/удалить списки <span style="color: rgb(51,102,255);">разрешенного типа (lists.type) </span>и добавлять/редактировать/удалять элементы в списках <span style="color: rgb(51,102,255);">разрешенного типа</span>;</li>
<li>только чтение - можно только просмотреть списки и их элементы без возможности редактирования и удаления;</li>
<li>нет доступа - у роли отсутствует доступ.</li></ul>
<p>Доступ применяется к следующим ролям в зависимости от объекта доступа:</p>
<table class="wrapped relative-table" style="width: 25.9537%;"><colgroup><col style="width: 35.1288%;" /><col style="width: 38.998%;" /><col style="width: 25.848%;" /></colgroup>
<thead>
<tr>
<th class="highlight-green" data-highlight-colour="green" style="text-align: left;width: 168.0px;">
<p>Роль</p></th>
<th class="highlight-green" data-highlight-colour="green" style="width: 142.0px;">Объект доступа</th>
<th class="highlight-green" data-highlight-colour="green" style="text-align: left;width: 118.0px;">
<p>Полномочия</p></th></tr></thead>
<tbody>
<tr>
<td rowspan="3" style="text-align: left;width: 168.0px;">Администратор</td>
<td style="width: 142.0px;"><span style="color: rgb(0,128,128);">Списки Комплаенс</span></td>
<td style="text-align: left;width: 118.0px;"><span style="color: rgb(0,128,128);">только чтение</span></td></tr>
<tr>
<td style="width: 142.0px;"><span style="color: rgb(0,128,128);">Списки анти-фрод</span></td>
<td style="width: 118.0px;"><span style="color: rgb(0,128,128);">только чтение</span></td></tr>
<tr>
<td style="width: 142.0px;"><span style="color: rgb(0,128,128);">Списки общие</span></td>
<td style="width: 118.0px;"><span style="color: rgb(0,128,128);">только чтение</span></td></tr>
<tr>
<td rowspan="3" style="text-align: left;width: 168.0px;">Бизнес администратор</td>
<td style="width: 142.0px;"><span style="color: rgb(0,128,128);">Списки Комплаенс</span></td>
<td style="text-align: left;width: 118.0px;"><span style="color: rgb(0,128,128);">только чтение</span></td></tr>
<tr>
<td style="width: 142.0px;"><span style="color: rgb(0,128,128);">Списки анти-фрод</span></td>
<td style="width: 118.0px;"><span style="color: rgb(0,128,128);">полный доступ</span></td></tr>
<tr>
<td style="width: 142.0px;"><span style="color: rgb(0,128,128);">Списки общие</span></td>
<td style="width: 118.0px;"><span style="color: rgb(0,128,128);">только чтение</span></td></tr>
<tr>
<td rowspan="3" style="text-align: left;width: 168.0px;">Бизнес Аналитик</td>
<td style="width: 142.0px;"><span style="color: rgb(0,128,128);">Списки Комплаенс</span></td>
<td style="text-align: left;width: 118.0px;"><span style="color: rgb(0,128,128);">только чтение</span></td></tr>
<tr>
<td style="width: 142.0px;"><span style="color: rgb(0,128,128);">Списки анти-фрод</span></td>
<td style="width: 118.0px;"><span style="color: rgb(0,128,128);">только чтение</span></td></tr>
<tr>
<td style="width: 142.0px;"><span style="color: rgb(0,128,128);">Списки общие</span></td>
<td style="width: 118.0px;"><span style="color: rgb(0,128,128);">только чтение</span></td></tr>
<tr>
<td rowspan="3" style="text-align: left;width: 168.0px;">Фрод аналитик</td>
<td style="width: 142.0px;"><span style="color: rgb(0,128,128);">Списки Комплаенс</span></td>
<td style="text-align: left;width: 118.0px;"><span style="color: rgb(0,128,128);">полный доступ</span></td></tr>
<tr>
<td style="width: 142.0px;"><span style="color: rgb(0,128,128);">Списки анти-фрод</span></td>
<td style="width: 118.0px;"><span style="color: rgb(0,128,128);">полный доступ</span></td></tr>
<tr>
<td style="width: 142.0px;"><span style="color: rgb(0,128,128);">Списки общие</span></td>
<td style="width: 118.0px;"><span style="color: rgb(0,128,128);">полный доступ</span></td></tr>
<tr>
<td rowspan="3" style="text-align: left;width: 168.0px;">Редактор политик</td>
<td style="width: 142.0px;"><span style="color: rgb(0,128,128);">Списки Комплаенс</span></td>
<td style="text-align: left;width: 118.0px;"><span style="color: rgb(0,128,128);">полный доступ</span></td></tr>
<tr>
<td style="width: 142.0px;"><span style="color: rgb(0,128,128);">Списки анти-фрод</span></td>
<td style="width: 118.0px;"><span style="color: rgb(0,128,128);">полный доступ</span></td></tr>
<tr>
<td style="width: 142.0px;"><span style="color: rgb(0,128,128);">Списки общие</span></td>
<td style="width: 118.0px;"><span style="color: rgb(0,128,128);">полный доступ</span></td></tr>
<tr>
<td style="text-align: left;width: 168.0px;">Редактор списков</td>
<td style="width: 142.0px;"><span style="color: rgb(0,128,128);">Списки Комплаенс</span></td>
<td style="text-align: left;width: 118.0px;"><span style="color: rgb(0,128,128);">полный доступ</span></td></tr>
<tr>
<td style="width: 168.0px;"><br /></td>
<td style="width: 142.0px;"><span style="color: rgb(0,128,128);">Списки анти-фрод</span></td>
<td style="width: 118.0px;"><span style="color: rgb(0,128,128);">полный доступ</span></td></tr>
<tr>
<td style="width: 168.0px;"><br /></td>
<td style="width: 142.0px;"><span style="color: rgb(0,128,128);">Списки общие</span></td>
<td style="width: 118.0px;"><span style="color: rgb(0,128,128);">полный доступ</span></td></tr>
<tr>
<td rowspan="3" style="text-align: left;width: 168.0px;">Дежурный УПК</td>
<td style="width: 142.0px;"><span style="color: rgb(0,128,128);">Списки Комплаенс</span></td>
<td style="text-align: left;width: 118.0px;"><span style="color: rgb(0,128,128);">полный доступ</span></td></tr>
<tr>
<td style="width: 142.0px;"><span style="color: rgb(0,128,128);">Списки анти-фрод</span></td>
<td style="width: 118.0px;"><span style="color: rgb(0,128,128);">полный доступ</span></td></tr>
<tr>
<td style="width: 142.0px;"><span style="color: rgb(0,128,128);">Списки общие</span></td>
<td style="width: 118.0px;"><span style="color: rgb(0,128,128);">полный доступ</span></td></tr>
<tr>
<td rowspan="3" style="text-align: left;width: 168.0px;">Дежурный аналитик&nbsp;</td>
<td style="width: 142.0px;"><span style="color: rgb(0,128,128);">Списки Комплаенс</span></td>
<td style="text-align: left;width: 118.0px;"><span style="color: rgb(0,128,128);">полный доступ</span></td></tr>
<tr>
<td style="width: 142.0px;"><span style="color: rgb(0,128,128);">Списки анти-фрод</span></td>
<td style="width: 118.0px;"><span style="color: rgb(0,128,128);">полный доступ</span></td></tr>
<tr>
<td style="width: 142.0px;"><span style="color: rgb(0,128,128);">Списки общие</span></td>
<td style="width: 118.0px;"><span style="color: rgb(0,128,128);">полный доступ</span></td></tr>
<tr>
<td rowspan="3" style="text-align: left;width: 168.0px;">Комплаенс</td>
<td style="width: 142.0px;"><span style="color: rgb(0,128,128);">Списки Комплаенс</span></td>
<td style="text-align: left;width: 118.0px;"><span style="color: rgb(0,128,128);">только чтение</span></td></tr>
<tr>
<td style="text-align: left;width: 142.0px;"><span style="color: rgb(0,128,128);">Списки анти-фрод</span></td>
<td style="width: 118.0px;"><span style="color: rgb(0,128,128);">нет доступа</span></td></tr>
<tr>
<td colspan="1"><span style="color: rgb(0,128,128);">Списки общие</span></td>
<td colspan="1"><span style="color: rgb(0,128,128);">только чтение</span></td></tr></tbody></table>
<h3>Требования к формату хранения</h3>
<h4>&nbsp;Схема данных</h4><ac:structured-macro ac:name="code" ac:schema-version="1" ac:macro-id="71a7ba76-b8f3-4868-8d2c-5b847de239d4"><ac:parameter ac:name="language">sql</ac:parameter><ac:parameter ac:name="theme">DJango</ac:parameter><ac:parameter ac:name="linenumbers">true</ac:parameter><ac:plain-text-body><![CDATA[create table lists
(
    id     uuid not null,
    name  varchar(255) not null,
    items_type varchar(15) not null,
    type  varchar(15) not null,
    description varchar(2000),
    created timestamp not null,
    updated timestamp not null,
    created_by uuid not null,
    updated_by uuid not null,
    fi_name varchar(50) not null,
	autosync boolean not null default false, 
    primary key (id)
);

comment on table lists is 'Информация о списках';
comment on column id is 'Идентификатор списка';
comment on column name is 'Название списка';
comment on column items_type is 'Тип данных значений элементов списка';
comment on column type is 'Тип списка';
comment on column description is 'Описание списка';
comment on column created is 'Дата создания списка';
comment on column updated is 'Дата последнего обновления списка';
comment on column created_by is 'Идентификатор пользователя, который создал список';
comment on column updated_by is 'Идентификатор пользователя, который последним обновил список';
comment on column fi_name is 'Название финансового института';
comment on column autosync is 'Признак автосинхронизации списка';



create table list_items
(
    id     uuid not null,
    list_id  uuid references lists (id) ON DELETE RESTRICT,
    value1  varchar(200) not null,
    value2  varchar(200),
    description varchar(255),
    ttl_from timestamp,
    ttl_to timestamp,
	created timestamp not null,
    updated timestamp not null,
    created_by uuid not null,
    updated_by uuid not null,
    primary key (id),
	CONSTRAINT ttl_check CHECK (ttl_to > ttl_from)
);

comment on table list_items is 'Информация об элементах списков';
comment on column id is 'Идентификатор элемента списка';
comment on column list_id is 'Идентификатор списка, к которому относится элемент';
comment on column value1 is 'Значение элемента списка';
comment on column value2 is 'Значение элемента списка, используется для указания диапазона значений';
comment on column description is 'Описание элемента списка';
comment on column ttl_from is 'Дата и время начала действия элемента списка';
comment on column ttl_to is 'Дата и время окончания действия элемента списка';
comment on column created is 'Дата добавления элемента списка';
comment on column updated is 'Дата последнего обновления элемента списка';
comment on column created_by is 'Идентификатор пользователя, который добавил элемент';
comment on column updated_by is 'Идентификатор пользователя, который последним обновил элемент';


create table list_items_kafka_commands
(
    id            uuid         not null,
    key           varchar(200) not null,
    command       jsonb        not null,
    created_nano  bigint not null,
    message_class varchar(200) not null,
    primary key (id)
);

comment on table list_items_kafka_commands is 'Информация о командах на добавление/изменение/удаление элемента списка в Core';
comment on column id is 'Идентификатор команды';
comment on column key is 'Ключ (тип) команды';
comment on column created_nano is 'Время создания команды в наносекундах';
comment on column message_class is 'Идентификатор класса команды';

create table rule_lists
(
    rule_id     uuid references rule (id) ON DELETE RESTRICT,
	list_id 	uuid references lists (id) ON DELETE RESTRICT,
    primary key (rule_id, list_id)
);

comment on table rule_lists is 'Информация о связях правил и списков';
comment on column rule_id is 'Идентификатор правила';
comment on column list_id is 'Идентификатор списка';

create table online_fact_lists
(
    online_fact_id    uuid references online_facts (id) ON DELETE RESTRICT,
    list_id           uuid references lists (id) ON DELETE RESTRICT,
    primary key (online_fact_id, list_id)
);

comment on table online_fact_lists is 'Информация о связях онлайн-фактов и списков';
comment on column online_fact_id is 'Идентификатор онлайн-факта';
comment on column list_id is 'Идентификатор списка';


]]></ac:plain-text-body></ac:structured-macro><ac:structured-macro ac:name="note" ac:schema-version="1" ac:macro-id="0320476a-ee94-4bf9-bb2a-53b1496c2af3"><ac:rich-text-body>
<p>В таблице&nbsp;list_items значения в полях&nbsp;ttl_from и&nbsp;ttl_to сохраняются в UTC0.</p></ac:rich-text-body></ac:structured-macro>
<p><br /></p>
<h4>ER-диаграмма</h4>
<p><ac:structured-macro ac:name="drawio" ac:schema-version="1" ac:macro-id="08e2217e-b1b7-4c45-a2fb-95f361a34188"><ac:parameter ac:name="border">true</ac:parameter><ac:parameter ac:name="diagramName">БД</ac:parameter><ac:parameter ac:name="simpleViewer">false</ac:parameter><ac:parameter ac:name="width" /><ac:parameter ac:name="links">auto</ac:parameter><ac:parameter ac:name="tbstyle">top</ac:parameter><ac:parameter ac:name="lbox">true</ac:parameter><ac:parameter ac:name="diagramWidth">791</ac:parameter><ac:parameter ac:name="revision">10</ac:parameter><ac:parameter ac:name="" /></ac:structured-macro></p>
<p><br /></p>
<h3>Требования к программным&nbsp;интерфейсам</h3>
<p><a href="https://stash.sigma.sbrf.ru/projects/TAF_ARM/repos/openapi/pull-requests/36/overview">Просмотр API</a></p>
<h1><span class="nh-number" style="color: rgb(0,0,0);">Нефункциональные требования&nbsp;</span></h1>
<h2><span style="color: rgb(51,51,51);">Аудит</span></h2>
<p>Аудит<span>&nbsp;</span>модуля реализуется в сервисе bo-analytic. Аудит производится для следующих типов и объектов и событий аудита:</p>
<table class="wrapped relative-table" style="width: 24.7594%;"><colgroup><col style="width: 7.87733%;" /><col style="width: 28.2028%;" /><col style="width: 18.0455%;" /><col style="width: 45.8341%;" /></colgroup>
<thead>
<tr>
<th class="highlight-green" data-highlight-colour="green" style="text-align: left;">
<p>№</p></th>
<th class="highlight-green" data-highlight-colour="green" style="text-align: left;">
<p>Объект аудита</p></th>
<th class="highlight-green" data-highlight-colour="green" style="text-align: left;">
<p>Действие</p></th>
<th class="highlight-green" data-highlight-colour="green" style="text-align: left;">
<p>Название</p></th></tr></thead>
<tbody>
<tr>
<td style="text-align: left;">1</td>
<td style="text-align: left;">
<p>LIST</p></td>
<td style="text-align: left;"><span style="color: rgb(23,43,77);">VIEW_ALL</span></td>
<td style="text-align: left;"><span style="color: rgb(23,43,77);">Просмотр журнала</span></td></tr>
<tr>
<td style="text-align: left;">2</td>
<td style="text-align: left;">LIST</td>
<td style="text-align: left;">VIEW</td>
<td style="text-align: left;">Просмотр карточки списка</td></tr>
<tr>
<td style="text-align: left;">3</td>
<td style="text-align: left;">LIST</td>
<td style="text-align: left;">CREATE</td>
<td style="text-align: left;">Создание списка</td></tr>
<tr>
<td style="text-align: left;">4</td>
<td style="text-align: left;">
<p>LIST</p></td>
<td style="text-align: left;">UPDATE</td>
<td style="text-align: left;">Редактирование списка</td></tr>
<tr>
<td colspan="1">5</td>
<td colspan="1">LIST</td>
<td colspan="1">DELETE</td>
<td colspan="1">Удаление списка</td></tr>
<tr>
<td colspan="1">6</td>
<td colspan="1">LIST_ITEM</td>
<td colspan="1">VIEW</td>
<td colspan="1">Просмотр элементов списка</td></tr>
<tr>
<td colspan="1">7</td>
<td colspan="1">LIST_ITEM</td>
<td colspan="1">CREATE</td>
<td colspan="1">Добавление элемента</td></tr>
<tr>
<td colspan="1">8</td>
<td colspan="1">LIST_ITEM</td>
<td colspan="1">UPDATE</td>
<td colspan="1">Редактирование элемента</td></tr>
<tr>
<td colspan="1">9</td>
<td colspan="1">LIST_ITEM</td>
<td colspan="1">DELETE</td>
<td colspan="1">Удаление элемента</td></tr></tbody></table>
<p><br /></p>
<p>Порядок регистрации сообщений аудита:</p>
<ol>
<li>Событие аудита сохраняется в таблицу audit_events.</li>
<li>События вычитываются<span>&nbsp;</span>отдельным воркером из таблицы&nbsp;audit_events<span>&nbsp;</span>для отправка в Kafka.</li>
<li>Воркер попытается отправить события в Apache Kafka, в случае успеха &mdash; события удаляются из&nbsp;audit_events.</li>
<li>В случае недоступности Kafka попытка отправки продолжается до тех пор, пока Kafka не станет доступна.</li>
<li>Консистентность данных обеспечивается на уровне БД.</li></ol>
<p><br /></p><ac:structured-macro ac:name="plantuml" ac:schema-version="1" ac:macro-id="82d28c4e-7eb8-4591-9533-b2d10cbe1310"><ac:parameter ac:name="atlassian-macro-output-type">INLINE</ac:parameter><ac:plain-text-body><![CDATA[@startuml
skinparam ParticipantPadding 10
skinparam BoxPadding 10
autonumber

box "ARM.Back-end" #Lightgreen
participant "bo-analytic" as BOA
activate BOA
database "БД" as BD
endbox

participant "Kafka" as kf

box "Antifraud Core" #Lightyellow
participant "Antifraud Core" as AC
endbox

BOA -> BD: запрос на сохранение аудита в \n таблицу audit_events 
activate BD
BD --> BOA: Возврат статуса операции

deactivate BD

BOA -> kf: Публикация аудита
deactivate BOA
activate kf
kf -> AC: Вычитка сообщения
deactivate kf
activate AC


@enduml]]></ac:plain-text-body></ac:structured-macro>
<table class="wrapped"><colgroup><col /><col /><col /><col /><col /></colgroup>
<thead>
<tr>
<th class="highlight-green" data-highlight-colour="green" style="text-align: left;">
<p>№</p></th>
<th class="highlight-green" data-highlight-colour="green" style="text-align: left;">
<p>Наименование</p></th>
<th class="highlight-green" data-highlight-colour="green" style="text-align: left;">
<p>Название поля в JSON событии аудита</p></th>
<th class="highlight-green" data-highlight-colour="green" style="text-align: left;">
<p>Обязательность</p></th>
<th class="highlight-green" data-highlight-colour="green" style="text-align: left;">
<p>Комментарий</p></th></tr></thead>
<tbody>
<tr>
<td>1</td>
<td>
<p>Дата и время действия</p></td>
<td>
<p>creationTime</p></td>
<td>Да</td>
<td>
<p>Время в миллисекундах с&nbsp;1970-01-01T00:00:00Z в UTC</p></td></tr>
<tr>
<td>2</td>
<td>ID пользователя, совершившего действие</td>
<td>userId</td>
<td>Да</td>
<td>
<p>ID пользователя в АРМ аналитика в формате UUID согласно модулю пользователей</p></td></tr>
<tr>
<td>3</td>
<td>Логин&nbsp;пользователя, совершившего действие</td>
<td>username</td>
<td>Да</td>
<td>Логин пользователя в&nbsp;АРМ аналитика&nbsp;согласно модулю пользователей</td></tr>
<tr>
<td>4</td>
<td>ФИО пользователя, совершившего действие</td>
<td>userFIO</td>
<td>Да</td>
<td>ФИО в&nbsp;АРМ аналитика&nbsp;согласно модулю пользователей&nbsp;</td></tr>
<tr>
<td>5</td>
<td>Действие, совершенное пользователем</td>
<td>auditAction</td>
<td>Да</td>
<td>
<div class="content-wrapper">
<p>Согласно таблице выше (audit_events)</p></div></td></tr>
<tr>
<td>6</td>
<td>Объект аудита</td>
<td>auditObject</td>
<td>Да</td>
<td>
<div class="content-wrapper">
<p>Согласно таблице выше (audit_events)</p></div></td></tr>
<tr>
<td>7</td>
<td>
<p>ID объекта, над которым совершается действие</p></td>
<td>auditObjectId</td>
<td>Нет</td>
<td>
<p>Указывается ID объекта системы, для которого совершается действие</p></td></tr>
<tr>
<td>8</td>
<td>
<p>Результат совершения действия</p></td>
<td>result</td>
<td>Да</td>
<td>
<p>Возможные значения: true/false</p></td></tr>
<tr>
<td>9</td>
<td>
<p>Предыдущее состояние объекта</p></td>
<td>before</td>
<td>Нет</td>
<td>
<p>Фиксируется для событий обновления. Фиксируются значения аудируемых полей объекта до применения действия в формате JSON Map</p></td></tr>
<tr>
<td>10</td>
<td>
<p>Применённые параметры</p></td>
<td>parameters</td>
<td>Нет</td>
<td>
<p>Фиксируется для событий обновления, просмотра журнала в формате JSON Map.</p>
<p>Фиксируются новые значения аудируемых&nbsp;полей объекта/параметры фильтрации журнала</p></td></tr>
<tr>
<td>11</td>
<td>
<p>Примечание</p></td>
<td>comments</td>
<td>Нет</td>
<td>
<p>Используется для фиксации класса исключения в случае, если результат совершения действия - неудача (false)</p></td></tr></tbody></table>
<p><br /></p>
<p>Для каждого объекта аудита фиксируется параметр &quot;before&quot;, содержащий предыдущее состояние объекта.</p>
<p>Помимо обязательных для фиксации полей, также отслеживаются следующие поля,&nbsp;согласно спецификации OpenAPI:</p>
<p>Для объекта аудита LIST:</p>
<ol>
<li>id</li>
<li>name</li>
<li>itemsType</li>
<li>type</li>
<li>description</li>
<li>fiName</li>
<li>autoSync</li>
<li>itemsCount</li></ol>
<p>Для объекта аудита LIST_ITEM:</p>
<ol>
<li>id</li>
<li>listId</li>
<li>value1</li>
<li>value2</li>
<li>description</li>
<li>ttlFrom</li>
<li>ttlTo</li></ol>
<p><br /></p>
<h2><span style="color: rgb(51,51,51);">Логирование&nbsp;</span></h2>
<p><span style="color: rgb(23,43,77);">Согласно пункту 3&nbsp;</span><a href="https://confluence.sberbank.ru/pages/viewpage.action?pageId=7717763151" style="text-decoration: none;" rel="nofollow">Требования к логированию и мониторингу</a></p>
<h2><span style="color: rgb(51,51,51);">Мониторинг</span></h2>
<p>Необходимо собирать следующие метрики:</p>
<table class="wrapped"><colgroup><col /><col /><col /></colgroup>
<thead>
<tr>
<th class="highlight-green" data-highlight-colour="green" style="text-align: left;">
<p title="">#</p></th>
<th class="highlight-green" data-highlight-colour="green" style="text-align: left;">
<p title="">Компонент</p></th>
<th class="highlight-green" data-highlight-colour="green" style="text-align: left;">
<p title="">Метрика</p></th></tr></thead>
<tbody>
<tr>
<td style="text-align: left;">1</td>
<td style="text-align: left;">Вызов приложения-сервера</td>
<td style="text-align: left;">
<ul>
<li>счетчик успешно/неуспешно обработанных&nbsp;событий</li>
<li>счетчик&nbsp;отправленных ответов</li>
<li>счетчик&nbsp;успешно/неуспешно отправленных ответов</li></ul>
<p>Требование ко всем счетчикам:счетчики должны быть разбиты по endpoint&rsquo;ам. Не надо путать /readiness или /metrics с root &nbsp;&nbsp;</p></td></tr>
<tr>
<td style="text-align: left;">2</td>
<td style="text-align: left;">Приложение делает вызов другого приложения-клиента</td>
<td style="text-align: left;">
<ul>
<li>счетчик ошибок подключения</li>
<li>счетчик сколько запросов отправлено</li>
<li>таймер ответа приложения-клиента &nbsp;</li>
<li>eсли с внешним приложением есть пулы соединений, то
<ul>
<li>максимум и минимум соединений в пуле за минуту</li>
<li>максимум, минимум и среднее количество свободных соединений в пуле, если применимо</li></ul></li></ul></td></tr>
<tr>
<td style="text-align: left;">3</td>
<td style="text-align: left;">Взаимодействие с Kafka (режим продюсер, запись)</td>
<td style="text-align: left;">
<ul>
<li>счетчик сообщений отправленных в&nbsp;Kafka
<ul>
<li>сколько сообщений в минуту отправлено</li>
<li>перцентиль&nbsp;</li></ul></li></ul></td></tr>
<tr>
<td style="text-align: left;">4</td>
<td style="text-align: left;">Взаимодействие с Kafka (режим консюмер, чтение)</td>
<td style="text-align: left;">
<ul>
<li>счетчик прочитанных сообщений из&nbsp;Kafka<br />
<ul>
<li>сколько сообщений в минуту прочитано</li>
<li>перцентиль</li></ul></li>
<li>время обработки одного сообщения</li></ul></td></tr>
<tr>
<td style="text-align: left;">5</td>
<td style="text-align: left;">Взаимодействие с PostgreSQL</td>
<td style="text-align: left;">
<ul>
<li>счетчик запросов в базу
<ul>
<li>на чтение</li>
<li>на запись</li></ul></li>
<li>сколько запросов&nbsp;в минуту&nbsp;
<ul>
<li>прочитали</li>
<li>записали&nbsp;</li></ul></li>
<li>таймер запросов&nbsp;</li>
<li>перцентиль</li>
<li>максимум и минимум соединений в пуле за минуту</li>
<li>максимум, минимум и среднее количество свободных соединений в пуле, если применимо</li></ul></td></tr></tbody></table>
<h2>Безопасность</h2>
<p>Требования безопасности описаны на страницах:&nbsp;<a href="https://confluence.sberbank.ru/pages/viewpage.action?pageId=7502398610" rel="nofollow">Требования ИБ к OpenShift</a>,&nbsp;<a href="https://confluence.sberbank.ru/pages/viewpage.action?pageId=7502398623" rel="nofollow">Требования ИБ к Kafka</a></p></ac:rich-text-body></ac:structured-macro>
<p><br /></p>
<p><br /></p>