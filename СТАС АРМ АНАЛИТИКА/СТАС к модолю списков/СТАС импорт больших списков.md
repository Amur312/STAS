<ac:structured-macro ac:name="details" ac:schema-version="1" ac:macro-id="2f95c83d-1e6b-4368-90b5-db706a83e058"><ac:parameter ac:name="id">requirements</ac:parameter><ac:rich-text-body>
<table class="relative-table wrapped" style="width: 89.006%;"><colgroup><col style="width: 21.9306%;" /><col style="width: 78.0694%;" /></colgroup>
<tbody>
<tr>
<th colspan="1"><span style="color: rgb(0,0,0);">Epic в JIRA продукта</span></th>
<td colspan="1">
<div class="content-wrapper">
<p><ac:structured-macro ac:name="jira" ac:schema-version="1" ac:macro-id="0ca35d18-38af-4b8b-9099-64fb7069bd7b"><ac:parameter ac:name="server">Jira SberWorks</ac:parameter><ac:parameter ac:name="serverId">611daf70-25e6-3844-a434-3583e234ac1b</ac:parameter><ac:parameter ac:name="key">UINAF-537</ac:parameter></ac:structured-macro></p></div></td></tr>
<tr>
<th colspan="1"><span style="color: rgb(0,0,0);">Ссылка на CR/STORY команды</span></th>
<td colspan="1">
<div class="content-wrapper">
<p><ac:structured-macro ac:name="jira" ac:schema-version="1" ac:macro-id="65333441-cfb2-45bc-a8c3-c3229d2d4b1d"><ac:parameter ac:name="server">Jira SberWorks</ac:parameter><ac:parameter ac:name="serverId">611daf70-25e6-3844-a434-3583e234ac1b</ac:parameter><ac:parameter ac:name="key">UINAF-1440</ac:parameter></ac:structured-macro></p></div></td></tr>
<tr>
<th style="text-align: left;" colspan="1"><span style="color: rgb(0,0,0);">PO продукта&nbsp;</span></th>
<td style="text-align: left;" colspan="1">
<div class="content-wrapper">
<p><ac:link><ri:user ri:userkey="8aa486275404583f015507210c46028c" /></ac:link></p></div></td></tr>
<tr>
<th style="text-align: left;" colspan="1"><span style="color: rgb(0,0,0);">Системный-аналитик&nbsp;</span></th>
<td style="text-align: left;" colspan="1">
<div class="content-wrapper">
<p><ac:link><ri:user ri:userkey="8aae69567b55db21017b59046f270017" /></ac:link></p></div></td></tr>
<tr>
<th colspan="1">Статус согласования</th>
<td colspan="1">
<div class="content-wrapper">
<p><ac:structured-macro ac:name="pagestatus" ac:schema-version="1" ac:macro-id="78e6cbf4-f1c3-4d8e-a397-5be1651a0856" /></p></div></td></tr>
<tr>
<th colspan="1">БТ</th>
<td colspan="1"><ac:link><ri:page ri:content-title="Загрузка больших ручных списков в АРМ." /></ac:link></td></tr></tbody></table></ac:rich-text-body></ac:structured-macro>
<h1><br /><br /></h1><ac:structured-macro ac:name="numberedheadings" ac:schema-version="1" ac:macro-id="07a00a23-bb8d-41b3-afbc-c102f657467c"><ac:rich-text-body><ac:structured-macro ac:name="expand" ac:schema-version="1" ac:macro-id="eeade700-56fc-475e-93f0-218761db02b1"><ac:parameter ac:name="title">Оглавление</ac:parameter><ac:rich-text-body>
<p><ac:structured-macro ac:name="toc" ac:schema-version="1" ac:macro-id="06871eb8-97e9-4b83-ad76-e460bbc9d49c" /></p></ac:rich-text-body></ac:structured-macro><ac:structured-macro ac:name="expand" ac:schema-version="1" ac:macro-id="14e0ae5f-e72e-4984-abfc-9cc69a1fd0c0"><ac:parameter ac:name="title">История</ac:parameter><ac:rich-text-body>
<h1>Изменения</h1>
<table class="wrapped"><colgroup><col /><col /><col /></colgroup>
<tbody>
<tr>
<th>Дата</th>
<th>Описание</th>
<th>Автор</th></tr>
<tr>
<td colspan="1">07.04.2023</td>
<td colspan="1">Статья создана</td>
<td colspan="1">
<div class="content-wrapper">
<p>Малиновский Александр Геннадьевич</p></div></td></tr></tbody></table></ac:rich-text-body></ac:structured-macro>
<p><br /></p>
<h1>Глоссарий</h1>
<p><ac:placeholder>Необходимо указывать все термины и сокращения</ac:placeholder></p>
<table class="relative-table wrapped" style="width: 33.1453%;">
<thead style="text-decoration: none;">
<tr>
<th style="text-align: left;">
<p>Термин</p></th>
<th style="text-align: left;">
<p>Определение</p></th></tr></thead><colgroup style="text-decoration: none;"><col style="width: 30.1136%;" /><col style="width: 69.8864%;" /></colgroup>
<tbody style="text-decoration: none;">
<tr>
<td style="text-align: left;">Список&nbsp;</td>
<td style="text-align: left;">Перечень значений с которыми может быть сопоставлено значение одного из параметров транзакции, с целью выявления фрода. Например номер карты получателя может быть проверен на вхождение в черный список карт.</td></tr>
<tr>
<td colspan="1">Большой список&nbsp;</td>
<td colspan="1">Импортируемый файл&nbsp; в котором содержится более 40 тыс. элементов.</td></tr></tbody></table>
<h1>Общие сведения</h1>
<h2>Описание доработки</h2>
<p>В текущей реализации функции импорта списков обнаружилась проблема при импорте файла с количеством элементов более 80 тысяч. Из-за высокой нагрузки импорт не выполняется и завершается с ошибкой. В настоящей публикации приведены требования по доработке сервиса <ac:inline-comment-marker ac:ref="9147c480-9a7c-41d5-899b-d8427750a1a9">bo-list в част импорта</ac:inline-comment-marker> больших списков.</p>
<p><br /></p>
<h2>Изменения в архитектуре системы&nbsp;</h2>
<p>В рамках данной доработки предусмотрены следующие изменения:</p>
<ul>
<li>Создание сервиса для управления уведомлениями.</li>
<li>Создание интерфейса для получения и прочтения уведомлений от системы.</li>
<li>Изменение процедуры импорта файла элементов списка.</li>
<li>Создание нового сервиса для возможности через него осуществлять импорт <ac:inline-comment-marker ac:ref="fd062c79-71e8-4bfd-85d7-eec5b9279382">больших</ac:inline-comment-marker> <ac:inline-comment-marker ac:ref="60b06829-18a4-4685-a366-d09d85615351">списков</ac:inline-comment-marker>.</li></ul>
<h2>Бизнес логика</h2>
<p><br /></p><ac:structured-macro ac:name="plantuml" ac:schema-version="1" ac:macro-id="064db843-693a-43d4-8dd6-7977ee73c531"><ac:parameter ac:name="title">Импорт больших списков</ac:parameter><ac:parameter ac:name="atlassian-macro-output-type">INLINE</ac:parameter><ac:plain-text-body><![CDATA[@startuml
autonumber
skinparam ParticipantPadding 20
skinparam BoxPadding 20
skinparam maxmessagesize 200
skinparam shadowing false


box "UI АРМ.Аналитика" #Lightyellow 

actor USER as "Пользователь"
participant FrontEnd as "bo-frontend"
end box

box "Соединение через Вебсокет" #LightGrey
participant Websocket as "Websocket"
end box

box "BackEnd АРМ.Аналитика" #LightGreen
participant BoList as "bo-list-import"
participant Topic1 as "bfp.cc.user.notification (kafka)"
participant BoNotification as "bo-notification"
database Postgres
end box

box "BackEnd АРМ.Аналитика" #LightGreen
participant Topic1 as "bfp.cc.user.notification (kafka)"
end box

==Импорт большого списка==

USER -> FrontEnd: Пользователь авторизуется в системе (АРМ.аналитика)

activate USER

activate FrontEnd

alt Пользователь успешно авторизовался  
FrontEnd -> Websocket : Осуществляется установка двухстороннего соединения с сервером

activate Websocket
Websocket -> BoNotification : Осуществляется установка двухстороннего соединения с сервером

else Авторизация пользователя завершилась с ошибкой
FrontEnd --> USER : Возвращается сообщение об ошибке авторизации 
deactivate FrontEnd
end

USER -> FrontEnd: Пользователь производит импорт большого списка 

activate FrontEnd

FrontEnd -> Websocket: Маршрутизация к сервису "bo-notification"
deactivate FrontEnd

activate BoList
Websocket -> BoList: Маршрутизация к сервису "bo-notification"

activate Postgres
BoList-> Postgres: Cервис bo-list-import cоздает запись команды импорта в таблице notification_import_command.
Postgres-> BoList: Запись в таблице notification_import_command cоздана.

BoList -> BoList : Осуществляется проверка того, что формата импортируемого файла - csv и определяется ее результат

deactivate Postgres


alt Файл не прошел валидацию
BoList --> Websocket : Возвращается сообщение об ошибке формата
Websocket --> FrontEnd : Возвращается сообщение об ошибке формата
activate FrontEnd 

FrontEnd --> USER : Сообщение об ошибке формата файла

deactivate FrontEnd

else Валидация завершилась успешно


par
BoList -> Postgres: Производится запись элемнтов списка в таблицу kafka_commands
activate Postgres
else
BoList -> Postgres: Осуществляется передача данных из файла

deactivate BoList


Postgres -> temporaryTable** : Создается временная таблица

Postgres -> temporaryTable: Осуществляется копирование элементов списка из файла во временную таблицу

temporaryTable -> temporaryTable: Копирование элементов списка из файла во временную таблицу завершено

temporaryTable --> Postgres : Производится добавление записей из временной таблицы в bfp_bo_policy_list.policy_list_item

Postgres -> Postgres : Добавление элементов списка завершено

Postgres -> temporaryTable!! : Временная таблица удаляется

end

alt Импорт файла завершен успешно
Postgres --> BoList : Возвращается сообщение об успешном импорте
deactivate Postgres

activate BoList
BoList -> Topic1: Сервис "bo-list-import" передает в топик кафки bfp.cc.user.notification cообщение об успешном завершении импорта.
deactivate BoList

activate Topic1
Topic1-> BoNotification: Сервис bo-notification получает сообщение из топика bfp.cc.user.notification
deactivate Topic1

activate BoNotification
BoNotification-> Postgres: Сервис bo-notification создает запись в таблице long_term_notification на основе данных из сообщения
deactivate BoNotification

activate Postgres
Postgres --> BoNotification: Запись создана
deactivate Postgres

activate BoNotification
BoNotification --> Websocket: Уведомление о результате импорта передается через "Websocket".
deactivate BoNotification

Websocket --> FrontEnd : Передается уведомление пользователю, счетчик количества уведомлений + 1
activate FrontEnd

FrontEnd --> USER : Пользователю доступно для прочтения новое сообщение
deactivate FrontEnd

else Импорт файла завершился с ошибкой 
activate Postgres
Postgres --> BoList : Возвращается сообщение о том что импорт завершился с ошибкой
deactivate Postgres

activate BoList
BoList -> Topic1: Сервис "bo-list-import" передает в топик кафки bfp.cc.user.notification cообщение о завершении импорта с ошибкой.
deactivate BoList

activate Topic1
Topic1-> BoNotification: Сервис bo-notification получает сообщение из топика bfp.cc.user.notification
deactivate Topic1

activate BoNotification
BoNotification-> Postgres: Сервис bo-notification создает запись в таблице long_term_notification на основе данных из сообщения
deactivate BoNotification

activate Postgres
Postgres --> BoNotification: Запись создана
deactivate Postgres

activate BoNotification
BoNotification --> Websocket: Уведомление о результате импорта передается через "Websocket"
deactivate BoNotification

Websocket --> FrontEnd : Передается уведомление пользователю, счетчик количества уведомлений + 1
activate FrontEnd

FrontEnd --> USER : Пользователю доступно для прочтения новое уведомление
deactivate FrontEnd


end

end
deactivate Postgres

deactivate FrontEnd

deactivate USER

autonumber stop

@enduml]]></ac:plain-text-body></ac:structured-macro>
<table class="relative-table wrapped" style="width: 80.8058%;"><colgroup><col style="width: 4.5045%;" /><col style="width: 9.21691%;" /><col style="width: 23.9085%;" /><col style="width: 17.4636%;" /><col style="width: 24.1164%;" /><col style="width: 20.79%;" /></colgroup>
<tbody>
<tr>
<th>Шаг&nbsp;</th>
<th colspan="1">Компонент</th>
<th colspan="1">Действие</th>
<th colspan="1">Команды</th>
<th colspan="1">Endpoint&nbsp;</th>
<th>Протокол и формат</th></tr>
<tr>
<td>1</td>
<td colspan="1">Пользователь&nbsp;</td>
<td colspan="1">&nbsp;Пользователь авторизуется в системе (АРМ.аналитика)</td>
<td colspan="1">POST</td>
<td colspan="1">/external/v1/login</td>
<td><span style="color: rgb(23,43,77);">REST/json</span></td></tr>
<tr>
<td colspan="1">2</td>
<td colspan="1">bo-frontend&nbsp;</td>
<td colspan="1">&nbsp;Осуществляется установка двухстороннего соединения с сервером</td>
<td colspan="1"><span style="color: rgb(0,0,0);">GET</span></td>
<td colspan="1"><a href="wss://mgmt.dev1.biplan.bi.zone/api/bfp-bo-list/external/v1/bo-list/ws/329/prvu1ib3/websocket">wss://mgmt.dev1.biplan.bi.zone/api/bfp-bo-list/external/v1/bo-list/ws/329/prvu1ib3/websocket</a></td>
<td colspan="1">WSS/HTTP</td></tr>
<tr>
<td colspan="1">3</td>
<td colspan="1">Websocket&nbsp;</td>
<td colspan="1">&nbsp;Осуществляется установка двухстороннего соединения с сервером</td>
<td colspan="1"><span style="color: rgb(0,0,0);">GET</span></td>
<td colspan="1"><a href="wss://mgmt.dev1.biplan.bi.zone/api/bfp-bo-list/external/v1/bo-list/ws/329/prvu1ib3/websocket">wss://mgmt.dev1.biplan.bi.zone/api/bfp-bo-list/external/v1/bo-list/ws/329/prvu1ib3/websocket</a></td>
<td colspan="1">WSS/HTTP</td></tr>
<tr>
<td colspan="1">4</td>
<td colspan="1">bo-frontend&nbsp;</td>
<td colspan="1">&nbsp;Возвращается сообщение об ошибке авторизации&nbsp;</td>
<td colspan="1">
<pre>POST</pre></td>
<td colspan="1">/external/v1/login</td>
<td colspan="1"><span style="color: rgb(23,43,77);">REST/json</span></td></tr>
<tr>
<td colspan="1">5</td>
<td colspan="1">Пользователь&nbsp;</td>
<td colspan="1">&nbsp;Пользователь производит импорт большого списка&nbsp;</td>
<td colspan="1">
<pre>POST</pre></td>
<td colspan="1">/external/v1/import-list-item/import</td>
<td colspan="1"><span style="color: rgb(23,43,77);">REST/json</span></td></tr>
<tr>
<td colspan="1">6</td>
<td colspan="1">bo-frontend&nbsp;</td>
<td colspan="1">&nbsp;Маршрутизация к сервису&nbsp;&quot;bo-notification&quot;</td>
<td colspan="1">
<pre>POST</pre></td>
<td colspan="1">/external/v1/import-list-item/import</td>
<td colspan="1"><span style="color: rgb(23,43,77);">REST/json</span></td></tr>
<tr>
<td colspan="1">7</td>
<td colspan="1">Websocket&nbsp;</td>
<td colspan="1">
<p>&nbsp;Маршрутизация к сервису&nbsp;&quot;bo-notification&quot;</p></td>
<td colspan="1">
<pre>POST</pre></td>
<td colspan="1">/external/v1/import-list-item/import</td>
<td colspan="1"><span style="color: rgb(23,43,77);">REST/json</span></td></tr>
<tr>
<td colspan="1">8,9</td>
<td colspan="1">bo-list-import&nbsp;&nbsp;</td>
<td colspan="1">Cервис bo-list-import cоздает запись команды импорта в таблице notification_import_command.</td>
<td colspan="1">
<pre>POST</pre></td>
<td colspan="1">/external/v1/import-list-item/import</td>
<td colspan="1"><span style="color: rgb(23,43,77);">REST/json</span></td></tr>
<tr>
<td colspan="1">10</td>
<td colspan="1">bo-list-import&nbsp;&nbsp;</td>
<td colspan="1">&nbsp;Осуществляется проверка того, что формата импортируемого файла - csv и определяется ее результат</td>
<td colspan="1">
<pre>POST</pre></td>
<td colspan="1">/external/v1/import-list-item/import</td>
<td colspan="1"><span style="color: rgb(23,43,77);">REST/json</span></td></tr>
<tr>
<td colspan="1">11</td>
<td colspan="1">bo-list-import&nbsp;&nbsp;</td>
<td colspan="1">&nbsp;Возвращается сообщение об ошибке формата</td>
<td colspan="1">
<pre>POST</pre></td>
<td colspan="1">/external/v1/import-list-item/import</td>
<td colspan="1"><span style="color: rgb(23,43,77);">REST/json</span></td></tr>
<tr>
<td colspan="1">12</td>
<td colspan="1">Websocket&nbsp;</td>
<td colspan="1">&nbsp;Возвращается сообщение об ошибке формата</td>
<td colspan="1">
<pre>POST</pre></td>
<td colspan="1">/external/v1/import-list-item/import</td>
<td colspan="1"><span style="color: rgb(23,43,77);">REST/json</span></td></tr>
<tr>
<td colspan="1">13</td>
<td colspan="1">bo-frontend&nbsp;</td>
<td colspan="1">&nbsp;Сообщение об ошибке формата файла</td>
<td colspan="1">
<pre>POST</pre></td>
<td colspan="1">/external/v1/import-list-item/import</td>
<td colspan="1"><span style="color: rgb(23,43,77);">REST/json</span></td></tr>
<tr>
<td colspan="1">14</td>
<td colspan="1">bo-list-import&nbsp;&nbsp;</td>
<td colspan="1">&nbsp;Осуществляется передача данных из файла</td>
<td colspan="1">
<pre>POST</pre></td>
<td colspan="1">/external/v1/import-list-item/import</td>
<td colspan="1"><span style="color: rgb(23,43,77);">REST/json</span></td></tr>
<tr>
<td colspan="1">15</td>
<td colspan="1">Postgres&nbsp;</td>
<td colspan="1">&nbsp;Создается временная таблица</td>
<td colspan="1">
<pre>POST</pre></td>
<td colspan="1">/external/v1/import-list-item/import</td>
<td colspan="1"><span style="color: rgb(23,43,77);">REST/json</span></td></tr>
<tr>
<td colspan="1">16</td>
<td colspan="1">Postgres&nbsp;</td>
<td colspan="1">&nbsp;Осуществляется копирование элементов списка из файла во временную таблицу</td>
<td colspan="1">
<pre>POST</pre></td>
<td colspan="1">/external/v1/import-list-item/import</td>
<td colspan="1"><span style="color: rgb(23,43,77);">REST/json</span></td></tr>
<tr>
<td colspan="1">17</td>
<td colspan="1">temporaryTable&nbsp;</td>
<td colspan="1">&nbsp;Копирование элементов списка из файла во временную таблицу завершено</td>
<td colspan="1">
<pre>POST</pre></td>
<td colspan="1">/external/v1/import-list-item/import</td>
<td colspan="1"><span style="color: rgb(23,43,77);">REST/json</span></td></tr>
<tr>
<td colspan="1">18</td>
<td colspan="1">temporaryTable&nbsp;</td>
<td colspan="1">&nbsp;Производится добавление записей из временной таблицы в bfp_bo_policy_list.policy_list_item</td>
<td colspan="1">
<pre>POST</pre></td>
<td colspan="1">/external/v1/import-list-item/import</td>
<td colspan="1"><span style="color: rgb(23,43,77);">REST/json</span></td></tr>
<tr>
<td colspan="1">19</td>
<td colspan="1">Postgres&nbsp;</td>
<td colspan="1">&nbsp;Добавление элементов списка завершено</td>
<td colspan="1">
<pre>POST</pre></td>
<td colspan="1">/external/v1/import-list-item/import</td>
<td colspan="1"><span style="color: rgb(23,43,77);">REST/json</span></td></tr>
<tr>
<td colspan="1">20</td>
<td colspan="1">Postgres&nbsp;</td>
<td colspan="1">&nbsp;Временная таблица удаляется</td>
<td colspan="1">
<pre>POST</pre></td>
<td colspan="1">/external/v1/import-list-item/import</td>
<td colspan="1"><span style="color: rgb(23,43,77);">REST/json</span></td></tr>
<tr>
<td colspan="1">21</td>
<td colspan="1">Postgres&nbsp;</td>
<td colspan="1">&nbsp;Возвращается сообщение об успешном импорте</td>
<td colspan="1">
<pre>POST</pre></td>
<td colspan="1">/external/v1/import-list-item/import</td>
<td colspan="1"><span style="color: rgb(23,43,77);">REST/json</span></td></tr>
<tr>
<td colspan="1">22</td>
<td colspan="1">bo-list-import&nbsp;&nbsp;</td>
<td colspan="1">&nbsp;Сервис &quot;bo-list-import&quot; передает в топик кафки <a href="http://bfp.cc">bfp.cc</a>.user.notification cообщение об успешном завершении импорта</td>
<td colspan="1">
<pre>POST</pre></td>
<td colspan="1">/external/v1/import-list-item/import</td>
<td colspan="1"><span style="color: rgb(23,43,77);">REST/json</span></td></tr>
<tr>
<td colspan="1">23</td>
<td colspan="1">bo-notification</td>
<td colspan="1">Сервис bo-notification получает сообщение из топика <a href="http://bfp.cc">bfp.cc</a>.user.notification</td>
<td colspan="1">
<pre>POST</pre></td>
<td colspan="1">/external/v1/import-list-item/import</td>
<td colspan="1"><span style="color: rgb(23,43,77);">REST/json</span></td></tr>
<tr>
<td colspan="1">24,25</td>
<td colspan="1">bo-notification</td>
<td colspan="1">Сервис bo-notification создает запись в таблице long_term_notification на основе данных из сообщения</td>
<td colspan="1">
<pre>POST</pre></td>
<td colspan="1">/external/v1/import-list-item/import</td>
<td colspan="1"><span style="color: rgb(23,43,77);">REST/json</span></td></tr>
<tr>
<td colspan="1"><ac:inline-comment-marker ac:ref="72eaefa7-c4f4-4689-9fe2-a8ea4f6165b6">26</ac:inline-comment-marker></td>
<td colspan="1">bo-notification&nbsp;</td>
<td colspan="1">&nbsp;Уведомление передается через &quot;Websocket&quot;.</td>
<td colspan="1">
<pre>GET</pre></td>
<td colspan="1">/external/v1/notification</td>
<td colspan="1"><span style="color: rgb(23,43,77);">REST/json</span></td></tr>
<tr>
<td colspan="1">27</td>
<td colspan="1">Websocket&nbsp;</td>
<td colspan="1">&nbsp;Передается уведомление пользователю, счетчик количества уведомлений + 1</td>
<td colspan="1"><span style="color: rgb(0,0,0);">GET</span></td>
<td colspan="1"><a href="wss://mgmt.dev1.biplan.bi.zone/api/bfp-bo-list/external/v1/bo-list/ws/329/prvu1ib3/websocket">wss://mgmt.dev1.biplan.bi.zone/api/bfp-bo-list/external/v1/bo-list/ws/329/prvu1ib3/websocket</a></td>
<td colspan="1">WSS/HTTP</td></tr>
<tr>
<td colspan="1">28</td>
<td colspan="1">bo-frontend&nbsp;</td>
<td colspan="1">&nbsp;Пользователю доступно для прочтения новое сообщение</td>
<td colspan="1">
<pre>GET</pre></td>
<td colspan="1">/external/v1/notification</td>
<td colspan="1"><span style="color: rgb(23,43,77);">REST/json</span></td></tr>
<tr>
<td colspan="1">29</td>
<td colspan="1">Postgres&nbsp;</td>
<td colspan="1">&nbsp;Возвращается сообщение о том что импорт завершился с ошибкой</td>
<td colspan="1">
<pre>GET</pre></td>
<td colspan="1">/external/v1/notification</td>
<td colspan="1"><span style="color: rgb(23,43,77);">REST/json</span></td></tr>
<tr>
<td colspan="1">30</td>
<td colspan="1">bo-list-import&nbsp;&nbsp;</td>
<td colspan="1">Сервис &quot;bo-list-import&quot; передает в топик кафки <a href="http://bfp.cc">bfp.cc</a>.user.notification cообщение о завершении импорта с ошибкой</td>
<td colspan="1">
<pre>POST</pre></td>
<td colspan="1">/external/v1/import-list-item/import</td>
<td colspan="1"><span style="color: rgb(23,43,77);">REST/json</span></td></tr>
<tr>
<td colspan="1">31</td>
<td colspan="1">bo-notification&nbsp;</td>
<td colspan="1">Сервис bo-notification получает сообщение из топика <a href="http://bfp.cc">bfp.cc</a>.user.notification</td>
<td colspan="1">
<pre>POST</pre></td>
<td colspan="1">/external/v1/import-list-item/import</td>
<td colspan="1"><span style="color: rgb(23,43,77);">REST/json</span></td></tr>
<tr>
<td colspan="1">32,33</td>
<td colspan="1">bo-notification&nbsp;</td>
<td colspan="1">Сервис bo-notification создает запись в таблице long_term_notification на основе данных из сообщения</td>
<td colspan="1">
<pre>POST</pre></td>
<td colspan="1">/external/v1/import-list-item/import</td>
<td colspan="1"><span style="color: rgb(23,43,77);">REST/json</span></td></tr>
<tr>
<td colspan="1">34</td>
<td colspan="1">bo-notification&nbsp;</td>
<td colspan="1">&nbsp;Уведомление передается через &quot;Websocket&quot;.</td>
<td colspan="1">
<pre>GET</pre></td>
<td colspan="1">/external/v1/notification</td>
<td colspan="1"><span style="color: rgb(23,43,77);">REST/json</span></td></tr>
<tr>
<td colspan="1">35</td>
<td colspan="1">Websocket&nbsp;</td>
<td colspan="1">&nbsp;Передается уведомление пользователю, счетчик количества уведомлений + 1</td>
<td colspan="1"><span style="color: rgb(0,0,0);">GET</span></td>
<td colspan="1"><a href="wss://mgmt.dev1.biplan.bi.zone/api/bfp-bo-list/external/v1/bo-list/ws/329/prvu1ib3/websocket">wss://mgmt.dev1.biplan.bi.zone/api/bfp-bo-list/external/v1/bo-list/ws/329/prvu1ib3/websocket</a></td>
<td colspan="1">WSS/HTTP</td></tr>
<tr>
<td colspan="1">36</td>
<td colspan="1">bo-frontend&nbsp;</td>
<td colspan="1">&nbsp;Пользователю доступно для прочтения новое уведомление</td>
<td colspan="1">
<pre>GET</pre></td>
<td colspan="1">/external/v1/notification</td>
<td colspan="1"><span style="color: rgb(23,43,77);">REST/json</span></td></tr></tbody></table>
<h1>Список компонентов&nbsp;</h1>
<p>Создаваемый компонент:</p>
<ul>
<li>bo-notification</li>
<li>bo-list-import</li></ul>
<p>Дорабатываемый <ac:inline-comment-marker ac:ref="31c5f0ca-8bab-476e-9c5b-d000310e531a">компонент</ac:inline-comment-marker>:</p>
<ul>
<li>bo-frontend</li>
<li>bo-list</li></ul>
<h1>Функциональные требований</h1>
<p><br /></p><ac:structured-macro ac:name="info" ac:schema-version="1" ac:macro-id="889eadf2-5ced-4d06-8b58-cb3e6f7469ca"><ac:parameter ac:name="title">ВАЖНО!</ac:parameter><ac:rich-text-body>
<p>В рамках настоящей доработки, не предусмотрено изменений интеграции с ядром!</p></ac:rich-text-body></ac:structured-macro>
<h2>Компонент&nbsp;bo-frontend</h2>
<table class="relative-table wrapped" style="width: 58.6458%;"><colgroup><col style="width: 24.1643%;" /><col style="width: 75.8357%;" /></colgroup>
<tbody>
<tr>
<th colspan="1"><span style="color: rgb(0,0,0);">GIT repository</span></th>
<td colspan="1"><a href="https://stash.sigma.sbrf.ru/projects/TAF_ARM/repos/bo-frontend/browse" class="external-link" style="text-decoration: none;text-align: left;" rel="nofollow">https://stash.sigma.sbrf.ru/projects/TAF_ARM/repos/bo-frontend/</a></td></tr>
<tr>
<th colspan="1"><span style="color: rgb(0,0,0);">Ответственный за компонент</span></th>
<td colspan="1">
<div class="content-wrapper">
<p><ac:link><ri:user ri:userkey="8aae6c947eb1ba23017eb4f6b6290008" /></ac:link></p></div></td></tr>
<tr>
<th style="text-align: left;" colspan="1"><span style="color: rgb(0,0,0);">Ссылка на задачу</span></th>
<td style="text-align: left;" colspan="1">
<div class="content-wrapper">
<p><ac:structured-macro ac:name="jira" ac:schema-version="1" ac:macro-id="260312b4-c82c-4359-9772-df48c086f3b5"><ac:parameter ac:name="server">Jira SberWorks</ac:parameter><ac:parameter ac:name="serverId">611daf70-25e6-3844-a434-3583e234ac1b</ac:parameter><ac:parameter ac:name="key">UINAF-1956</ac:parameter></ac:structured-macro></p></div></td></tr></tbody></table>
<h3>UI/UX</h3>
<p>5.1.1.1 Для информирования пользователя о завершении процедуры импорта большого списка, через уведомление, необходимо доработать интерфейс в соответствии с требованиями приведенными в таблице 1.</p>
<p><strong>Таблица 1. Описание элементов интерфейса панели просмотра уведомлений</strong></p>
<table class="relative-table wrapped" style="width: 100.0%;"><colgroup><col style="width: 8.23506%;" /><col style="width: 28.1941%;" /><col style="width: 16.2619%;" /><col style="width: 47.3089%;" /></colgroup>
<thead>
<tr>
<th style="text-align: left;">
<p>№ ПП</p></th>
<th style="text-align: left;">
<p class="a"><strong>Элемента UI</strong></p></th>
<th style="text-align: left;">
<p class="a">Тип</p></th>
<th style="text-align: left;">
<p class="a">Описание</p></th></tr></thead>
<tbody>
<tr>
<td colspan="4"><strong>Панель главного меню</strong></td></tr>
<tr>
<td style="text-align: left;">1</td>
<td style="text-align: left;">Колокольчик со счетчиком новых уведомлений</td>
<td style="text-align: left;">Кнопка</td>
<td style="text-align: left;">
<div class="content-wrapper">
<p>Кнопка расположена на панели главного меню слева от иконки текущего пользователя.&nbsp;&nbsp;</p>
<p>При нажатии на кнопку открывается панель просмотра уведомлений пользователя (вертикально с права)</p></div></td></tr>
<tr>
<td colspan="4"><strong>Панель просмотра уведомлений пользователя</strong></td></tr>
<tr>
<td>2</td>
<td>&quot;Закрыть&quot;</td>
<td>Кнопка</td>
<td>Закрывает панель просмотра уведомлений</td></tr>
<tr>
<td>3</td>
<td>&quot;Новые&quot; со счетчиком</td>
<td>Кнопка - вкладка</td>
<td>Выводит в список уведомлений только, те которые не просмотрены пользователем</td></tr>
<tr>
<td>4</td>
<td>&quot;Все&quot; со счетчиком</td>
<td>Кнопка - вкладка</td>
<td>Выводит в список уведомлений все уведомления пользователя&nbsp;</td></tr>
<tr>
<td>5</td>
<td>&quot;Сначала новые&quot; / &quot;Сначала старые&quot;</td>
<td>Кнопка&nbsp;</td>
<td>Изменяет способ сортировки по параметру дата и время уведомления (по возрастанию / по убыванию)</td></tr>
<tr>
<td colspan="4">Массовые операции с уведомлениями</td></tr>
<tr>
<td>6</td>
<td>&quot;Прочитать все&quot;</td>
<td>Кнопка</td>
<td>Поставляет признак прочтения всем уведомлениям пользователя.</td></tr>
<tr>
<td>7</td>
<td>&quot;Удалить все&quot;</td>
<td>Кнопка&nbsp;</td>
<td>Поставляет признак удаления всем уведомлениям пользователя.</td></tr>
<tr>
<td colspan="4">Операции in-line с уведомлениями</td></tr>
<tr>
<td>8</td>
<td>&quot;Прочитать&quot;</td>
<td>Кнопка</td>
<td>Поставляет признак прочтения выбранному пользователем уведомлению.</td></tr>
<tr>
<td>9</td>
<td>&quot;Удалить&quot;</td>
<td>Кнопка</td>
<td>Поставляет признак удаления выбранному пользователем уведомлению.</td></tr></tbody></table>
<p><strong>Пример макета панели просмотра уведомлений</strong></p>
<p><ac:image ac:width="500"><ri:attachment ri:filename="image2023-4-27_22-29-12.png" /></ac:image></p>
<p><br /></p>
<p><br /></p>
<p>5.1.1.2. Текст уведомления о завершении импорта большого списка должен быть следующего содержания &quot;Импорт списка 'Название списка' завершен 'успешно / с ошибкой'&quot;.</p>
<p>5.1.2.3. Если импорт завершился с ошибкой, то в уведомлении должно содержаться наименование класса ошибки.</p>
<p>5.1.1.3. Название списка в уведомлении, должно быть представлено в виде ссылки.</p>
<p>5.1.1.4. При нажатии нажатии на ссылку, должен осуществляться переход к карточке списка в режиме просмотра.</p>
<p><br /></p>
<h2>Компонент bo-notification</h2>
<table class="relative-table wrapped" style="width: 58.6458%;"><colgroup><col style="width: 24.1643%;" /><col style="width: 75.8357%;" /></colgroup>
<tbody>
<tr>
<th colspan="1"><span style="color: rgb(0,0,0);">GIT repository</span></th>
<td colspan="1"><a href="https://stash.sigma.sbrf.ru/projects/TAF_ARM/repos/openapi/pull-requests/17/diff#bfp-bo-notification/openapi.yaml">https://stash.sigma.sbrf.ru/projects/TAF_ARM/repos/openapi/pull-requests/17/diff#bfp-bo-notification/openapi.yaml</a></td></tr>
<tr>
<th colspan="1"><span style="color: rgb(0,0,0);">Ответственный за компонент</span></th>
<td colspan="1">
<div class="content-wrapper">
<p><ac:link><ri:user ri:userkey="8aae693a7e4ad316017e4d06d31a0019" /></ac:link></p></div></td></tr>
<tr>
<th style="text-align: left;" colspan="1"><span style="color: rgb(0,0,0);">Ссылка на задачу</span></th>
<td style="text-align: left;" colspan="1">
<div class="content-wrapper">
<p><ac:structured-macro ac:name="jira" ac:schema-version="1" ac:macro-id="63d52e50-5ad3-4b3e-bdd6-76398dc95a9f"><ac:parameter ac:name="server">Jira SberWorks</ac:parameter><ac:parameter ac:name="serverId">611daf70-25e6-3844-a434-3583e234ac1b</ac:parameter><ac:parameter ac:name="key">UINAF-1957</ac:parameter></ac:structured-macro></p></div></td></tr></tbody></table>
<h3>&nbsp;Создание сервиса&nbsp;bo-notification</h3>
<p>5.2.1.1. Для управления уведомлениями пользователя необходимо реализовать сервис который обеспечивал бы функции описанные в разделе&nbsp; 5.1.1. таблицы 1 настоящих требований.</p>
<p>5.2.1.2. Связь сервиса с клиентским приложением должна осуществляться через websocket.</p>
<h3>Изменения</h3>
<p><a href="https://stash.sigma.sbrf.ru/projects/TAF_ARM/repos/openapi/pull-requests/17/diff#bfp-bo-notification/openapi.yaml"><ac:inline-comment-marker ac:ref="7d044c92-53e6-4dce-b31b-c0be2e6b3720">Изменения OpenAPI</ac:inline-comment-marker></a></p>
<h3>Требования к формату хранения</h3>
<p>5.2.3.1. Для нового сервиса уведомлений необходимо создать схему и таблицу в БД описание полей приведено ниже в таблице 2.</p>
<p><strong>Таблица 2. Описание полей таблицы &quot;notification&quot;</strong></p>
<table class="relative-table wrapped" style="width: 43.5926%;"><colgroup><col style="width: 5.4567%;" /><col style="width: 15.9704%;" /><col style="width: 17.7458%;" /><col style="width: 15.6873%;" /><col style="width: 45.1398%;" /></colgroup>
<thead>
<tr>
<th style="text-align: left;">
<p>№ ПП</p></th>
<th style="text-align: left;">
<p>Наименование атрибута</p></th>
<th style="text-align: left;">
<p>Тип данных</p></th>
<th colspan="1">Not Null</th>
<th style="text-align: left;">
<p>Описание атрибута</p></th></tr></thead>
<tbody>
<tr>
<td style="text-align: left;">1</td>
<td style="text-align: left;">id</td>
<td style="text-align: left;">uuid</td>
<td colspan="1">true</td>
<td style="text-align: left;">Идентификатор объекта&nbsp;notification</td></tr>
<tr>
<td colspan="1">2</td>
<td colspan="1"><ac:inline-comment-marker ac:ref="e08a064f-9ed5-4b5f-9032-d2f9984fd377">recipient_id</ac:inline-comment-marker></td>
<td colspan="1">uuid</td>
<td colspan="1">true</td>
<td colspan="1">Идентификатор пользователя - получателя уведомления</td></tr>
<tr>
<td colspan="1">3</td>
<td colspan="1">notification_type</td>
<td colspan="1">varchar (128)</td>
<td colspan="1">true</td>
<td colspan="1">Тип уведомления&nbsp;</td></tr>
<tr>
<td colspan="1">4</td>
<td colspan="1">notification</td>
<td colspan="1">jsonb</td>
<td colspan="1">true</td>
<td colspan="1">Содержит json-объект (описание приведено ниже)</td></tr>
<tr>
<td colspan="1">5</td>
<td colspan="1">viewed</td>
<td colspan="1">timestamp</td>
<td colspan="1">false</td>
<td colspan="1">Признак того, что уведомление просмотрено. Если уведомление просмотрено, фиксируется время и дата просмотра, в противном случае - NULL</td></tr>
<tr>
<td colspan="1">6</td>
<td colspan="1">created</td>
<td colspan="1">timestamp</td>
<td colspan="1">true</td>
<td colspan="1">Дата и время создания уведомления</td></tr>
<tr>
<td style="text-align: left;">7</td>
<td style="text-align: left;">deleted</td>
<td style="text-align: left;">timestamp</td>
<td colspan="1">false</td>
<td style="text-align: left;">Признак того, что уведомление удалено. Если уведомление удалено, фиксируется время и дата удаления, в противном случае - NULL</td></tr></tbody></table>
<p><br /></p>
<p>5.2.3.1. Пример заполнения поля &quot;notification&quot; - п.п. 4 таблицы 2 приведен в блоке ниже</p><ac:structured-macro ac:name="code" ac:schema-version="1" ac:macro-id="56349947-2706-4783-9df3-492ca3f5081b"><ac:parameter ac:name="language">applescript</ac:parameter><ac:parameter ac:name="theme">DJango</ac:parameter><ac:parameter ac:name="title">Пример заполнения</ac:parameter><ac:parameter ac:name="collapse">true</ac:parameter><ac:plain-text-body><![CDATA[{
  "id": "ba5fd091-0f4f-4c31-b4be-a964045bde12", -- В формате UUID. В нашем случае идентификатор списка в который осуществлялся импорт
  "type": "list", -- Указывается тип импорта, для указания сервиса который выполнял импорт
  "status": "FAILED", -- Результат выполнения импорта. Может принимать значения: 1. DONE, 2. FAILED.
  "createdBy": "a4d4181d-0fb3-40c6-a568-5af9704066a3" -- Идентификатор пользователя, который осуществлял импорт большого списка в сервисе "bo-list"
}]]></ac:plain-text-body></ac:structured-macro>
<p><br /></p>
<p>5.2.3.1. Запрос для создания схемы и таблицы в БД приведен в блоке ниже</p><ac:structured-macro ac:name="code" ac:schema-version="1" ac:macro-id="e8717c88-c7f4-4a3a-8235-c13bef787385"><ac:parameter ac:name="language">applescript</ac:parameter><ac:parameter ac:name="theme">DJango</ac:parameter><ac:parameter ac:name="title">Создание схемы и таблицы для сервиса &quot;bo-notification&quot;</ac:parameter><ac:plain-text-body><![CDATA[CREATE SCHEMA bfp_bo_notification AUTHORIZATION as_admin;
CREATE TABLE bfp_bo_notification.notification (
	id uuid NOT NULL,
	recipient_id uuid NOT NULL,
	notification_type varchar(128) NOT NULL,
	notification jsonb NOT NULL,
	viewed timestamp NULL,
	created timestamp NOT NULL,
	deleted timestamp NULL,
	CONSTRAINT notification_pkey PRIMARY KEY (id)
);]]></ac:plain-text-body></ac:structured-macro>
<h2>Компонент&nbsp;bo-list-import</h2>
<table class="relative-table wrapped"><colgroup><col style="width: 24.1643%;" /><col style="width: 75.8357%;" /></colgroup>
<tbody>
<tr>
<th colspan="1"><span style="color: rgb(0,0,0);">GIT repository</span></th>
<td colspan="1"><a href="https://stash.sigma.sbrf.ru/projects/TAF_ARM/repos/openapi/pull-requests/17/diff#bfp-bo-import-list/openapi.yaml">https://stash.sigma.sbrf.ru/projects/TAF_ARM/repos/openapi/pull-requests/17/diff#bfp-bo-import-list/openapi.yaml</a></td></tr>
<tr>
<th colspan="1"><span style="color: rgb(0,0,0);">Ответственный за компонент</span></th>
<td colspan="1">
<div class="content-wrapper">
<p><ac:link><ri:user ri:userkey="8aae693a7e4ad316017e4d06d31a0019" /></ac:link></p></div></td></tr>
<tr>
<th style="text-align: left;" colspan="1"><span style="color: rgb(0,0,0);">Ссылка на задачу</span></th>
<td style="text-align: left;" colspan="1">
<div class="content-wrapper">
<p><ac:structured-macro ac:name="jira" ac:schema-version="1" ac:macro-id="90806f34-2be9-4a58-9017-355e02ff959b"><ac:parameter ac:name="server">Jira SberWorks</ac:parameter><ac:parameter ac:name="serverId">611daf70-25e6-3844-a434-3583e234ac1b</ac:parameter><ac:parameter ac:name="key">UINAF-1958</ac:parameter></ac:structured-macro></p></div></td></tr></tbody></table>
<h3>Изменения</h3>
<p><a href="https://stash.sigma.sbrf.ru/projects/TAF_ARM/repos/openapi/pull-requests/17/diff#bfp-bo-import-list/openapi.yaml">Изменения OpenAPI</a></p>
<p>5.3.1.1. Процедура импорта должна выполняться в отдельном сервисе.</p>
<p>5.3.1.2. Импорт больших списков должен выполняться в асинхронном режиме.</p>
<p>5.3.1.3. Для выполнения импорта должна использоваться временная таблица для снижения нагрузки на сервис bo-list.</p>
<p>5.3.1.4. При импорте больших списков одновременно несколькими пользователями, каждая процедура должна выполняться последовательно (при этом таблица bfp_bo_policy_list.policy_list_item не блокируется).</p>
<p>5.3.1.5. При добавлении элементов в конец списка и необходимо сохранять в списке элемент с ранней датой записи в этот список. Дубли элементов в список не вносить.</p>
<p>5.3.1.6.&nbsp; При импорте списка с выбранной настройкой &quot;Добавить элементы в конец текущего списка&quot; необходимо:&nbsp;</p>
<ul>
<li>не валидировать содержимое загружаемого csv-файла на дубли, актуальность сроков действия элементов.</li>
<li>валидировать загружаемый файл только на корректность формата - csv. ( + проверка на SQL-инъекции)&nbsp;</li>
<li>добавить в форму Импорт хинт с предупреждением о том, что дублированные значения не будут сохранены.&nbsp;</li></ul>
<h2>Компонент bo-list</h2>
<table class="relative-table wrapped"><colgroup><col style="width: 24.1643%;" /><col style="width: 75.8357%;" /></colgroup>
<tbody>
<tr>
<th colspan="1"><span style="color: rgb(0,0,0);">G<ac:inline-comment-marker ac:ref="7d060cac-f4ad-4934-a5e9-0ca9797dd1fa">IT repository</ac:inline-comment-marker></span></th>
<td colspan="1"><a href="https://stash.sigma.sbrf.ru/projects/TAF_ARM/repos/bo-list/browse">https://stash.sigma.sbrf.ru/projects/TAF_ARM/repos/bo-list/browse</a></td></tr>
<tr>
<th colspan="1"><span style="color: rgb(0,0,0);">Ответственный за компонент</span></th>
<td colspan="1">
<div class="content-wrapper">
<p><ac:link><ri:user ri:userkey="8aae693a7e4ad316017e4d06d31a0019" /></ac:link></p></div></td></tr>
<tr>
<th style="text-align: left;" colspan="1"><span style="color: rgb(0,0,0);"><ac:inline-comment-marker ac:ref="3375326e-7fbf-4081-bcbf-6d05ae6de783">Ссылка на задачу</ac:inline-comment-marker></span></th>
<td style="text-align: left;" colspan="1">
<div class="content-wrapper">
<p><ac:structured-macro ac:name="jira" ac:schema-version="1" ac:macro-id="fc871690-4641-4304-baed-a560ca6b4b25"><ac:parameter ac:name="server">Jira SberWorks</ac:parameter><ac:parameter ac:name="serverId">611daf70-25e6-3844-a434-3583e234ac1b</ac:parameter><ac:parameter ac:name="key">UINAF-1962</ac:parameter></ac:structured-macro></p></div></td></tr></tbody></table>
<p><br /></p>
<p><span class="nh-number"><span>5.4.1.&nbsp;</span></span>&nbsp;Требования на доработку Журнала списков.&nbsp;</p>
<ol>
<li>Добавить строку поиска по значениям во всех списках в Журнале списков.&nbsp;</li>
<li>Поиск должен осуществляться по всем элементам всех списков.&nbsp;</li>
<li>После окончания поиска необходимо вывести в Журнале списки с найдены элементами, либо отобразить уведомление, что записи не найдены (аналогично поиску по названию списка).&nbsp;</li></ol>
<p><span class="nh-number"><span>5.4.2&nbsp;</span></span>&nbsp;Требования на доработку формы Элементы списка в Карточке списке.&nbsp;</p>
<ol>
<li>Добавить в Карточку списка-Элементы списка столбцы с информацией о дате и времени внесения элемента в список, дате и времени изменения элемента в списке.&nbsp;</li>
<li>Если элемент не менялся, то дата внесения=дате изменения.</li></ol>
<p><span class="nh-number"><span>5.4.3&nbsp;</span></span>Требования к схеме синхронизации списков между АРМ Аналитика и Ядром.&nbsp;&nbsp;</p>
<p><u>Требования к схеме синхронизации:&nbsp;</u></p>
<p><ac:inline-comment-marker ac:ref="6f9c12ba-bdca-4936-8c76-d4c28c14ae8c">Схема доставки</ac:inline-comment-marker> элементов списка из&nbsp;back АРМ в Ядро, должна удовлетворять следующим условиям:</p>
<ul>
<li>синхронизация списков и элементов списка за время, указанное в<span>&nbsp;</span><strong>Таблице 4.</strong></li>
<li>100% доставка списков и элементов списка из АРМ в таблицы Ядра.</li>
<li>100% соответствие названий списков, значений в списках в таблицах АРМ и таблицах Ядра.&nbsp;</li>
<li>время синхронизации при замене списка и при добавлении записей в текущий список не должно существенно отличаться.&nbsp;</li></ul>
<p><strong>Таблица 4.</strong>&nbsp;<strong>Ожидаемое время загрузки списков в зависимости от <ac:inline-comment-marker ac:ref="db4da7c4-543a-4b1e-8854-c4db1eb48c95">количества записей</ac:inline-comment-marker>&nbsp;</strong></p>
<table class="relative-table wrapped" style="width: 695.156px;"><colgroup><col /><col /><col /></colgroup>
<thead>
<tr>
<th style="text-align: left;">
<p>Количество записей&nbsp;</p></th>
<th style="text-align: left;">
<p>Допустимое время загрузки в Ядро</p></th>
<th style="text-align: left;">
<p>Примечание&nbsp;</p></th></tr></thead>
<tbody>
<tr>
<td style="text-align: left;">&lt;= 40 тыс&nbsp;</td>
<td style="text-align: left;">до 2 мин.</td>
<td style="text-align: left;">
<p>Загрузка списков в асинхронном режиме.&nbsp;</p>
<p>Время указано для одного списка без параллельной загрузки.&nbsp;</p></td></tr>
<tr>
<td style="text-align: left;" colspan="1">40-150 тыс</td>
<td style="text-align: left;" colspan="1">до 4 мин</td>
<td style="text-align: left;" colspan="1">
<p>Загрузка списков в асинхронном режиме&nbsp;</p>
<p>Время указано для одного списка без параллельной загрузки.&nbsp;</p></td></tr>
<tr>
<td style="text-align: left;" colspan="1">150 - 700 тыс</td>
<td style="text-align: left;" colspan="1">до 6 мин&nbsp;</td>
<td style="text-align: left;" colspan="1">
<p>Загрузка списков в асинхронном режиме&nbsp;</p>
<p>Время указано для одного списка без параллельной загрузки.&nbsp;</p></td></tr>
<tr>
<td style="text-align: left;" colspan="1">&gt; 700тыс&nbsp;</td>
<td style="text-align: left;" colspan="1">до 25 мин&nbsp;</td>
<td style="text-align: left;" colspan="1">Списки более 1 млн грузятся крайне редко, время загрузки не имеет принципиального значения, но не более вменяемого времени ( предполагается до 25 мин). Проверить на НТ.&nbsp;</td></tr></tbody></table>
<p><strong>Таблица 5.&nbsp;Текущие ручные списки в ПРОМ.&nbsp;</strong></p>
<table class="wrapped"><colgroup><col /><col /><col /></colgroup>
<thead>
<tr>
<th style="text-align: left;"><br /></th>
<th style="text-align: left;">
<p>Количество</p></th>
<th style="text-align: left;">
<p>Размер , Мб&nbsp;</p></th></tr></thead>
<tbody>
<tr>
<td style="text-align: left;">Количество ручных списков</td>
<td style="text-align: left;">104</td>
<td style="text-align: left;"><br /></td></tr>
<tr>
<td style="text-align: left;">Максимальное количество записей в списке&nbsp;&nbsp;</td>
<td style="text-align: left;">3 200 000&nbsp;</td>
<td style="text-align: left;"><br /></td></tr>
<tr>
<td style="text-align: left;" colspan="1">Минимальное&nbsp;количество записей в списке</td>
<td style="text-align: left;" colspan="1">1</td>
<td style="text-align: left;" colspan="1"><br /></td></tr>
<tr>
<td style="text-align: left;" colspan="1">Сумма записей во всех списках&nbsp;</td>
<td style="text-align: left;" colspan="1">1 364 266</td>
<td style="text-align: left;" colspan="1">40&nbsp;</td></tr></tbody></table>
<p><strong>Таблица 6. Ограничения на импорт и хранение списков.&nbsp;</strong></p>
<p>АС должна ограничить возможность импорта списков, согласно таблице:</p>
<table class="relative-table wrapped" style="width: 1226.94px;"><colgroup><col style="width: 369.344px;" /><col style="width: 126.656px;" /><col style="width: 729.938px;" /></colgroup>
<thead>
<tr>
<th style="text-align: left;"><br /></th>
<th style="text-align: left;">
<p>Количество элементов&nbsp;</p></th>
<th style="text-align: left;">
<p>Примечание</p></th></tr></thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Максимальное количество элементов в списке для импорта</strong></td>
<td style="text-align: left;">700 000</td>
<td style="text-align: left;">Проверить на НТ, какое максимальное кол-во элементов в одном csv-файле может импортировать АС. Если 700 тыс не держит, то готовы снижать кол-во до 150тыс. элементов.</td></tr>
<tr>
<td style="text-align: left;"><strong>Максимальное&nbsp;количество элементов в списке для хранения&nbsp; в таблицах АРМ и Ядра</strong></td>
<td style="text-align: left;">1,5 млн (текущий макс 903 тыс + рост)&nbsp;</td>
<td style="text-align: left;">
<p>Проверить на НТ,&nbsp;какое максимальное кол-во элементов в одном списке может хранить и обрабатывать АРМ и Ядро.&nbsp;</p></td></tr>
<tr>
<td style="text-align: left;" colspan="1"><strong>Максимальное&nbsp;количество элементов для отображения в интерфейсе Карточки списка АРМ</strong></td>
<td style="text-align: left;" colspan="1">все элементы списка</td>
<td style="text-align: left;" colspan="1">Проверить на НТ&nbsp;</td></tr></tbody></table>
<h1><span class="nh-number" style="color: rgb(0,0,0);">Нефункциональные требования&nbsp;</span></h1>
<h2><span style="color: rgb(51,51,51);">Логирование&nbsp;</span></h2>
<p>Согласно пункту 3&nbsp;<a style="text-decoration: none;" href="https://confluence.sberbank.ru/pages/viewpage.action?pageId=7717763151">Требования к логированию и мониторингу</a></p>
<h2><span style="color: rgb(51,51,51);">Мониторинг</span></h2>
<p><span style="color: rgb(51,51,51);"><span style="color: rgb(0,51,102);">Необходимо собирать следующие метрики:</span></span></p>
<table class="wrapped"><colgroup><col /><col /><col /></colgroup>
<thead>
<tr>
<th style="text-align: left;">
<p>#</p></th>
<th style="text-align: left;">
<p>Компонент</p></th>
<th style="text-align: left;">
<p>Метрика</p></th></tr></thead>
<thead>
<tr>
<th style="text-align: left;">
<p>#</p></th>
<th style="text-align: left;">
<p>Компонент</p></th>
<th style="text-align: left;">
<p>Метрика</p></th></tr></thead>
<tbody>
<tr>
<td style="text-align: left;">1</td>
<td style="text-align: left;">Вызов приложения-сервера</td>
<td style="text-align: left;">
<ul>
<li>счетчик успешно/неуспешно обработанных&nbsp;событий</li>
<li>счетчик&nbsp;отправленных ответов</li>
<li>счетчик&nbsp;успешно/неуспешно отправленных ответов</li></ul>
<p><strong><u>Tребование ко всем счетчикам</u></strong>: cчетчики должны быть разбиты по endpoint&rsquo;ам. Не надо путать /readiness или /metrics с root &nbsp;&nbsp;</p></td></tr>
<tr>
<td style="text-align: left;">2</td>
<td style="text-align: left;">Приложение делает вызов другого приложения-клиента</td>
<td style="text-align: left;">
<ul>
<li><span style="color: rgb(0,51,102);">счетчик ошибок подключения</span></li>
<li><span style="color: rgb(0,51,102);"><span style="color: rgb(0,51,102);text-decoration: none;">счетчик сколько запросов отправлено</span></span></li>
<li><span style="color: rgb(0,51,102);"><span style="color: rgb(0,51,102);text-decoration: none;">таймер ответа приложения-клиента &nbsp;</span></span></li>
<li><span style="color: rgb(0,51,102);">eсли с внешним приложением есть пулы соединений, то</span>
<ul>
<li><span style="color: rgb(0,51,102);">максимум и минимум соединений в пуле за минуту</span></li>
<li><span style="color: rgb(0,51,102);">максимум, минимум и среднее количество свободных соединений в пуле, если применимо</span></li></ul></li></ul></td></tr>
<tr>
<td style="text-align: left;">3</td>
<td style="text-align: left;">Взаимодействие с Kafka (режим продюсер, запись)</td>
<td style="text-align: left;">
<ul>
<li><span style="color: rgb(0,51,102);">счетчик сообщений отправленных в&nbsp;Kafka</span>
<ul>
<li><span style="color: rgb(0,51,102);">сколько сообщений в минуту отправлено</span></li>
<li><span style="color: rgb(0,51,102);">перцентиль&nbsp;</span></li></ul></li></ul></td></tr>
<tr>
<td style="text-align: left;">4</td>
<td style="text-align: left;">Взаимодействие с Kafka (режим консюмер, чтение)</td>
<td style="text-align: left;">
<ul>
<li><span style="color: rgb(0,51,102);">счетчик прочитанных сообщений из&nbsp;Kafka</span><br />
<ul>
<li><span style="color: rgb(0,51,102);">сколько сообщений в минуту прочитано</span></li>
<li><span style="color: rgb(0,51,102);">перцентиль</span></li></ul></li>
<li><span style="color: rgb(0,51,102);">время обработки одного сообщения</span></li></ul></td></tr>
<tr>
<td style="text-align: left;">5</td>
<td style="text-align: left;">Взаимодействие с PostgreSQL</td>
<td style="text-align: left;">
<ul>
<li><span style="color: rgb(0,51,102);">счетчик запросов в базу</span>
<ul>
<li><span style="color: rgb(0,51,102);">на чтение</span></li>
<li><span style="color: rgb(0,51,102);">на запись</span></li></ul></li>
<li><span style="color: rgb(0,51,102);">сколько запросов&nbsp;в минуту&nbsp;</span>
<ul>
<li><span style="color: rgb(0,51,102);">прочитали</span></li>
<li><span style="color: rgb(0,51,102);">записали&nbsp;</span></li></ul></li>
<li><span style="color: rgb(0,51,102);">таймер запросов&nbsp;</span></li>
<li><span style="color: rgb(0,51,102);">перцентиль</span></li>
<li><span style="color: rgb(0,51,102);">максимум и минимум соединений в пуле за минуту</span></li>
<li><span style="color: rgb(0,51,102);">максимум, минимум и среднее количество свободных соединений в пуле, если применимо</span></li></ul></td></tr></tbody></table>
<h2>Требования к безопасности</h2>
<ul>
<li><span style="color: rgb(0,0,0);"><a href="https://confluence.sberbank.ru/pages/viewpage.action?pageId=7502398623" style="text-decoration: none;" rel="nofollow">Требования ИБ к Kafka</a><span>&nbsp;</span>необходимо соблюдать при взаимодействии АРМ Аналитика и ядра через Kafka.</span></li>
<li><span style="color: rgb(0,0,0);"><a href="https://confluence.sberbank.ru/pages/viewpage.action?pageId=7662541345" style="text-decoration: none;" rel="nofollow">Требования к настройкам TLS</a>&nbsp;необходимо соблюдать при взаимодействии&nbsp;</span>сервисов ядра и АРМ Аналитика<span style="color: rgb(0,51,102);">.</span><span style="color: rgb(0,0,0);">&nbsp;Настройка TLS выполняется средствами Istio (Envoy-proxy), без доработок приложений:&nbsp;двухсторонний TLS версии не ниже 1.2&nbsp;c контролем клиентского и серверного сертификатов и проверкой правомерности использования конкретного клиентского сертификата при обращении к конкретным сервисам.&nbsp;</span></li>
<li><span style="color: rgb(0,0,0);"><a href="https://confluence.sberbank.ru/pages/viewpage.action?pageId=7502398610" style="text-decoration: none;" rel="nofollow">Требования ИБ к OpenShift</a>&nbsp;необходимо соблюдать для всех компонент.</span></li>
<li><span style="color: rgb(0,0,0);">Маскировать параметры запроса согласно требований&nbsp;<a href="https://confluence.sberbank.ru/pages/viewpage.action?pageId=10625843747">Маскирование</a></span></li></ul>
<p><br /></p>
<p><br /></p></ac:rich-text-body></ac:structured-macro>